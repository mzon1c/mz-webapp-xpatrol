!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(e){"use strict";var t,n=function(){var t=function(e){return function(t){return e===t}},n=function(e,t){return e===t},o=function(e){return function(t,n){return t[e]===n[e]}},i=function(){return!0},r=function(){return!1},a=function(e){return function(){return!e.apply(e,arguments)}},s=function(e,t){return function(n){return e(n)&&t(n)}},l=function(e){return e},c=function(e,t){return function(){return e[t].apply(e,arguments)}},d=0,u=function(e){var t=++d+"";return e?e+t:t},h=function(t){var n=e(document);return{top:t.top+n.scrollTop(),left:t.left+n.scrollLeft(),width:t.right-t.left,height:t.bottom-t.top}},f=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t},m=function(e,t){return t=t||"",t+e.split(".").map(function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}).join("")};return{eq:t,eq2:n,peq2:o,ok:i,fail:r,self:l,not:a,and:s,invoke:c,uniqueId:u,rect2bnd:h,invertObject:f,namespaceToCamel:m}}(),o=function(){var t=function(e){return e[0]},o=function(e){return e[e.length-1]},i=function(e){return e.slice(0,e.length-1)},r=function(e){return e.slice(1)},a=function(e,t){for(var n=0,o=e.length;o>n;n++){var i=e[n];if(t(i))return i}},s=function(e,t){for(var n=0,o=e.length;o>n;n++)if(!t(e[n]))return!1;return!0},l=function(t,n){return e.inArray(n,t)},c=function(e,t){return-1!==l(e,t)},d=function(e,t){return t=t||n.self,e.reduce(function(e,n){return e+t(n)},0)},u=function(e){for(var t=[],n=-1,o=e.length;++n<o;)t[n]=e[n];return t},h=function(e){return!e||!e.length},f=function(e,n){if(!e.length)return[];var i=r(e);return i.reduce(function(e,t){var i=o(e);return n(o(i),t)?i[i.length]=t:e[e.length]=[t],e},[[t(e)]])},m=function(e){for(var t=[],n=0,o=e.length;o>n;n++)e[n]&&t.push(e[n]);return t},p=function(e){for(var t=[],n=0,o=e.length;o>n;n++)c(t,e[n])||t.push(e[n]);return t},g=function(e,t){var n=l(e,t);return-1===n?null:e[n+1]},v=function(e,t){var n=l(e,t);return-1===n?null:e[n-1]};return{head:t,last:o,initial:i,tail:r,prev:v,next:g,find:a,contains:c,all:s,sum:d,from:u,isEmpty:h,clusterBy:f,compact:m,unique:p}}(),i="function"==typeof define&&define.amd,r=function(t){var n="Comic Sans MS"===t?"Courier New":"Comic Sans MS",o=e("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),i=o.css("fontFamily",n).width(),r=o.css("fontFamily",t+","+n).width();return o.remove(),i!==r},a=navigator.userAgent,s=/MSIE|Trident/i.test(a);if(s){var l=/MSIE (\d+[.]\d+)/.exec(a);l&&(t=parseFloat(l[1])),l=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(a),l&&(t=parseFloat(l[1]))}var c=/Edge\/\d+/.test(a),d=!!window.CodeMirror;if(!d&&i&&require)if(require.hasOwnProperty("resolve"))try{require.resolve("codemirror"),d=!0}catch(u){d=!1}else require.hasOwnProperty("specified")&&(d=require.specified("codemirror"));var h={isMac:navigator.appVersion.indexOf("Mac")>-1,isMSIE:s,isEdge:c,isFF:!c&&/firefox/i.test(a),isPhantom:/PhantomJS/i.test(a),isWebkit:!c&&/webkit/i.test(a),isChrome:!c&&/chrome/i.test(a),isSafari:!c&&/safari/i.test(a),browserVersion:t,jqueryVersion:parseFloat(e.fn.jquery),isSupportAmd:i,hasCodeMirror:d,isFontInstalled:r,isW3CRangeSupport:!!document.createRange},f=String.fromCharCode(160),m="\ufeff",p=function(){var t=function(t){return t&&e(t).hasClass("note-editable")},i=function(t){return t&&e(t).hasClass("note-control-sizing")},r=function(e){return e=e.toUpperCase(),function(t){return t&&t.nodeName.toUpperCase()===e}},a=function(e){return e&&3===e.nodeType},s=function(e){return e&&1===e.nodeType},l=function(e){return e&&/^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(e.nodeName.toUpperCase())},c=function(e){return t(e)?!1:e&&/^DIV|^P|^LI|^H[1-7]/.test(e.nodeName.toUpperCase())},d=function(e){return e&&/^H[1-7]/.test(e.nodeName.toUpperCase())},u=r("PRE"),g=r("LI"),v=function(e){return c(e)&&!g(e)},y=r("TABLE"),b=function(e){return!(E(e)||w(e)||C(e)||c(e)||y(e)||x(e))},w=function(e){return e&&/^UL|^OL/.test(e.nodeName.toUpperCase())},C=r("HR"),N=function(e){return e&&/^TD|^TH/.test(e.nodeName.toUpperCase())},x=r("BLOCKQUOTE"),E=function(e){return N(e)||x(e)||t(e)},T=r("A"),S=function(e){return b(e)&&!!P(e,c)},R=function(e){return b(e)&&!P(e,c)},k=r("BODY"),A=function(e,t){return e.nextSibling===t||e.previousSibling===t},I=function(e,t){t=t||n.ok;var o=[];return e.previousSibling&&t(e.previousSibling)&&o.push(e.previousSibling),o.push(e),e.nextSibling&&t(e.nextSibling)&&o.push(e.nextSibling),o},_=h.isMSIE&&h.browserVersion<11?"&nbsp;":"<br>",L=function(e){return a(e)?e.nodeValue.length:e.childNodes.length},D=function(e){var t=L(e);return 0===t?!0:a(e)||1!==t||e.innerHTML!==_?!(!o.all(e.childNodes,a)||""!==e.innerHTML):!0},O=function(e){l(e)||L(e)||(e.innerHTML=_)},P=function(e,n){for(;e;){if(n(e))return e;if(t(e))break;e=e.parentNode}return null},M=function(e,n){for(e=e.parentNode;e&&1===L(e);){if(n(e))return e;if(t(e))break;e=e.parentNode}return null},H=function(e,o){o=o||n.fail;var i=[];return P(e,function(e){return t(e)||i.push(e),o(e)}),i},B=function(e,t){var n=H(e);return o.last(n.filter(t))},F=function(t,n){for(var o=H(t),i=n;i;i=i.parentNode)if(e.inArray(i,o)>-1)return i;return null},z=function(e,t){t=t||n.fail;for(var o=[];e&&!t(e);)o.push(e),e=e.previousSibling;return o},U=function(e,t){t=t||n.fail;for(var o=[];e&&!t(e);)o.push(e),e=e.nextSibling;return o},j=function(e,t){var o=[];return t=t||n.ok,function i(n){e!==n&&t(n)&&o.push(n);for(var r=0,a=n.childNodes.length;a>r;r++)i(n.childNodes[r])}(e),o},q=function(t,n){var o=t.parentNode,i=e("<"+n+">")[0];return o.insertBefore(i,t),i.appendChild(t),i},V=function(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e},W=function(t,n){return e.each(n,function(e,n){t.appendChild(n)}),t},$=function(e){return 0===e.offset},K=function(e){return e.offset===L(e.node)},G=function(e){return $(e)||K(e)},Y=function(e,t){for(;e&&e!==t;){if(0!==J(e))return!1;e=e.parentNode}return!0},X=function(e,t){for(;e&&e!==t;){if(J(e)!==L(e.parentNode)-1)return!1;e=e.parentNode}return!0},Q=function(e,t){return $(e)&&Y(e.node,t)},Z=function(e,t){return K(e)&&X(e.node,t)},J=function(e){for(var t=0;e=e.previousSibling;)t+=1;return t},ee=function(e){return!!(e&&e.childNodes&&e.childNodes.length)},te=function(e,n){var o,i;if(0===e.offset){if(t(e.node))return null;o=e.node.parentNode,i=J(e.node)}else ee(e.node)?(o=e.node.childNodes[e.offset-1],i=L(o)):(o=e.node,i=n?0:e.offset-1);return{node:o,offset:i}},ne=function(e,n){var o,i;if(L(e.node)===e.offset){if(t(e.node))return null;o=e.node.parentNode,i=J(e.node)+1}else ee(e.node)?(o=e.node.childNodes[e.offset],i=0):(o=e.node,i=n?L(e.node):e.offset+1);return{node:o,offset:i}},oe=function(e,t){return e.node===t.node&&e.offset===t.offset},ie=function(e){if(a(e.node)||!ee(e.node)||D(e.node))return!0;var t=e.node.childNodes[e.offset-1],n=e.node.childNodes[e.offset];return!(t&&!l(t)||n&&!l(n))},re=function(e,t){for(;e;){if(t(e))return e;e=te(e)}return null},ae=function(e,t){for(;e;){if(t(e))return e;e=ne(e)}return null},se=function(e){if(!a(e.node))return!1;var t=e.node.nodeValue.charAt(e.offset-1);return t&&" "!==t&&t!==f},le=function(e,t,n,o){for(var i=e;i&&(n(i),!oe(i,t));){var r=o&&e.node!==i.node&&t.node!==i.node;i=ne(i,r)}},ce=function(e,t){var o=H(t,n.eq(e));return o.map(J).reverse()},de=function(e,t){for(var n=e,o=0,i=t.length;i>o;o++)n=n.childNodes.length<=t[o]?n.childNodes[n.childNodes.length-1]:n.childNodes[t[o]];return n},ue=function(e,t){var n=t&&t.isSkipPaddingBlankHTML,o=t&&t.isNotSplitEdgePoint;if(G(e)&&(a(e.node)||o)){if($(e))return e.node;if(K(e))return e.node.nextSibling}if(a(e.node))return e.node.splitText(e.offset);var i=e.node.childNodes[e.offset],r=V(e.node.cloneNode(!1),e.node);return W(r,U(i)),n||(O(e.node),O(r)),r},he=function(e,t,o){var i=H(t.node,n.eq(e));return i.length?1===i.length?ue(t,o):i.reduce(function(e,n){return e===t.node&&(e=ue(t,o)),ue({node:n,offset:e?p.position(e):L(n)},o)}):null},fe=function(e,t){var n,i,r=t?c:E,a=H(e.node,r),s=o.last(a)||e.node;r(s)?(n=a[a.length-2],i=s):(n=s,i=n.parentNode);var l=n&&he(n,e,{isSkipPaddingBlankHTML:t,isNotSplitEdgePoint:t});return l||i!==e.node||(l=e.node.childNodes[e.offset]),{rightNode:l,container:i}},me=function(e){return document.createElement(e)},pe=function(e){return document.createTextNode(e)},ge=function(e,t){if(e&&e.parentNode){if(e.removeNode)return e.removeNode(t);var n=e.parentNode;if(!t){var o,i,r=[];for(o=0,i=e.childNodes.length;i>o;o++)r.push(e.childNodes[o]);for(o=0,i=r.length;i>o;o++)n.insertBefore(r[o],e)}n.removeChild(e)}},ve=function(e,n){for(;e&&!t(e)&&n(e);){var o=e.parentNode;ge(e),e=o}},ye=function(e,t){if(e.nodeName.toUpperCase()===t.toUpperCase())return e;var n=me(t);return e.style.cssText&&(n.style.cssText=e.style.cssText),W(n,o.from(e.childNodes)),V(n,e),ge(e),n},be=r("TEXTAREA"),we=function(e,t){var n=be(e[0])?e.val():e.html();return t?n.replace(/[\n\r]/g,""):n},Ce=function(t,n){var o=we(t);if(n){var i=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;o=o.replace(i,function(e,t,n){n=n.toUpperCase();var o=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(n)&&!!t,i=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(n);return e+(o||i?"\n":"")}),o=e.trim(o)}return o},Ne=function(t){var n=e(t),o=n.offset(),i=n.outerHeight(!0);return{left:o.left,top:o.top+i}},xe=function(e,t){Object.keys(t).forEach(function(n){e.on(n,t[n])})},Ee=function(e,t){Object.keys(t).forEach(function(n){e.off(n,t[n])})};return{NBSP_CHAR:f,ZERO_WIDTH_NBSP_CHAR:m,blank:_,emptyPara:"<p>"+_+"</p>",makePredByNodeName:r,isEditable:t,isControlSizing:i,isText:a,isElement:s,isVoid:l,isPara:c,isPurePara:v,isHeading:d,isInline:b,isBlock:n.not(b),isBodyInline:R,isBody:k,isParaInline:S,isPre:u,isList:w,isTable:y,isCell:N,isBlockquote:x,isBodyContainer:E,isAnchor:T,isDiv:r("DIV"),isLi:g,isBR:r("BR"),isSpan:r("SPAN"),isB:r("B"),isU:r("U"),isS:r("S"),isI:r("I"),isImg:r("IMG"),isTextarea:be,isEmpty:D,isEmptyAnchor:n.and(T,D),isClosestSibling:A,withClosestSiblings:I,nodeLength:L,isLeftEdgePoint:$,isRightEdgePoint:K,isEdgePoint:G,isLeftEdgeOf:Y,isRightEdgeOf:X,isLeftEdgePointOf:Q,isRightEdgePointOf:Z,prevPoint:te,nextPoint:ne,isSamePoint:oe,isVisiblePoint:ie,prevPointUntil:re,nextPointUntil:ae,isCharPoint:se,walkPoint:le,ancestor:P,singleChildAncestor:M,listAncestor:H,lastAncestor:B,listNext:U,listPrev:z,listDescendant:j,commonAncestor:F,wrap:q,insertAfter:V,appendChildNodes:W,position:J,hasChildren:ee,makeOffsetPath:ce,fromOffsetPath:de,splitTree:he,splitPoint:fe,create:me,createText:pe,remove:ge,removeWhile:ve,replace:ye,html:Ce,value:we,posFromPlaceholder:Ne,attachEvents:xe,detachEvents:Ee}}(),g=function(t,i){var r=this,a=e.summernote.ui;return this.memos={},this.modules={},this.layoutInfo={},this.options=i,this.initialize=function(){return this.layoutInfo=a.createLayout(t,i),this._initialize(),t.hide(),this},this.destroy=function(){this._destroy(),t.removeData("summernote"),a.removeLayout(t,this.layoutInfo)},this.reset=function(){var e=r.isDisabled();this.code(p.emptyPara),this._destroy(),this._initialize(),e&&r.disable()},this._initialize=function(){var t=e.extend({},this.options.buttons);Object.keys(t).forEach(function(e){r.memo("button."+e,t[e])});var n=e.extend({},this.options.modules,e.summernote.plugins||{});Object.keys(n).forEach(function(e){r.module(e,n[e],!0)}),Object.keys(this.modules).forEach(function(e){r.initializeModule(e)})},this._destroy=function(){Object.keys(this.modules).reverse().forEach(function(e){r.removeModule(e)}),Object.keys(this.memos).forEach(function(e){r.removeMemo(e)})},this.code=function(e){var n=this.invoke("codeview.isActivated");return void 0===e?(this.invoke("codeview.sync"),n?this.layoutInfo.codable.val():this.layoutInfo.editable.html()):(n?this.layoutInfo.codable.val(e):this.layoutInfo.editable.html(e),t.val(e),void this.triggerEvent("change",e))},this.isDisabled=function(){return"false"===this.layoutInfo.editable.attr("contenteditable")},this.enable=function(){this.layoutInfo.editable.attr("contenteditable",!0),this.invoke("toolbar.activate",!0)},this.disable=function(){this.invoke("codeview.isActivated")&&this.invoke("codeview.deactivate"),this.layoutInfo.editable.attr("contenteditable",!1),this.invoke("toolbar.deactivate",!0)},this.triggerEvent=function(){var e=o.head(arguments),i=o.tail(o.from(arguments)),r=this.options.callbacks[n.namespaceToCamel(e,"on")];r&&r.apply(t[0],i),t.trigger("summernote."+e,i)},this.initializeModule=function(e){var o=this.modules[e];o.shouldInitialize=o.shouldInitialize||n.ok,o.shouldInitialize()&&(o.initialize&&o.initialize(),o.events&&p.attachEvents(t,o.events))},this.module=function(e,t,n){return 1===arguments.length?this.modules[e]:(this.modules[e]=new t(this),void(n||this.initializeModule(e)))},this.removeModule=function(e){var n=this.modules[e];n.shouldInitialize()&&(n.events&&p.detachEvents(t,n.events),n.destroy&&n.destroy()),delete this.modules[e]},this.memo=function(e,t){return 1===arguments.length?this.memos[e]:void(this.memos[e]=t)},this.removeMemo=function(e){this.memos[e]&&this.memos[e].destroy&&this.memos[e].destroy(),delete this.memos[e]},this.createInvokeHandler=function(t,n){return function(o){o.preventDefault(),r.invoke(t,n||e(o.target).closest("[data-value]").data("value"))}},this.invoke=function(){var e=o.head(arguments),t=o.tail(o.from(arguments)),n=e.split("."),i=n.length>1,r=i&&o.head(n),a=i?o.last(n):o.head(n),s=this.modules[r||"editor"];return!r&&this[a]?this[a].apply(this,t):s&&s[a]&&s.shouldInitialize()?s[a].apply(s,t):void 0},this.initialize()};e.fn.extend({summernote:function(){var t=e.type(o.head(arguments)),n="string"===t,i="object"===t,r=i?o.head(arguments):{};r=e.extend({},e.summernote.options,r),r.langInfo=e.extend(!0,{},e.summernote.lang["en-US"],e.summernote.lang[r.lang]),this.each(function(t,n){var o=e(n);if(!o.data("summernote")){var i=new g(o,r);o.data("summernote",i),o.data("summernote").triggerEvent("init",i.layoutInfo)}});var a=this.first();if(a.length){var s=a.data("summernote");if(n)return s.invoke.apply(s,o.from(arguments));r.focus&&s.invoke("editor.focus")}return this}});var v=function(t,n,o,i){this.render=function(r){var a=e(t);if(o&&o.contents&&a.html(o.contents),o&&o.className&&a.addClass(o.className),o&&o.data&&e.each(o.data,function(e,t){a.attr("data-"+e,t)}),o&&o.click&&a.on("click",o.click),n){var s=a.find(".note-children-container");n.forEach(function(e){e.render(s.length?s:a)})}return i&&i(a,o),o&&o.callback&&o.callback(a),r&&r.append(a),a}},y={create:function(t,n){return function(){var o=e.isArray(arguments[0])?arguments[0]:[],i="object"==typeof arguments[1]?arguments[1]:arguments[0];return i&&i.children&&(o=i.children),new v(t,o,i,n)}}},b=y.create('<div class="note-editor note-frame panel panel-default"/>'),w=y.create('<div class="note-toolbar panel-heading"/>'),C=y.create('<div class="note-editing-area"/>'),N=y.create('<textarea class="note-codable"/>'),x=y.create('<div class="note-editable panel-body" contentEditable="true"/>'),E=y.create(['<div class="note-statusbar">','  <div class="note-resizebar">','    <div class="note-icon-bar"/>','    <div class="note-icon-bar"/>','    <div class="note-icon-bar"/>',"  </div>","</div>"].join("")),T=y.create('<div class="note-editor"/>'),S=y.create('<div class="note-editable" contentEditable="true"/>'),R=y.create('<div class="note-btn-group btn-group">'),k=y.create('<button type="button" class="note-btn btn btn-default btn-sm">',function(e,t){t&&t.tooltip&&e.attr({title:t.tooltip}).tooltip({container:"body",trigger:"hover",placement:"bottom"})}),A=y.create('<div class="dropdown-menu">',function(t,n){var o=e.isArray(n.items)?n.items.map(function(e){var t="string"==typeof e?e:e.value||"",o=n.template?n.template(e):e;return'<li><a href="#" data-value="'+t+'">'+o+"</a></li>"}).join(""):n.items;t.html(o)}),I=y.create('<div class="dropdown-menu note-check">',function(t,n){var o=e.isArray(n.items)?n.items.map(function(e){var t="string"==typeof e?e:e.value||"",o=n.template?n.template(e):e;return'<li><a href="#" data-value="'+t+'">'+O(n.checkClassName)+" "+o+"</a></li>"}).join(""):n.items;t.html(o)}),_=y.create('<div class="note-color-palette"/>',function(e,t){for(var n=[],o=0,i=t.colors.length;i>o;o++){for(var r=t.eventName,a=t.colors[o],s=[],l=0,c=a.length;c>l;l++){var d=a[l];s.push(['<button type="button" class="note-color-btn"','style="background-color:',d,'" ','data-event="',r,'" ','data-value="',d,'" ','title="',d,'" ','data-toggle="button" tabindex="-1"></button>'].join(""))}n.push('<div class="note-color-row">'+s.join("")+"</div>")}e.html(n.join("")),e.find(".note-color-btn").tooltip({container:"body",trigger:"hover",placement:"bottom"})}),L=y.create('<div class="modal" aria-hidden="false" tabindex="-1"/>',function(e,t){t.fade&&e.addClass("fade"),e.html(['<div class="modal-dialog">','  <div class="modal-content">',t.title?'    <div class="modal-header">      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>      <h4 class="modal-title">'+t.title+"</h4>    </div>":"",'    <div class="modal-body">'+t.body+"</div>",t.footer?'    <div class="modal-footer">'+t.footer+"</div>":"","  </div>","</div>"].join(""))}),D=y.create(['<div class="note-popover popover in">','  <div class="arrow"/>','  <div class="popover-content note-children-container"/>',"</div>"].join(""),function(e,t){var n="undefined"!=typeof t.direction?t.direction:"bottom";e.addClass(n),t.hideArrow&&e.find(".arrow").hide()}),O=function(e,t){return t=t||"i","<"+t+' class="'+e+'"/>'},P={editor:b,toolbar:w,editingArea:C,codable:N,editable:x,statusbar:E,airEditor:T,airEditable:S,buttonGroup:R,button:k,dropdown:A,dropdownCheck:I,palette:_,dialog:L,popover:D,icon:O,toggleBtn:function(e,t){e.toggleClass("disabled",!t),e.attr("disabled",!t)},toggleBtnActive:function(e,t){e.toggleClass("active",t)},onDialogShown:function(e,t){e.one("shown.bs.modal",t)},onDialogHidden:function(e,t){e.one("hidden.bs.modal",t)},showDialog:function(e){e.modal("show")},hideDialog:function(e){e.modal("hide")},createLayout:function(e,t){var n=(t.airMode?P.airEditor([P.editingArea([P.airEditable()])]):P.editor([P.toolbar(),P.editingArea([P.codable(),P.editable()]),P.statusbar()])).render();return n.insertAfter(e),{note:e,editor:n,toolbar:n.find(".note-toolbar"),editingArea:n.find(".note-editing-area"),editable:n.find(".note-editable"),codable:n.find(".note-codable"),statusbar:n.find(".note-statusbar")}},removeLayout:function(e,t){e.html(t.editable.html()),t.editor.remove(),e.show()}};e.summernote=e.summernote||{lang:{}},e.extend(e.summernote.lang,{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",clear:"Remove Font Style",height:"Line Height",name:"Font Family",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",size:"Font Size"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag image or text here",dropImage:"Drop image or Text",selectFromFiles:"Select from files",maximumFileSize:"Maximum file size",maximumFileSizeError:"Maximum file size exceeded.",url:"Image URL",remove:"Remove Image"},video:{video:"Video",videoLink:"Video Link",insert:"Insert Video",url:"Video URL?",providers:"(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style",extraKeys:"Extra keys"},help:{insertParagraph:"Insert Paragraph",undo:"Undoes the last command",redo:"Redoes the last command",tab:"Tab",untab:"Untab",bold:"Set a bold style",italic:"Set a italic style",underline:"Set a underline style",strikethrough:"Set a strikethrough style",removeFormat:"Clean a style",justifyLeft:"Set left align",justifyCenter:"Set center align",justifyRight:"Set right align",justifyFull:"Set full align",insertUnorderedList:"Toggle unordered list",insertOrderedList:"Toggle ordered list",outdent:"Outdent on current paragraph",indent:"Indent on current paragraph",formatPara:"Change current block's format as a paragraph(P tag)",formatH1:"Change current block's format as H1",formatH2:"Change current block's format as H2",formatH3:"Change current block's format as H3",formatH4:"Change current block's format as H4",formatH5:"Change current block's format as H5",formatH6:"Change current block's format as H6",insertHorizontalRule:"Insert horizontal rule","linkDialog.show":"Show Link Dialog"},history:{undo:"Undo",redo:"Redo"},specialChar:{specialChar:"SPECIAL CHARACTERS",select:"Select Special characters"}}});var M,H=function(){var e={BACKSPACE:8,TAB:9,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,B:66,E:69,I:73,J:74,K:75,L:76,R:82,S:83,U:85,V:86,Y:89,Z:90,SLASH:191,LEFTBRACKET:219,BACKSLASH:220,RIGHTBRACKET:221};return{isEdit:function(t){return o.contains([e.BACKSPACE,e.TAB,e.ENTER,e.SPACE],t)},isMove:function(t){return o.contains([e.LEFT,e.UP,e.RIGHT,e.DOWN],t)},nameFromCode:n.invertObject(e),code:e}}(),B=function(){var t=function(e,t){var n,i,r=e.parentElement(),a=document.body.createTextRange(),s=o.from(r.childNodes);for(n=0;n<s.length;n++)if(!p.isText(s[n])){if(a.moveToElementText(s[n]),a.compareEndPoints("StartToStart",e)>=0)break;i=s[n]}if(0!==n&&p.isText(s[n-1])){var l=document.body.createTextRange(),c=null;l.moveToElementText(i||r),l.collapse(!i),c=i?i.nextSibling:r.firstChild;var d=e.duplicate();d.setEndPoint("StartToStart",l);for(var u=d.text.replace(/[\r\n]/g,"").length;u>c.nodeValue.length&&c.nextSibling;)u-=c.nodeValue.length,c=c.nextSibling;c.nodeValue,t&&c.nextSibling&&p.isText(c.nextSibling)&&u===c.nodeValue.length&&(u-=c.nodeValue.length,c=c.nextSibling),r=c,n=u}return{cont:r,offset:n}},i=function(e){var t=function(e,i){var r,a;if(p.isText(e)){var s=p.listPrev(e,n.not(p.isText)),l=o.last(s).previousSibling;r=l||e.parentNode,i+=o.sum(o.tail(s),p.nodeLength),a=!l}else{if(r=e.childNodes[i]||e,p.isText(r))return t(r,0);i=0,a=!1}return{node:r,collapseToStart:a,offset:i}},i=document.body.createTextRange(),r=t(e.node,e.offset);return i.moveToElementText(r.node),i.collapse(r.collapseToStart),i.moveStart("character",r.offset),i},r=function(t,a,s,l){this.sc=t,this.so=a,this.ec=s,this.eo=l;var c=function(){if(h.isW3CRangeSupport){var e=document.createRange();return e.setStart(t,a),e.setEnd(s,l),e}var n=i({node:t,offset:a});return n.setEndPoint("EndToEnd",i({node:s,offset:l})),n};this.getPoints=function(){return{sc:t,so:a,ec:s,eo:l}},this.getStartPoint=function(){return{node:t,offset:a}},this.getEndPoint=function(){return{node:s,offset:l}},this.select=function(){var e=c();if(h.isW3CRangeSupport){var t=document.getSelection();t.rangeCount>0&&t.removeAllRanges(),t.addRange(e)}else e.select();return this},this.scrollIntoView=function(t){var n=e(t).height();return t.scrollTop+n<this.sc.offsetTop&&(t.scrollTop+=Math.abs(t.scrollTop+n-this.sc.offsetTop)),this},this.normalize=function(){var e=function(e,t){if(p.isVisiblePoint(e)&&!p.isEdgePoint(e)||p.isVisiblePoint(e)&&p.isRightEdgePoint(e)&&!t||p.isVisiblePoint(e)&&p.isLeftEdgePoint(e)&&t||p.isVisiblePoint(e)&&p.isBlock(e.node)&&p.isEmpty(e.node))return e;var n=p.ancestor(e.node,p.isBlock);if((p.isLeftEdgePointOf(e,n)||p.isVoid(p.prevPoint(e).node))&&!t||(p.isRightEdgePointOf(e,n)||p.isVoid(p.nextPoint(e).node))&&t){if(p.isVisiblePoint(e))return e;t=!t}var o=t?p.nextPointUntil(p.nextPoint(e),p.isVisiblePoint):p.prevPointUntil(p.prevPoint(e),p.isVisiblePoint);return o||e},t=e(this.getEndPoint(),!1),n=this.isCollapsed()?t:e(this.getStartPoint(),!0);return new r(n.node,n.offset,t.node,t.offset)},this.nodes=function(e,t){e=e||n.ok;var i=t&&t.includeAncestor,r=t&&t.fullyContains,a=this.getStartPoint(),s=this.getEndPoint(),l=[],c=[];return p.walkPoint(a,s,function(t){if(!p.isEditable(t.node)){var n;r?(p.isLeftEdgePoint(t)&&c.push(t.node),p.isRightEdgePoint(t)&&o.contains(c,t.node)&&(n=t.node)):n=i?p.ancestor(t.node,e):t.node,n&&e(n)&&l.push(n)}},!0),o.unique(l)},this.commonAncestor=function(){return p.commonAncestor(t,s)},this.expand=function(e){var n=p.ancestor(t,e),o=p.ancestor(s,e);if(!n&&!o)return new r(t,a,s,l);var i=this.getPoints();return n&&(i.sc=n,i.so=0),o&&(i.ec=o,i.eo=p.nodeLength(o)),new r(i.sc,i.so,i.ec,i.eo)},this.collapse=function(e){return e?new r(t,a,t,a):new r(s,l,s,l)},this.splitText=function(){var e=t===s,n=this.getPoints();return p.isText(s)&&!p.isEdgePoint(this.getEndPoint())&&s.splitText(l),p.isText(t)&&!p.isEdgePoint(this.getStartPoint())&&(n.sc=t.splitText(a),n.so=0,e&&(n.ec=n.sc,n.eo=l-a)),new r(n.sc,n.so,n.ec,n.eo)},this.deleteContents=function(){if(this.isCollapsed())return this;var t=this.splitText(),n=t.nodes(null,{fullyContains:!0}),i=p.prevPointUntil(t.getStartPoint(),function(e){return!o.contains(n,e.node)}),a=[];return e.each(n,function(e,t){var n=t.parentNode;i.node!==n&&1===p.nodeLength(n)&&a.push(n),p.remove(t,!1)}),e.each(a,function(e,t){p.remove(t,!1)}),new r(i.node,i.offset,i.node,i.offset).normalize()};var d=function(e){return function(){var n=p.ancestor(t,e);return!!n&&n===p.ancestor(s,e)}};this.isOnEditable=d(p.isEditable),this.isOnList=d(p.isList),this.isOnAnchor=d(p.isAnchor),this.isOnCell=d(p.isCell),this.isLeftEdgeOf=function(e){if(!p.isLeftEdgePoint(this.getStartPoint()))return!1;var t=p.ancestor(this.sc,e);return t&&p.isLeftEdgeOf(this.sc,t)},this.isCollapsed=function(){return t===s&&a===l},this.wrapBodyInlineWithPara=function(){if(p.isBodyContainer(t)&&p.isEmpty(t))return t.innerHTML=p.emptyPara,new r(t.firstChild,0,t.firstChild,0);var e=this.normalize();if(p.isParaInline(t)||p.isPara(t))return e;var i;if(p.isInline(e.sc)){var a=p.listAncestor(e.sc,n.not(p.isInline));i=o.last(a),p.isInline(i)||(i=a[a.length-2]||e.sc.childNodes[e.so])}else i=e.sc.childNodes[e.so>0?e.so-1:0];var s=p.listPrev(i,p.isParaInline).reverse();if(s=s.concat(p.listNext(i.nextSibling,p.isParaInline)),s.length){var l=p.wrap(o.head(s),"p");p.appendChildNodes(l,o.tail(s))}return this.normalize()},this.insertNode=function(e){var t=this.wrapBodyInlineWithPara().deleteContents(),n=p.splitPoint(t.getStartPoint(),p.isInline(e));return n.rightNode?n.rightNode.parentNode.insertBefore(e,n.rightNode):n.container.appendChild(e),e},this.pasteHTML=function(t){var n=e("<div></div>").html(t)[0],i=o.from(n.childNodes),r=this.wrapBodyInlineWithPara().deleteContents();return i.reverse().map(function(e){return r.insertNode(e)}).reverse()},this.toString=function(){var e=c();return h.isW3CRangeSupport?e.toString():e.text},this.getWordRange=function(e){var t=this.getEndPoint();if(!p.isCharPoint(t))return this;var n=p.prevPointUntil(t,function(e){return!p.isCharPoint(e)});return e&&(t=p.nextPointUntil(t,function(e){return!p.isCharPoint(e)})),new r(n.node,n.offset,t.node,t.offset)},this.bookmark=function(e){return{s:{path:p.makeOffsetPath(e,t),offset:a},e:{path:p.makeOffsetPath(e,s),offset:l}}},this.paraBookmark=function(e){return{s:{path:o.tail(p.makeOffsetPath(o.head(e),t)),offset:a},e:{path:o.tail(p.makeOffsetPath(o.last(e),s)),offset:l}}},this.getClientRects=function(){var e=c();return e.getClientRects()}};return{create:function(e,t,n,o){if(4===arguments.length)return new r(e,t,n,o);if(2===arguments.length)return n=e,o=t,new r(e,t,n,o);var i=this.createFromSelection();return i||1!==arguments.length?i:(i=this.createFromNode(arguments[0]),i.collapse(p.emptyPara===arguments[0].innerHTML))},createFromSelection:function(){var e,n,o,i;if(h.isW3CRangeSupport){var a=document.getSelection();if(!a||0===a.rangeCount)return null;if(p.isBody(a.anchorNode))return null;var s=a.getRangeAt(0);e=s.startContainer,n=s.startOffset,o=s.endContainer,i=s.endOffset}else{var l=document.selection.createRange(),c=l.duplicate();c.collapse(!1);var d=l;d.collapse(!0);var u=t(d,!0),f=t(c,!1);p.isText(u.node)&&p.isLeftEdgePoint(u)&&p.isTextNode(f.node)&&p.isRightEdgePoint(f)&&f.node.nextSibling===u.node&&(u=f),e=u.cont,n=u.offset,o=f.cont,i=f.offset}return new r(e,n,o,i)},createFromNode:function(e){var t=e,n=0,o=e,i=p.nodeLength(o);return p.isVoid(t)&&(n=p.listPrev(t).length-1,t=t.parentNode),p.isBR(o)?(i=p.listPrev(o).length-1,o=o.parentNode):p.isVoid(o)&&(i=p.listPrev(o).length,o=o.parentNode),this.create(t,n,o,i)},createFromNodeBefore:function(e){return this.createFromNode(e).collapse(!0)},createFromNodeAfter:function(e){return this.createFromNode(e).collapse()},createFromBookmark:function(e,t){var n=p.fromOffsetPath(e,t.s.path),o=t.s.offset,i=p.fromOffsetPath(e,t.e.path),a=t.e.offset;return new r(n,o,i,a)},createFromParaBookmark:function(e,t){var n=e.s.offset,i=e.e.offset,a=p.fromOffsetPath(o.head(t),e.s.path),s=p.fromOffsetPath(o.last(t),e.e.path);return new r(a,n,s,i)}}}(),F=function(){var t=function(t){return e.Deferred(function(n){e.extend(new FileReader,{onload:function(e){var t=e.target.result;n.resolve(t)},onerror:function(){n.reject(this)}}).readAsDataURL(t)}).promise()},n=function(t){return e.Deferred(function(n){var o=e("<img>");o.one("load",function(){o.off("error abort"),n.resolve(o)}).one("error abort",function(){o.off("load").detach(),n.reject(o)}).css({display:"none"}).appendTo(document.body).attr("src",t)}).promise()};return{readFileAsDataURL:t,createImage:n}}(),z=function(e){var t=[],n=-1,o=e[0],i=function(){var t=B.create(o),n={s:{path:[],offset:0},e:{path:[],offset:0}};return{contents:e.html(),bookmark:t?t.bookmark(o):n}},r=function(t){null!==t.contents&&e.html(t.contents),null!==t.bookmark&&B.createFromBookmark(o,t.bookmark).select()};this.rewind=function(){e.html()!==t[n].contents&&this.recordUndo(),n=0,r(t[n])},this.reset=function(){t=[],n=-1,e.html(""),this.recordUndo()},this.undo=function(){e.html()!==t[n].contents&&this.recordUndo(),n>0&&(n--,r(t[n]))},this.redo=function(){t.length-1>n&&(n++,r(t[n]))},this.recordUndo=function(){n++,t.length>n&&(t=t.slice(0,n)),t.push(i())}},U=function(){var t=function(t,n){if(h.jqueryVersion<1.9){var o={};return e.each(n,function(e,n){o[n]=t.css(n)}),o}return t.css.call(t,n)};this.fromNode=function(e){var n=["font-family","font-size","text-align","list-style-type","line-height"],o=t(e,n)||{};return o["font-size"]=parseInt(o["font-size"],10),o},this.stylePara=function(t,n){e.each(t.nodes(p.isPara,{includeAncestor:!0}),function(t,o){e(o).css(n)})},this.styleNodes=function(t,i){t=t.splitText();var r=i&&i.nodeName||"SPAN",a=!(!i||!i.expandClosestSibling),s=!(!i||!i.onlyPartialContains);if(t.isCollapsed())return[t.insertNode(p.create(r))];var l=p.makePredByNodeName(r),c=t.nodes(p.isText,{fullyContains:!0}).map(function(e){return p.singleChildAncestor(e,l)||p.wrap(e,r)});if(a){if(s){var d=t.nodes();l=n.and(l,function(e){return o.contains(d,e)})}return c.map(function(t){var n=p.withClosestSiblings(t,l),i=o.head(n),r=o.tail(n);
return e.each(r,function(e,t){p.appendChildNodes(i,t.childNodes),p.remove(t)}),o.head(n)})}return c},this.current=function(t){var n=e(p.isElement(t.sc)?t.sc:t.sc.parentNode),o=this.fromNode(n);try{o=e.extend(o,{"font-bold":document.queryCommandState("bold")?"bold":"normal","font-italic":document.queryCommandState("italic")?"italic":"normal","font-underline":document.queryCommandState("underline")?"underline":"normal","font-subscript":document.queryCommandState("subscript")?"subscript":"normal","font-superscript":document.queryCommandState("superscript")?"superscript":"normal","font-strikethrough":document.queryCommandState("strikethrough")?"strikethrough":"normal"})}catch(i){}if(t.isOnList()){var r=["circle","disc","disc-leading-zero","square"],a=e.inArray(o["list-style-type"],r)>-1;o["list-style"]=a?"unordered":"ordered"}else o["list-style"]="none";var s=p.ancestor(t.sc,p.isPara);if(s&&s.style["line-height"])o["line-height"]=s.style.lineHeight;else{var l=parseInt(o["line-height"],10)/parseInt(o["font-size"],10);o["line-height"]=l.toFixed(1)}return o.anchor=t.isOnAnchor()&&p.ancestor(t.sc,p.isAnchor),o.ancestors=p.listAncestor(t.sc,p.isEditable),o.range=t,o}},j=function(){var t=this;this.insertOrderedList=function(e){this.toggleList("OL",e)},this.insertUnorderedList=function(e){this.toggleList("UL",e)},this.indent=function(t){var i=this,r=B.create(t).wrapBodyInlineWithPara(),a=r.nodes(p.isPara,{includeAncestor:!0}),s=o.clusterBy(a,n.peq2("parentNode"));e.each(s,function(t,n){var r=o.head(n);p.isLi(r)?i.wrapList(n,r.parentNode.nodeName):e.each(n,function(t,n){e(n).css("marginLeft",function(e,t){return(parseInt(t,10)||0)+25})})}),r.select()},this.outdent=function(t){var i=this,r=B.create(t).wrapBodyInlineWithPara(),a=r.nodes(p.isPara,{includeAncestor:!0}),s=o.clusterBy(a,n.peq2("parentNode"));e.each(s,function(t,n){var r=o.head(n);p.isLi(r)?i.releaseList([n]):e.each(n,function(t,n){e(n).css("marginLeft",function(e,t){return t=parseInt(t,10)||0,t>25?t-25:""})})}),r.select()},this.toggleList=function(i,r){var a=B.create(r).wrapBodyInlineWithPara(),s=a.nodes(p.isPara,{includeAncestor:!0}),l=a.paraBookmark(s),c=o.clusterBy(s,n.peq2("parentNode"));if(o.find(s,p.isPurePara)){var d=[];e.each(c,function(e,n){d=d.concat(t.wrapList(n,i))}),s=d}else{var u=a.nodes(p.isList,{includeAncestor:!0}).filter(function(t){return!e.nodeName(t,i)});u.length?e.each(u,function(e,t){p.replace(t,i)}):s=this.releaseList(c,!0)}B.createFromParaBookmark(l,s).select()},this.wrapList=function(e,t){var n=o.head(e),i=o.last(e),r=p.isList(n.previousSibling)&&n.previousSibling,a=p.isList(i.nextSibling)&&i.nextSibling,s=r||p.insertAfter(p.create(t||"UL"),i);return e=e.map(function(e){return p.isPurePara(e)?p.replace(e,"LI"):e}),p.appendChildNodes(s,e),a&&(p.appendChildNodes(s,o.from(a.childNodes)),p.remove(a)),e},this.releaseList=function(t,n){var i=[];return e.each(t,function(t,r){var a=o.head(r),s=o.last(r),l=n?p.lastAncestor(a,p.isList):a.parentNode,c=l.childNodes.length>1?p.splitTree(l,{node:s.parentNode,offset:p.position(s)+1},{isSkipPaddingBlankHTML:!0}):null,d=p.splitTree(l,{node:a.parentNode,offset:p.position(a)},{isSkipPaddingBlankHTML:!0});r=n?p.listDescendant(d,p.isLi):o.from(d.childNodes).filter(p.isLi),(n||!p.isList(l.parentNode))&&(r=r.map(function(e){return p.replace(e,"P")})),e.each(o.from(r).reverse(),function(e,t){p.insertAfter(t,l)});var u=o.compact([l,d,c]);e.each(u,function(t,n){var o=[n].concat(p.listDescendant(n,p.isList));e.each(o.reverse(),function(e,t){p.nodeLength(t)||p.remove(t,!0)})}),i=i.concat(r)}),i}},q=function(){var t=new j;this.insertTab=function(e,t){var n=p.createText(new Array(t+1).join(p.NBSP_CHAR));e=e.deleteContents(),e.insertNode(n,!0),e=B.create(n,t),e.select()},this.insertParagraph=function(n){var o=B.create(n);o=o.deleteContents(),o=o.wrapBodyInlineWithPara();var i,r=p.ancestor(o.sc,p.isPara);if(r){if(p.isEmpty(r)&&p.isLi(r))return void t.toggleList(r.parentNode.nodeName);if(p.isEmpty(r)&&p.isPara(r)&&p.isBlockquote(r.parentNode))p.insertAfter(r,r.parentNode),i=r;else{i=p.splitTree(r,o.getStartPoint());var a=p.listDescendant(r,p.isEmptyAnchor);a=a.concat(p.listDescendant(i,p.isEmptyAnchor)),e.each(a,function(e,t){p.remove(t)}),(p.isHeading(i)||p.isPre(i))&&p.isEmpty(i)&&(i=p.replace(i,"p"))}}else{var s=o.sc.childNodes[o.so];i=e(p.emptyPara)[0],s?o.sc.insertBefore(i,s):o.sc.appendChild(i)}B.create(i,0).normalize().select().scrollIntoView(n)}},V=function(){this.tab=function(e,t){var n=p.ancestor(e.commonAncestor(),p.isCell),i=p.ancestor(n,p.isTable),r=p.listDescendant(i,p.isCell),a=o[t?"prev":"next"](r,n);a&&B.create(a,0).select()},this.createTable=function(t,n,o){for(var i,r=[],a=0;t>a;a++)r.push("<td>"+p.blank+"</td>");i=r.join("");for(var s,l=[],c=0;n>c;c++)l.push("<tr>"+i+"</tr>");s=l.join("");var d=e("<table>"+s+"</table>");return o&&o.tableClassName&&d.addClass(o.tableClassName),d[0]}},W="bogus",$=function(t){var n=this,i=t.layoutInfo.note,r=t.layoutInfo.editor,a=t.layoutInfo.editable,s=t.options,l=s.langInfo,c=a[0],d=null,u=new U,f=new V,m=new q,g=new j,v=new z(a);this.initialize=function(){a.on("keydown",function(e){e.keyCode===H.code.ENTER&&t.triggerEvent("enter",e),t.triggerEvent("keydown",e),s.shortcuts&&!e.isDefaultPrevented()&&n.handleKeyMap(e)}).on("keyup",function(e){t.triggerEvent("keyup",e)}).on("focus",function(e){t.triggerEvent("focus",e)}).on("blur",function(e){t.triggerEvent("blur",e)}).on("mousedown",function(e){t.triggerEvent("mousedown",e)}).on("mouseup",function(e){t.triggerEvent("mouseup",e)}).on("scroll",function(e){t.triggerEvent("scroll",e)}).on("paste",function(e){t.triggerEvent("paste",e)}),a.html(p.html(i)||p.emptyPara);var e=h.isMSIE?"DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted":"input";a.on(e,function(){t.triggerEvent("change",a.html())}),r.on("focusin",function(e){t.triggerEvent("focusin",e)}).on("focusout",function(e){t.triggerEvent("focusout",e)}),!s.airMode&&s.height&&this.setHeight(s.height),!s.airMode&&s.maxHeight&&a.css("max-height",s.maxHeight),!s.airMode&&s.minHeight&&a.css("min-height",s.minHeight),v.recordUndo()},this.destroy=function(){a.off()},this.handleKeyMap=function(e){var n=s.keyMap[h.isMac?"mac":"pc"],o=[];e.metaKey&&o.push("CMD"),e.ctrlKey&&!e.altKey&&o.push("CTRL"),e.shiftKey&&o.push("SHIFT");var i=H.nameFromCode[e.keyCode];i&&o.push(i);var r=n[o.join("+")];r?(e.preventDefault(),t.invoke(r)):H.isEdit(e.keyCode)&&this.afterCommand()},this.createRange=function(){return this.focus(),B.create(c)},this.saveRange=function(e){d=this.createRange(),e&&d.collapse().select()},this.restoreRange=function(){d&&(d.select(),this.focus())},this.saveTarget=function(e){a.data("target",e)},this.clearTarget=function(){a.removeData("target")},this.restoreTarget=function(){return a.data("target")},this.currentStyle=function(){var e=B.create();return e&&(e=e.normalize()),e?u.current(e):u.fromNode(a)},this.styleFromNode=function(e){return u.fromNode(e)},this.undo=function(){t.triggerEvent("before.command",a.html()),v.undo(),t.triggerEvent("change",a.html())},t.memo("help.undo",l.help.undo),this.redo=function(){t.triggerEvent("before.command",a.html()),v.redo(),t.triggerEvent("change",a.html())},t.memo("help.redo",l.help.redo);for(var y=this.beforeCommand=function(){t.triggerEvent("before.command",a.html()),n.focus()},b=this.afterCommand=function(e){v.recordUndo(),e||t.triggerEvent("change",a.html())},w=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","fontName"],C=0,N=w.length;N>C;C++)this[w[C]]=function(e){return function(t){y(),document.execCommand(e,!1,t),b(!0)}}(w[C]),t.memo("help."+w[C],l.help[w[C]]);this.tab=function(){var e=this.createRange();e.isCollapsed()&&e.isOnCell()?f.tab(e):(y(),m.insertTab(e,s.tabSize),b())},t.memo("help.tab",l.help.tab),this.untab=function(){var e=this.createRange();e.isCollapsed()&&e.isOnCell()&&f.tab(e,!0)},t.memo("help.untab",l.help.untab),this.wrapCommand=function(e){return function(){y(),e.apply(n,arguments),b()}},this.insertParagraph=this.wrapCommand(function(){m.insertParagraph(c)}),t.memo("help.insertParagraph",l.help.insertParagraph),this.insertOrderedList=this.wrapCommand(function(){g.insertOrderedList(c)}),t.memo("help.insertOrderedList",l.help.insertOrderedList),this.insertUnorderedList=this.wrapCommand(function(){g.insertUnorderedList(c)}),t.memo("help.insertUnorderedList",l.help.insertUnorderedList),this.indent=this.wrapCommand(function(){g.indent(c)}),t.memo("help.indent",l.help.indent),this.outdent=this.wrapCommand(function(){g.outdent(c)}),t.memo("help.outdent",l.help.outdent),this.insertImage=function(e,n){return F.createImage(e,n).then(function(e){y(),"function"==typeof n?n(e):("string"==typeof n&&e.attr("data-filename",n),e.css("width",Math.min(a.width(),e.width()))),e.show(),B.create(c).insertNode(e[0]),B.createFromNodeAfter(e[0]).select(),b()}).fail(function(e){t.triggerEvent("image.upload.error",e)})},this.insertImages=function(o){e.each(o,function(e,o){var i=o.name;s.maximumImageFileSize&&s.maximumImageFileSize<o.size?t.triggerEvent("image.upload.error",l.image.maximumFileSizeError):F.readFileAsDataURL(o).then(function(e){return n.insertImage(e,i)}).fail(function(){t.triggerEvent("image.upload.error")})})},this.insertImagesOrCallback=function(e){var n=s.callbacks;n.onImageUpload?t.triggerEvent("image.upload",e):this.insertImages(e)},this.insertNode=this.wrapCommand(function(e){var t=this.createRange();t.insertNode(e),B.createFromNodeAfter(e).select()}),this.insertText=this.wrapCommand(function(e){var t=this.createRange(),n=t.insertNode(p.createText(e));B.create(n,p.nodeLength(n)).select()}),this.getSelectedText=function(){var e=this.createRange();return e.isOnAnchor()&&(e=B.createFromNode(p.ancestor(e.sc,p.isAnchor))),e.toString()},this.pasteHTML=this.wrapCommand(function(e){var t=this.createRange().pasteHTML(e);B.createFromNodeAfter(o.last(t)).select()}),this.formatBlock=this.wrapCommand(function(e){e=h.isMSIE?"<"+e+">":e,document.execCommand("FormatBlock",!1,e)}),this.formatPara=function(){this.formatBlock("P")},t.memo("help.formatPara",l.help.formatPara);for(var C=1;6>=C;C++)this["formatH"+C]=function(e){return function(){this.formatBlock("H"+e)}}(C),t.memo("help.formatH"+C,l.help["formatH"+C]);this.fontSize=function(t){var n=this.createRange();if(n&&n.isCollapsed()){var i=u.styleNodes(n),r=o.head(i);e(i).css({"font-size":t+"px"}),r&&!p.nodeLength(r)&&(r.innerHTML=p.ZERO_WIDTH_NBSP_CHAR,B.createFromNodeAfter(r.firstChild).select(),a.data(W,r))}else y(),e(u.styleNodes(n)).css({"font-size":t+"px"}),b()},this.insertHorizontalRule=this.wrapCommand(function(){var e=this.createRange().insertNode(p.create("HR"));e.nextSibling&&B.create(e.nextSibling,0).normalize().select()}),t.memo("help.insertHorizontalRule",l.help.insertHorizontalRule),this.removeBogus=function(){var e=a.data(W);if(e){var t=o.find(o.from(e.childNodes),p.isText),n=t.nodeValue.indexOf(p.ZERO_WIDTH_NBSP_CHAR);-1!==n&&t.deleteData(n,1),p.isEmpty(e)&&p.remove(e),a.removeData(W)}},this.lineHeight=this.wrapCommand(function(e){u.stylePara(this.createRange(),{lineHeight:e})}),this.unlink=function(){var e=this.createRange();if(e.isOnAnchor()){var t=p.ancestor(e.sc,p.isAnchor);e=B.createFromNode(t),e.select(),y(),document.execCommand("unlink"),b()}},this.createLink=this.wrapCommand(function(t){var n=t.url,i=t.text,r=t.isNewWindow,a=t.range||this.createRange(),l=a.toString()!==i;s.onCreateLink&&(n=s.onCreateLink(n));var c=[];if(l){a=a.deleteContents();var d=a.insertNode(e("<A>"+i+"</A>")[0]);c.push(d)}else c=u.styleNodes(a,{nodeName:"A",expandClosestSibling:!0,onlyPartialContains:!0});e.each(c,function(t,o){e(o).attr("href",n),r?e(o).attr("target","_blank"):e(o).removeAttr("target")});var h=B.createFromNodeBefore(o.head(c)),f=h.getStartPoint(),m=B.createFromNodeAfter(o.last(c)),p=m.getEndPoint();B.create(f.node,f.offset,p.node,p.offset).select()}),this.getLinkInfo=function(){var t=this.createRange().expand(p.isAnchor),n=e(o.head(t.nodes(p.isAnchor)));return{range:t,text:t.toString(),isNewWindow:n.length?"_blank"===n.attr("target"):!1,url:n.length?n.attr("href"):""}},this.color=this.wrapCommand(function(e){var t=e.foreColor,n=e.backColor;t&&document.execCommand("foreColor",!1,t),n&&document.execCommand("backColor",!1,n)}),this.insertTable=this.wrapCommand(function(e){var t=e.split("x"),n=this.createRange().deleteContents();n.insertNode(f.createTable(t[0],t[1],s))}),this.floatMe=this.wrapCommand(function(t){var n=e(this.restoreTarget());n.css("float",t)}),this.resize=this.wrapCommand(function(t){var n=e(this.restoreTarget());n.css({width:100*t+"%",height:""})}),this.resizeTo=function(e,t,n){var o;if(n){var i=e.y/e.x,r=t.data("ratio");o={width:r>i?e.x:e.y/r,height:r>i?e.x*r:e.y}}else o={width:e.x,height:e.y};t.css(o)},this.removeMedia=this.wrapCommand(function(){var n=e(this.restoreTarget()).detach();t.triggerEvent("media.delete",n,a)}),this.hasFocus=function(){return a.is(":focus")},this.focus=function(){this.hasFocus()||a.focus()},this.isEmpty=function(){return p.isEmpty(a[0])||p.emptyPara===a.html()},this.empty=function(){t.invoke("code",p.emptyPara)},this.setHeight=function(e){a.outerHeight(e)}},K=function(t){var n=this,i=t.layoutInfo.editable;this.events={"summernote.keydown":function(e,o){n.needKeydownHook()&&(o.ctrlKey||o.metaKey)&&o.keyCode===H.code.V&&(t.invoke("editor.saveRange"),n.$paste.focus(),setTimeout(function(){n.pasteByHook()},0))}},this.needKeydownHook=function(){return h.isMSIE&&h.browserVersion>10||h.isFF},this.initialize=function(){this.needKeydownHook()?(this.$paste=e("<div />").attr("contenteditable",!0).css({position:"absolute",left:-1e5,opacity:0}),i.before(this.$paste),this.$paste.on("paste",function(e){t.triggerEvent("paste",e)})):i.on("paste",this.pasteByEvent)},this.destroy=function(){this.needKeydownHook()&&(this.$paste.remove(),this.$paste=null)},this.pasteByHook=function(){var n=this.$paste[0].firstChild;if(p.isImg(n)){for(var o=n.src,i=atob(o.split(",")[1]),r=new Uint8Array(i.length),a=0;a<i.length;a++)r[a]=i.charCodeAt(a);var s=new Blob([r],{type:"image/png"});s.name="clipboard.png",t.invoke("editor.restoreRange"),t.invoke("editor.focus"),t.invoke("editor.insertImagesOrCallback",[s])}else{var l=e("<div />").html(this.$paste.html()).html();t.invoke("editor.restoreRange"),t.invoke("editor.focus"),l&&t.invoke("editor.pasteHTML",l)}this.$paste.empty()},this.pasteByEvent=function(e){var n=e.originalEvent.clipboardData;if(n&&n.items&&n.items.length){var i=o.head(n.items);"file"===i.kind&&-1!==i.type.indexOf("image/")&&t.invoke("editor.insertImagesOrCallback",[i.getAsFile()]),t.invoke("editor.afterCommand")}}},G=function(t){var n=e(document),o=t.layoutInfo.editor,i=t.layoutInfo.editable,r=t.options,a=r.langInfo,s=e(['<div class="note-dropzone">','  <div class="note-dropzone-message"/>',"</div>"].join("")).prependTo(o);this.initialize=function(){r.disableDragAndDrop?n.on("drop",function(e){e.preventDefault()}):this.attachDragAndDropEvent()},this.attachDragAndDropEvent=function(){var r=e(),l=s.find(".note-dropzone-message");n.on("dragenter",function(e){var n=t.invoke("codeview.isActivated"),i=o.width()>0&&o.height()>0;n||r.length||!i||(o.addClass("dragover"),s.width(o.width()),s.height(o.height()),l.text(a.image.dragImageHere)),r=r.add(e.target)}).on("dragleave",function(e){r=r.not(e.target),r.length||o.removeClass("dragover")}).on("drop",function(){r=e(),o.removeClass("dragover")}),s.on("dragenter",function(){s.addClass("hover"),l.text(a.image.dropImage)}).on("dragleave",function(){s.removeClass("hover"),l.text(a.image.dragImageHere)}),s.on("drop",function(n){var o=n.originalEvent.dataTransfer;o&&o.files&&o.files.length?(n.preventDefault(),i.focus(),t.invoke("editor.insertImagesOrCallback",o.files)):e.each(o.types,function(n,i){var r=o.getData(i);i.toLowerCase().indexOf("text")>-1?t.invoke("editor.pasteHTML",r):e(r).each(function(){t.invoke("editor.insertNode",this)})})}).on("dragover",!1)}};h.hasCodeMirror&&(h.isSupportAmd?require(["codemirror"],function(e){M=e}):M=window.CodeMirror);var Y=function(e){var t=e.layoutInfo.editor,n=e.layoutInfo.editable,o=e.layoutInfo.codable,i=e.options;this.sync=function(){var e=this.isActivated();e&&h.hasCodeMirror&&o.data("cmEditor").save()},this.isActivated=function(){return t.hasClass("codeview")},this.toggle=function(){this.isActivated()?this.deactivate():this.activate(),e.triggerEvent("codeview.toggled")},this.activate=function(){if(o.val(p.html(n,i.prettifyHtml)),o.height(n.height()),e.invoke("toolbar.updateCodeview",!0),t.addClass("codeview"),o.focus(),h.hasCodeMirror){var r=M.fromTextArea(o[0],i.codemirror);if(i.codemirror.tern){var a=new M.TernServer(i.codemirror.tern);r.ternServer=a,r.on("cursorActivity",function(e){a.updateArgHints(e)})}r.setSize(null,n.outerHeight()),o.data("cmEditor",r)}},this.deactivate=function(){if(h.hasCodeMirror){var r=o.data("cmEditor");o.val(r.getValue()),r.toTextArea()}var a=p.value(o,i.prettifyHtml)||p.emptyPara,s=n.html()!==a;n.html(a),n.height(i.height?o.height():"auto"),t.removeClass("codeview"),s&&e.triggerEvent("change",n.html(),n),n.focus(),e.invoke("toolbar.updateCodeview",!1)},this.destroy=function(){this.isActivated()&&this.deactivate()}},X=24,Q=function(t){var n=e(document),o=t.layoutInfo.statusbar,i=t.layoutInfo.editable,r=t.options;this.initialize=function(){r.airMode||r.disableResizeEditor||o.on("mousedown",function(e){e.preventDefault(),e.stopPropagation();var t=i.offset().top-n.scrollTop();n.on("mousemove",function(e){var n=e.clientY-(t+X);n=r.minheight>0?Math.max(n,r.minheight):n,n=r.maxHeight>0?Math.min(n,r.maxHeight):n,i.height(n)}).one("mouseup",function(){n.off("mousemove")})})},this.destroy=function(){o.off()}},Z=function(t){var n=t.layoutInfo.editor,o=t.layoutInfo.toolbar,i=t.layoutInfo.editable,r=t.layoutInfo.codable,a=e(window),s=e("html, body");this.toggle=function(){var e=function(e){i.css("height",e.h),r.css("height",e.h),r.data("cmeditor")&&r.data("cmeditor").setsize(null,e.h)};n.toggleClass("fullscreen"),this.isFullscreen()?(i.data("orgHeight",i.css("height")),a.on("resize",function(){e({h:a.height()-o.outerHeight()})}).trigger("resize"),s.css("overflow","hidden")):(a.off("resize"),e({h:i.data("orgHeight")}),s.css("overflow","visible")),t.invoke("toolbar.updateFullscreen",this.isFullscreen())},this.isFullscreen=function(){return n.hasClass("fullscreen")}},J=function(t){var n=this,o=e(document),i=t.layoutInfo.editingArea,r=t.options;this.events={"summernote.mousedown":function(e,t){n.update(t.target)&&t.preventDefault()},"summernote.keyup summernote.scroll summernote.change summernote.dialog.shown":function(){n.update()}},this.initialize=function(){this.$handle=e(['<div class="note-handle">','<div class="note-control-selection">','<div class="note-control-selection-bg"></div>','<div class="note-control-holder note-control-nw"></div>','<div class="note-control-holder note-control-ne"></div>','<div class="note-control-holder note-control-sw"></div>','<div class="',r.disableResizeImage?"note-control-holder":"note-control-sizing",' note-control-se"></div>',r.disableResizeImage?"":'<div class="note-control-selection-info"></div>',"</div>","</div>"].join("")).prependTo(i),this.$handle.on("mousedown",function(e){if(p.isControlSizing(e.target)){e.preventDefault(),e.stopPropagation();var i=n.$handle.find(".note-control-selection").data("target"),r=i.offset(),a=o.scrollTop();o.on("mousemove",function(e){t.invoke("editor.resizeTo",{x:e.clientX-r.left,y:e.clientY-(r.top-a)},i,!e.shiftKey),n.update(i[0])}).one("mouseup",function(e){e.preventDefault(),o.off("mousemove"),t.invoke("editor.afterCommand")}),i.data("ratio")||i.data("ratio",i.height()/i.width())}})},this.destroy=function(){this.$handle.remove()},this.update=function(n){var o=p.isImg(n),i=this.$handle.find(".note-control-selection");if(t.invoke("imagePopover.update",n),o){var r=e(n),a=r.position(),s={w:r.outerWidth(!0),h:r.outerHeight(!0)};i.css({display:"block",left:a.left,top:a.top,width:s.w,height:s.h}).data("target",r);var l=s.w+"x"+s.h;i.find(".note-control-selection-info").text(l),t.invoke("editor.saveTarget",n)}else this.hide();return o},this.hide=function(){t.invoke("editor.clearTarget"),this.$handle.children().hide()}},ee=function(t){var n=this,i="http://",r=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|mailto:[A-Z0-9._%+-]+@)?(www\.)?(.+)$/i;this.events={"summernote.keyup":function(e,t){t.isDefaultPrevented()||n.handleKeyup(t)},"summernote.keydown":function(e,t){n.handleKeydown(t)}},this.initialize=function(){this.lastWordRange=null},this.destroy=function(){this.lastWordRange=null},this.replace=function(){if(this.lastWordRange){var n=this.lastWordRange.toString(),o=n.match(r);if(o&&(o[1]||o[2])){var a=o[1]?n:i+n,s=e("<a />").html(n).attr("href",a)[0];this.lastWordRange.insertNode(s),this.lastWordRange=null,t.invoke("editor.focus")}}},this.handleKeydown=function(e){if(o.contains([H.code.ENTER,H.code.SPACE],e.keyCode)){var n=t.invoke("editor.createRange").getWordRange();this.lastWordRange=n}},this.handleKeyup=function(e){o.contains([H.code.ENTER,H.code.SPACE],e.keyCode)&&this.replace()}},te=function(e){var t=e.layoutInfo.note;this.events={"summernote.change":function(){t.val(e.invoke("code"))}},this.shouldInitialize=function(){return p.isTextarea(t[0])}},ne=function(t){var n=this,o=t.layoutInfo.editingArea,i=t.options;this.events={"summernote.init summernote.change":function(){n.update()},"summernote.codeview.toggled":function(){n.update()}},this.shouldInitialize=function(){return!!i.placeholder},this.initialize=function(){this.$placeholder=e('<div class="note-placeholder">'),this.$placeholder.on("click",function(){t.invoke("focus")}).text(i.placeholder).prependTo(o)},this.destroy=function(){this.$placeholder.remove()},this.update=function(){var e=!t.invoke("codeview.isActivated")&&t.invoke("editor.isEmpty");this.$placeholder.toggle(e)}},oe=function(t){var i=this,r=e.summernote.ui,a=t.layoutInfo.toolbar,s=t.options,l=s.langInfo,c=n.invertObject(s.keyMap[h.isMac?"mac":"pc"]),d=this.representShortcut=function(e){var t=c[e];return h.isMac&&(t=t.replace("CMD","⌘").replace("SHIFT","⇧")),t=t.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]")," ("+t+")"};this.initialize=function(){this.addToolbarButtons(),this.addImagePopoverButtons(),this.addLinkPopoverButtons(),this.fontInstalledMap={}},this.destroy=function(){delete this.fontInstalledMap},this.isFontInstalled=function(e){return i.fontInstalledMap.hasOwnProperty(e)||(i.fontInstalledMap[e]=h.isFontInstalled(e)||o.contains(s.fontNamesIgnoreCheck,e)),i.fontInstalledMap[e]},this.addToolbarButtons=function(){t.memo("button.style",function(){return r.buttonGroup([r.button({className:"dropdown-toggle",contents:r.icon(s.icons.magic)+" "+r.icon(s.icons.caret,"span"),tooltip:l.style.style,data:{toggle:"dropdown"}}),r.dropdown({className:"dropdown-style",items:t.options.styleTags,template:function(e){"string"==typeof e&&(e={tag:e,title:e});var t=e.tag,n=e.title,o=e.style?' style="'+e.style+'" ':"",i=e.className?' className="'+e.className+'"':"";return"<"+t+o+i+">"+n+"</"+t+">"},click:t.createInvokeHandler("editor.formatBlock")})]).render()}),t.memo("button.bold",function(){return r.button({className:"note-btn-bold",contents:r.icon(s.icons.bold),tooltip:l.font.bold+d("bold"),click:t.createInvokeHandler("editor.bold")}).render()}),t.memo("button.italic",function(){return r.button({className:"note-btn-italic",contents:r.icon(s.icons.italic),tooltip:l.font.italic+d("italic"),click:t.createInvokeHandler("editor.italic")}).render()}),t.memo("button.underline",function(){return r.button({className:"note-btn-underline",contents:r.icon(s.icons.underline),tooltip:l.font.underline+d("underline"),click:t.createInvokeHandler("editor.underline")}).render()}),t.memo("button.clear",function(){return r.button({contents:r.icon(s.icons.eraser),tooltip:l.font.clear+d("removeFormat"),click:t.createInvokeHandler("editor.removeFormat")}).render()}),t.memo("button.strikethrough",function(){return r.button({className:"note-btn-strikethrough",contents:r.icon(s.icons.strikethrough),tooltip:l.font.strikethrough+d("strikethrough"),click:t.createInvokeHandler("editor.strikethrough")}).render()}),t.memo("button.superscript",function(){return r.button({className:"note-btn-superscript",contents:r.icon(s.icons.superscript),tooltip:l.font.superscript,click:t.createInvokeHandler("editor.superscript")}).render()}),t.memo("button.subscript",function(){return r.button({className:"note-btn-subscript",contents:r.icon(s.icons.subscript),tooltip:l.font.subscript,click:t.createInvokeHandler("editor.subscript")}).render()}),t.memo("button.fontname",function(){return r.buttonGroup([r.button({className:"dropdown-toggle",contents:'<span class="note-current-fontname"/> '+r.icon(s.icons.caret,"span"),tooltip:l.font.name,data:{toggle:"dropdown"}}),r.dropdownCheck({className:"dropdown-fontname",checkClassName:s.icons.menuCheck,items:s.fontNames.filter(i.isFontInstalled),template:function(e){return'<span style="font-family:'+e+'">'+e+"</span>"},click:t.createInvokeHandler("editor.fontName")})]).render()}),t.memo("button.fontsize",function(){return r.buttonGroup([r.button({className:"dropdown-toggle",contents:'<span class="note-current-fontsize"/>'+r.icon(s.icons.caret,"span"),tooltip:l.font.size,data:{toggle:"dropdown"}}),r.dropdownCheck({className:"dropdown-fontsize",checkClassName:s.icons.menuCheck,items:s.fontSizes,click:t.createInvokeHandler("editor.fontSize")})]).render()}),t.memo("button.color",function(){return r.buttonGroup({className:"note-color",children:[r.button({className:"note-current-color-button",contents:r.icon(s.icons.font+" note-recent-color"),tooltip:l.color.recent,click:function(n){var o=e(n.currentTarget);t.invoke("editor.color",{backColor:o.attr("data-backColor"),foreColor:o.attr("data-foreColor")})},callback:function(e){var t=e.find(".note-recent-color");t.css("background-color","#FFFF00"),e.attr("data-backColor","#FFFF00")}}),r.button({className:"dropdown-toggle",contents:r.icon(s.icons.caret,"span"),tooltip:l.color.more,data:{toggle:"dropdown"}}),r.dropdown({items:["<li>",'<div class="btn-group">','  <div class="note-palette-title">'+l.color.background+"</div>","  <div>",'    <button type="button" class="note-color-reset btn btn-default" data-event="backColor" data-value="inherit">',l.color.transparent,"    </button>","  </div>",'  <div class="note-holder" data-event="backColor"/>',"</div>",'<div class="btn-group">','  <div class="note-palette-title">'+l.color.foreground+"</div>","  <div>",'    <button type="button" class="note-color-reset btn btn-default" data-event="removeFormat" data-value="foreColor">',l.color.resetToDefault,"    </button>","  </div>",'  <div class="note-holder" data-event="foreColor"/>',"</div>","</li>"].join(""),callback:function(t){t.find(".note-holder").each(function(){var t=e(this);t.append(r.palette({colors:s.colors,eventName:t.data("event")}).render())})},click:function(n){var o=e(n.target),i=o.data("event"),r=o.data("value");if(i&&r){var a="backColor"===i?"background-color":"color",s=o.closest(".note-color").find(".note-recent-color"),l=o.closest(".note-color").find(".note-current-color-button");s.css(a,r),l.attr("data-"+i,r),t.invoke("editor."+i,r)}}})]}).render()}),t.memo("button.ul",function(){return r.button({contents:r.icon(s.icons.unorderedlist),tooltip:l.lists.unordered+d("insertUnorderedList"),click:t.createInvokeHandler("editor.insertUnorderedList")}).render()}),t.memo("button.ol",function(){return r.button({contents:r.icon(s.icons.orderedlist),tooltip:l.lists.ordered+d("insertOrderedList"),click:t.createInvokeHandler("editor.insertOrderedList")}).render()});var o=r.button({contents:r.icon(s.icons.alignLeft),tooltip:l.paragraph.left+d("justifyLeft"),click:t.createInvokeHandler("editor.justifyLeft")}),a=r.button({contents:r.icon(s.icons.alignCenter),tooltip:l.paragraph.center+d("justifyCenter"),click:t.createInvokeHandler("editor.justifyCenter")}),c=r.button({contents:r.icon(s.icons.alignRight),tooltip:l.paragraph.right+d("justifyRight"),click:t.createInvokeHandler("editor.justifyRight")}),u=r.button({contents:r.icon(s.icons.alignJustify),tooltip:l.paragraph.justify+d("justifyFull"),click:t.createInvokeHandler("editor.justifyFull")}),h=r.button({contents:r.icon(s.icons.outdent),tooltip:l.paragraph.outdent+d("outdent"),click:t.createInvokeHandler("editor.outdent")}),f=r.button({contents:r.icon(s.icons.indent),tooltip:l.paragraph.indent+d("indent"),click:t.createInvokeHandler("editor.indent")});t.memo("button.justifyLeft",n.invoke(o,"render")),t.memo("button.justifyCenter",n.invoke(a,"render")),t.memo("button.justifyRight",n.invoke(c,"render")),t.memo("button.justifyFull",n.invoke(u,"render")),t.memo("button.outdent",n.invoke(h,"render")),t.memo("button.indent",n.invoke(f,"render")),t.memo("button.paragraph",function(){return r.buttonGroup([r.button({className:"dropdown-toggle",contents:r.icon(s.icons.alignLeft)+" "+r.icon(s.icons.caret,"span"),tooltip:l.paragraph.paragraph,data:{toggle:"dropdown"}}),r.dropdown([r.buttonGroup({className:"note-align",children:[o,a,c,u]}),r.buttonGroup({className:"note-list",children:[h,f]})])]).render()}),t.memo("button.height",function(){return r.buttonGroup([r.button({className:"dropdown-toggle",contents:r.icon(s.icons.textHeight)+" "+r.icon(s.icons.caret,"span"),tooltip:l.font.height,data:{toggle:"dropdown"}}),r.dropdownCheck({items:s.lineHeights,checkClassName:s.icons.menuCheck,className:"dropdown-line-height",click:t.createInvokeHandler("editor.lineHeight")})]).render()}),t.memo("button.table",function(){return r.buttonGroup([r.button({className:"dropdown-toggle",contents:r.icon(s.icons.table)+" "+r.icon(s.icons.caret,"span"),tooltip:l.table.table,data:{toggle:"dropdown"}}),r.dropdown({className:"note-table",items:['<div class="note-dimension-picker">','  <div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"/>','  <div class="note-dimension-picker-highlighted"/>','  <div class="note-dimension-picker-unhighlighted"/>',"</div>",'<div class="note-dimension-display">1 x 1</div>'].join("")})],{callback:function(e){var n=e.find(".note-dimension-picker-mousecatcher");n.css({width:s.insertTableMaxSize.col+"em",height:s.insertTableMaxSize.row+"em"}).mousedown(t.createInvokeHandler("editor.insertTable")).on("mousemove",i.tableMoveHandler)}}).render()}),t.memo("button.link",function(){return r.button({contents:r.icon(s.icons.link),tooltip:l.link.link,click:t.createInvokeHandler("linkDialog.show")}).render()}),t.memo("button.picture",function(){return r.button({contents:r.icon(s.icons.picture),tooltip:l.image.image,click:t.createInvokeHandler("imageDialog.show")}).render()}),t.memo("button.video",function(){return r.button({contents:r.icon(s.icons.video),tooltip:l.video.video,click:t.createInvokeHandler("videoDialog.show")}).render()}),t.memo("button.hr",function(){return r.button({contents:r.icon(s.icons.minus),tooltip:l.hr.insert+d("insertHorizontalRule"),click:t.createInvokeHandler("editor.insertHorizontalRule")}).render()}),t.memo("button.fullscreen",function(){return r.button({className:"btn-fullscreen",contents:r.icon(s.icons.arrowsAlt),tooltip:l.options.fullscreen,click:t.createInvokeHandler("fullscreen.toggle")}).render()}),t.memo("button.codeview",function(){return r.button({className:"btn-codeview",contents:r.icon(s.icons.code),tooltip:l.options.codeview,click:t.createInvokeHandler("codeview.toggle")}).render()}),t.memo("button.redo",function(){return r.button({contents:r.icon(s.icons.redo),tooltip:l.history.redo+d("redo"),click:t.createInvokeHandler("editor.redo")}).render()}),t.memo("button.undo",function(){return r.button({contents:r.icon(s.icons.undo),tooltip:l.history.undo+d("undo"),click:t.createInvokeHandler("editor.undo")}).render()}),t.memo("button.help",function(){return r.button({contents:r.icon(s.icons.question),tooltip:l.options.help,click:t.createInvokeHandler("helpDialog.show")
}).render()})},this.addImagePopoverButtons=function(){t.memo("button.imageSize100",function(){return r.button({contents:'<span class="note-fontsize-10">100%</span>',tooltip:l.image.resizeFull,click:t.createInvokeHandler("editor.resize","1")}).render()}),t.memo("button.imageSize50",function(){return r.button({contents:'<span class="note-fontsize-10">50%</span>',tooltip:l.image.resizeHalf,click:t.createInvokeHandler("editor.resize","0.5")}).render()}),t.memo("button.imageSize25",function(){return r.button({contents:'<span class="note-fontsize-10">25%</span>',tooltip:l.image.resizeQuarter,click:t.createInvokeHandler("editor.resize","0.25")}).render()}),t.memo("button.floatLeft",function(){return r.button({contents:r.icon(s.icons.alignLeft),tooltip:l.image.floatLeft,click:t.createInvokeHandler("editor.floatMe","left")}).render()}),t.memo("button.floatRight",function(){return r.button({contents:r.icon(s.icons.alignRight),tooltip:l.image.floatRight,click:t.createInvokeHandler("editor.floatMe","right")}).render()}),t.memo("button.floatNone",function(){return r.button({contents:r.icon(s.icons.alignJustify),tooltip:l.image.floatNone,click:t.createInvokeHandler("editor.floatMe","none")}).render()}),t.memo("button.removeMedia",function(){return r.button({contents:r.icon(s.icons.trash),tooltip:l.image.remove,click:t.createInvokeHandler("editor.removeMedia")}).render()})},this.addLinkPopoverButtons=function(){t.memo("button.linkDialogShow",function(){return r.button({contents:r.icon(s.icons.link),tooltip:l.link.edit,click:t.createInvokeHandler("linkDialog.show")}).render()}),t.memo("button.unlink",function(){return r.button({contents:r.icon(s.icons.unlink),tooltip:l.link.unlink,click:t.createInvokeHandler("editor.unlink")}).render()})},this.build=function(e,n){for(var o=0,i=n.length;i>o;o++){for(var a=n[o],s=a[0],l=a[1],c=r.buttonGroup({className:"note-"+s}).render(),d=0,u=l.length;u>d;d++){var h=t.memo("button."+l[d]);h&&c.append("function"==typeof h?h(t):h)}c.appendTo(e)}},this.updateCurrentStyle=function(){var n=t.invoke("editor.currentStyle");if(this.updateBtnStates({".note-btn-bold":function(){return"bold"===n["font-bold"]},".note-btn-italic":function(){return"italic"===n["font-italic"]},".note-btn-underline":function(){return"underline"===n["font-underline"]},".note-btn-subscript":function(){return"subscript"===n["font-subscript"]},".note-btn-superscript":function(){return"superscript"===n["font-superscript"]},".note-btn-strikethrough":function(){return"strikethrough"===n["font-strikethrough"]}}),n["font-family"]){var r=n["font-family"].split(",").map(function(e){return e.replace(/[\'\"]/g,"").replace(/\s+$/,"").replace(/^\s+/,"")}),s=o.find(r,i.isFontInstalled);a.find(".dropdown-fontname li a").each(function(){var t=e(this).data("value")+""==s+"";this.className=t?"checked":""}),a.find(".note-current-fontname").text(s)}if(n["font-size"]){var l=n["font-size"];a.find(".dropdown-fontsize li a").each(function(){var t=e(this).data("value")+""==l+"";this.className=t?"checked":""}),a.find(".note-current-fontsize").text(l)}if(n["line-height"]){var c=n["line-height"];a.find(".dropdown-line-height li a").each(function(){var t=e(this).data("value")+""==c+"";this.className=t?"checked":""})}},this.updateBtnStates=function(t){e.each(t,function(e,t){r.toggleBtnActive(a.find(e),t())})},this.tableMoveHandler=function(t){var n,o=18,i=e(t.target.parentNode),r=i.next(),a=i.find(".note-dimension-picker-mousecatcher"),l=i.find(".note-dimension-picker-highlighted"),c=i.find(".note-dimension-picker-unhighlighted");if(void 0===t.offsetX){var d=e(t.target).offset();n={x:t.pageX-d.left,y:t.pageY-d.top}}else n={x:t.offsetX,y:t.offsetY};var u={c:Math.ceil(n.x/o)||1,r:Math.ceil(n.y/o)||1};l.css({width:u.c+"em",height:u.r+"em"}),a.data("value",u.c+"x"+u.r),3<u.c&&u.c<s.insertTableMaxSize.col&&c.css({width:u.c+1+"em"}),3<u.r&&u.r<s.insertTableMaxSize.row&&c.css({height:u.r+1+"em"}),r.html(u.c+" x "+u.r)}},ie=function(t){var n=e.summernote.ui,o=t.layoutInfo.note,i=t.layoutInfo.toolbar,r=t.options;this.shouldInitialize=function(){return!r.airMode},this.initialize=function(){r.toolbar=r.toolbar||[],r.toolbar.length?t.invoke("buttons.build",i,r.toolbar):i.hide(),r.toolbarContainer&&i.appendTo(r.toolbarContainer),o.on("summernote.keyup summernote.mouseup summernote.change",function(){t.invoke("buttons.updateCurrentStyle")}),t.invoke("buttons.updateCurrentStyle")},this.destroy=function(){i.children().remove()},this.updateFullscreen=function(e){n.toggleBtnActive(i.find(".btn-fullscreen"),e)},this.updateCodeview=function(e){n.toggleBtnActive(i.find(".btn-codeview"),e),e?this.deactivate():this.activate()},this.activate=function(e){var t=i.find("button");e||(t=t.not(".btn-codeview")),n.toggleBtn(t,!0)},this.deactivate=function(e){var t=i.find("button");e||(t=t.not(".btn-codeview")),n.toggleBtn(t,!1)}},re=function(t){var n=this,o=e.summernote.ui,i=t.layoutInfo.editor,r=t.options,a=r.langInfo;this.initialize=function(){var t=r.dialogsInBody?e(document.body):i,n='<div class="form-group"><label>'+a.link.textToDisplay+'</label><input class="note-link-text form-control" type="text" /></div><div class="form-group"><label>'+a.link.url+'</label><input class="note-link-url form-control" type="text" value="http://" /></div>'+(r.disableLinkTarget?"":'<div class="checkbox"><label><input type="checkbox" checked> '+a.link.openInNewWindow+"</label></div>"),s='<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+a.link.insert+"</button>";this.$dialog=o.dialog({className:"link-dialog",title:a.link.insert,fade:r.dialogsFade,body:n,footer:s}).render().appendTo(t)},this.destroy=function(){o.hideDialog(this.$dialog),this.$dialog.remove()},this.bindEnterKey=function(e,t){e.on("keypress",function(e){e.keyCode===H.code.ENTER&&t.trigger("click")})},this.showLinkDialog=function(i){return e.Deferred(function(e){var r=n.$dialog.find(".note-link-text"),a=n.$dialog.find(".note-link-url"),s=n.$dialog.find(".note-link-btn"),l=n.$dialog.find("input[type=checkbox]");o.onDialogShown(n.$dialog,function(){t.triggerEvent("dialog.shown"),r.val(i.text),r.on("input",function(){o.toggleBtn(s,r.val()&&a.val()),i.text=r.val()}),i.url||(i.url=i.text||"http://",o.toggleBtn(s,i.text)),a.on("input",function(){o.toggleBtn(s,r.val()&&a.val()),i.text||r.val(a.val())}).val(i.url).trigger("focus"),n.bindEnterKey(a,s),n.bindEnterKey(r,s),l.prop("checked",i.isNewWindow),s.one("click",function(t){t.preventDefault(),e.resolve({range:i.range,url:a.val(),text:r.val(),isNewWindow:l.is(":checked")}),n.$dialog.modal("hide")})}),o.onDialogHidden(n.$dialog,function(){r.off("input keypress"),a.off("input keypress"),s.off("click"),"pending"===e.state()&&e.reject()}),o.showDialog(n.$dialog)}).promise()},this.show=function(){var e=t.invoke("editor.getLinkInfo");t.invoke("editor.saveRange"),this.showLinkDialog(e).then(function(e){t.invoke("editor.restoreRange"),t.invoke("editor.createLink",e)}).fail(function(){t.invoke("editor.restoreRange")})},t.memo("help.linkDialog.show",r.langInfo.help["linkDialog.show"])},ae=function(t){var n=this,i=e.summernote.ui,r=t.options;this.events={"summernote.keyup summernote.mouseup summernote.change summernote.scroll":function(){n.update()},"summernote.dialog.shown":function(){n.hide()}},this.shouldInitialize=function(){return!o.isEmpty(r.popover.link)},this.initialize=function(){this.$popover=i.popover({className:"note-link-popover",callback:function(e){var t=e.find(".popover-content");t.prepend('<span><a target="_blank"></a>&nbsp;</span>')}}).render().appendTo("body");var e=this.$popover.find(".popover-content");t.invoke("buttons.build",e,r.popover.link)},this.destroy=function(){this.$popover.remove()},this.update=function(){if(!t.invoke("editor.hasFocus"))return void this.hide();var n=t.invoke("editor.createRange");if(n.isCollapsed()&&n.isOnAnchor()){var o=p.ancestor(n.sc,p.isAnchor),i=e(o).attr("href");this.$popover.find("a").attr("href",i).html(i);var r=p.posFromPlaceholder(o);this.$popover.css({display:"block",left:r.left,top:r.top})}else this.hide()},this.hide=function(){this.$popover.hide()}},se=function(t){var n=this,o=e.summernote.ui,i=t.layoutInfo.editor,r=t.options,a=r.langInfo;this.initialize=function(){var t=r.dialogsInBody?e(document.body):i,n="";if(r.maximumImageFileSize){var s=Math.floor(Math.log(r.maximumImageFileSize)/Math.log(1024)),l=1*(r.maximumImageFileSize/Math.pow(1024,s)).toFixed(2)+" "+" KMGTP"[s]+"B";n="<small>"+a.image.maximumFileSize+" : "+l+"</small>"}var c='<div class="form-group note-group-select-from-files"><label>'+a.image.selectFromFiles+'</label><input class="note-image-input form-control" type="file" name="files" accept="image/*" multiple="multiple" />'+n+'</div><div class="form-group" style="overflow:auto;"><label>'+a.image.url+'</label><input class="note-image-url form-control col-md-12" type="text" /></div>',d='<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+a.image.insert+"</button>";this.$dialog=o.dialog({title:a.image.insert,fade:r.dialogsFade,body:c,footer:d}).render().appendTo(t)},this.destroy=function(){o.hideDialog(this.$dialog),this.$dialog.remove()},this.bindEnterKey=function(e,t){e.on("keypress",function(e){e.keyCode===H.code.ENTER&&t.trigger("click")})},this.show=function(){t.invoke("editor.saveRange"),this.showImageDialog().then(function(e){o.hideDialog(n.$dialog),t.invoke("editor.restoreRange"),"string"==typeof e?t.invoke("editor.insertImage",e):t.invoke("editor.insertImagesOrCallback",e)}).fail(function(){t.invoke("editor.restoreRange")})},this.showImageDialog=function(){return e.Deferred(function(e){var i=n.$dialog.find(".note-image-input"),r=n.$dialog.find(".note-image-url"),a=n.$dialog.find(".note-image-btn");o.onDialogShown(n.$dialog,function(){t.triggerEvent("dialog.shown"),i.replaceWith(i.clone().on("change",function(){e.resolve(this.files||this.value)}).val("")),a.click(function(t){t.preventDefault(),e.resolve(r.val())}),r.on("keyup paste",function(){var e=r.val();o.toggleBtn(a,e)}).val("").trigger("focus"),n.bindEnterKey(r,a)}),o.onDialogHidden(n.$dialog,function(){i.off("change"),r.off("keyup paste keypress"),a.off("click"),"pending"===e.state()&&e.reject()}),o.showDialog(n.$dialog)})}},le=function(t){var n=e.summernote.ui,i=t.options;this.shouldInitialize=function(){return!o.isEmpty(i.popover.image)},this.initialize=function(){this.$popover=n.popover({className:"note-image-popover"}).render().appendTo("body");var e=this.$popover.find(".popover-content");t.invoke("buttons.build",e,i.popover.image)},this.destroy=function(){this.$popover.remove()},this.update=function(e){if(p.isImg(e)){var t=p.posFromPlaceholder(e);this.$popover.css({display:"block",left:t.left,top:t.top})}else this.hide()},this.hide=function(){this.$popover.hide()}},ce=function(t){var n=this,o=e.summernote.ui,i=t.layoutInfo.editor,r=t.options,a=r.langInfo;this.initialize=function(){var t=r.dialogsInBody?e(document.body):i,n='<div class="form-group row-fluid"><label>'+a.video.url+' <small class="text-muted">'+a.video.providers+'</small></label><input class="note-video-url form-control span12" type="text" /></div>',s='<button href="#" class="btn btn-primary note-video-btn disabled" disabled>'+a.video.insert+"</button>";this.$dialog=o.dialog({title:a.video.insert,fade:r.dialogsFade,body:n,footer:s}).render().appendTo(t)},this.destroy=function(){o.hideDialog(this.$dialog),this.$dialog.remove()},this.bindEnterKey=function(e,t){e.on("keypress",function(e){e.keyCode===H.code.ENTER&&t.trigger("click")})},this.createVideoNode=function(t){var n,o=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/,i=t.match(o),r=/\/\/instagram.com\/p\/(.[a-zA-Z0-9_-]*)/,a=t.match(r),s=/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/,l=t.match(s),c=/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/,d=t.match(c),u=/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/,h=t.match(u),f=/\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/,m=t.match(f),p=/^.+.(mp4|m4v)$/,g=t.match(p),v=/^.+.(ogg|ogv)$/,y=t.match(v),b=/^.+.(webm)$/,w=t.match(b);if(i&&11===i[1].length){var C=i[1];n=e("<iframe>").attr("frameborder",0).attr("src","//www.youtube.com/embed/"+C).attr("width","640").attr("height","360")}else if(a&&a[0].length)n=e("<iframe>").attr("frameborder",0).attr("src",a[0]+"/embed/").attr("width","612").attr("height","710").attr("scrolling","no").attr("allowtransparency","true");else if(l&&l[0].length)n=e("<iframe>").attr("frameborder",0).attr("src",l[0]+"/embed/simple").attr("width","600").attr("height","600").attr("class","vine-embed");else if(d&&d[3].length)n=e("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("frameborder",0).attr("src","//player.vimeo.com/video/"+d[3]).attr("width","640").attr("height","360");else if(h&&h[2].length)n=e("<iframe>").attr("frameborder",0).attr("src","//www.dailymotion.com/embed/video/"+h[2]).attr("width","640").attr("height","360");else if(m&&m[1].length)n=e("<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>").attr("frameborder",0).attr("height","498").attr("width","510").attr("src","//player.youku.com/embed/"+m[1]);else{if(!(g||y||w))return!1;n=e("<video controls>").attr("src",t).attr("width","640").attr("height","360")}return n.addClass("note-video-clip"),n[0]},this.show=function(){var e=t.invoke("editor.getSelectedText");t.invoke("editor.saveRange"),this.showVideoDialog(e).then(function(e){o.hideDialog(n.$dialog),t.invoke("editor.restoreRange");var i=n.createVideoNode(e);i&&t.invoke("editor.insertNode",i)}).fail(function(){t.invoke("editor.restoreRange")})},this.showVideoDialog=function(i){return e.Deferred(function(e){var r=n.$dialog.find(".note-video-url"),a=n.$dialog.find(".note-video-btn");o.onDialogShown(n.$dialog,function(){t.triggerEvent("dialog.shown"),r.val(i).on("input",function(){o.toggleBtn(a,r.val())}).trigger("focus"),a.click(function(t){t.preventDefault(),e.resolve(r.val())}),n.bindEnterKey(r,a)}),o.onDialogHidden(n.$dialog,function(){r.off("input"),a.off("click"),"pending"===e.state()&&e.reject()}),o.showDialog(n.$dialog)})}},de=function(t){var n=this,o=e.summernote.ui,i=t.layoutInfo.editor,r=t.options,a=r.langInfo;this.createShortCutList=function(){var n=r.keyMap[h.isMac?"mac":"pc"];return Object.keys(n).map(function(o){var i=n[o],r=e('<div><div class="help-list-item"/></div>');return r.append(e("<label><kbd>"+o+"</kdb></label>").css({width:180,"margin-right":10})).append(e("<span/>").html(t.memo("help."+i)||i)),r.html()}).join("")},this.initialize=function(){var t=r.dialogsInBody?e(document.body):i,n=['<p class="text-center">','<a href="//summernote.org/" target="_blank">Summernote 0.8.1</a> · ','<a href="//github.com/summernote/summernote" target="_blank">Project</a> · ','<a href="//github.com/summernote/summernote/issues" target="_blank">Issues</a>',"</p>"].join("");this.$dialog=o.dialog({title:a.options.help,fade:r.dialogsFade,body:this.createShortCutList(),footer:n,callback:function(e){e.find(".modal-body").css({"max-height":300,overflow:"scroll"})}}).render().appendTo(t)},this.destroy=function(){o.hideDialog(this.$dialog),this.$dialog.remove()},this.showHelpDialog=function(){return e.Deferred(function(e){o.onDialogShown(n.$dialog,function(){t.triggerEvent("dialog.shown"),e.resolve()}),o.showDialog(n.$dialog)}).promise()},this.show=function(){t.invoke("editor.saveRange"),this.showHelpDialog().then(function(){t.invoke("editor.restoreRange")})}},ue=function(t){var i=this,r=e.summernote.ui,a=t.options,s=20;this.events={"summernote.keyup summernote.mouseup summernote.scroll":function(){i.update()},"summernote.change summernote.dialog.shown":function(){i.hide()},"summernote.focusout":function(e,t){h.isFF||t.relatedTarget&&p.ancestor(t.relatedTarget,n.eq(i.$popover[0]))||i.hide()}},this.shouldInitialize=function(){return a.airMode&&!o.isEmpty(a.popover.air)},this.initialize=function(){this.$popover=r.popover({className:"note-air-popover"}).render().appendTo("body");var e=this.$popover.find(".popover-content");t.invoke("buttons.build",e,a.popover.air)},this.destroy=function(){this.$popover.remove()},this.update=function(){var e=t.invoke("editor.currentStyle");if(e.range&&!e.range.isCollapsed()){var i=o.last(e.range.getClientRects());if(i){var r=n.rect2bnd(i);this.$popover.css({display:"block",left:Math.max(r.left+r.width/2,0)-s,top:r.top+r.height})}}else this.hide()},this.hide=function(){this.$popover.hide()}},he=function(t){var i=this,r=e.summernote.ui,a=5,s=t.options.hint||[],l=t.options.hintDirection||"bottom",c=e.isArray(s)?s:[s];this.events={"summernote.keyup":function(e,t){t.isDefaultPrevented()||i.handleKeyup(t)},"summernote.keydown":function(e,t){i.handleKeydown(t)},"summernote.dialog.shown":function(){i.hide()}},this.shouldInitialize=function(){return c.length>0},this.initialize=function(){this.lastWordRange=null,this.$popover=r.popover({className:"note-hint-popover",hideArrow:!0,direction:""}).render().appendTo("body"),this.$popover.hide(),this.$content=this.$popover.find(".popover-content"),this.$content.on("click",".note-hint-item",function(){i.$content.find(".active").removeClass("active"),e(this).addClass("active"),i.replace()})},this.destroy=function(){this.$popover.remove()},this.selectItem=function(e){this.$content.find(".active").removeClass("active"),e.addClass("active"),this.$content[0].scrollTop=e[0].offsetTop-this.$content.innerHeight()/2},this.moveDown=function(){var e=this.$content.find(".note-hint-item.active"),t=e.next();if(t.length)this.selectItem(t);else{var n=e.parent().next();n.length||(n=this.$content.find(".note-hint-group").first()),this.selectItem(n.find(".note-hint-item").first())}},this.moveUp=function(){var e=this.$content.find(".note-hint-item.active"),t=e.prev();if(t.length)this.selectItem(t);else{var n=e.parent().prev();n.length||(n=this.$content.find(".note-hint-group").last()),this.selectItem(n.find(".note-hint-item").last())}},this.replace=function(){var e=this.$content.find(".note-hint-item.active");if(e.length){var n=this.nodeFromItem(e);this.lastWordRange.insertNode(n),B.createFromNode(n).collapse().select(),this.lastWordRange=null,this.hide(),t.invoke("editor.focus")}},this.nodeFromItem=function(e){var t=c[e.data("index")],n=e.data("item"),o=t.content?t.content(n):n;return"string"==typeof o&&(o=p.createText(o)),o},this.createItemTemplates=function(t,n){var o=c[t];return n.map(function(n,i){var r=e('<div class="note-hint-item"/>');return r.append(o.template?o.template(n):n+""),r.data({index:t,item:n}),0===t&&0===i&&r.addClass("active"),r})},this.handleKeydown=function(e){this.$popover.is(":visible")&&(e.keyCode===H.code.ENTER?(e.preventDefault(),this.replace()):e.keyCode===H.code.UP?(e.preventDefault(),this.moveUp()):e.keyCode===H.code.DOWN&&(e.preventDefault(),this.moveDown()))},this.searchKeyword=function(e,t,n){var o=c[e];if(o&&o.match.test(t)&&o.search){var i=o.match.exec(t);o.search(i[1],n)}else n()},this.createGroup=function(t,n){var o=e('<div class="note-hint-group note-hint-group-'+t+'"/>');return this.searchKeyword(t,n,function(e){e=e||[],e.length&&(o.html(i.createItemTemplates(t,e)),i.show())}),o},this.handleKeyup=function(e){if(o.contains([H.code.ENTER,H.code.UP,H.code.DOWN],e.keyCode)){if(e.keyCode===H.code.ENTER&&this.$popover.is(":visible"))return}else{var r=t.invoke("editor.createRange").getWordRange(),s=r.toString();if(c.length&&s){this.$content.empty();var d=n.rect2bnd(o.last(r.getClientRects()));d&&(this.$popover.hide(),this.lastWordRange=r,c.forEach(function(e,t){e.match.test(s)&&i.createGroup(t,s).appendTo(i.$content)}),"top"===l?this.$popover.css({left:d.left,top:d.top-this.$popover.outerHeight()-a}):this.$popover.css({left:d.left,top:d.top+d.height+a}))}else this.hide()}},this.show=function(){this.$popover.show()},this.hide=function(){this.$popover.hide()}};e.summernote=e.extend(e.summernote,{version:"0.8.1",ui:P,plugins:{},options:{modules:{editor:$,clipboard:K,dropzone:G,codeview:Y,statusbar:Q,fullscreen:Z,handle:J,hintPopover:he,autoLink:ee,autoSync:te,placeholder:ne,buttons:oe,toolbar:ie,linkDialog:re,linkPopover:ae,imageDialog:se,imagePopover:le,videoDialog:ce,helpDialog:de,airPopover:ue},buttons:{},lang:"en-US",toolbar:[["style",["style"]],["font",["bold","underline","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","picture","video"]],["view",["fullscreen","codeview","help"]]],popover:{image:[["imagesize",["imageSize100","imageSize50","imageSize25"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]]],link:[["link",["linkDialogShow","unlink"]]],air:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]]},airMode:!1,width:null,height:null,focus:!1,tabSize:4,styleWithSpan:!0,shortcuts:!0,textareaAutoSync:!0,direction:null,styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Helvetica","Impact","Lucida Grande","Tahoma","Times New Roman","Verdana"],fontSizes:["8","9","10","11","12","14","18","24","36"],colors:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],tableClassName:"table table-bordered",insertTableMaxSize:{col:10,row:10},dialogsInBody:!1,dialogsFade:!1,maximumImageFileSize:null,callbacks:{onInit:null,onFocus:null,onBlur:null,onEnter:null,onKeyup:null,onKeydown:null,onSubmit:null,onImageUpload:null,onImageUploadError:null},codemirror:{mode:"text/html",htmlMode:!0,lineNumbers:!0},keyMap:{pc:{ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"linkDialog.show"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"linkDialog.show"}},icons:{align:"note-icon-align",alignCenter:"note-icon-align-center",alignJustify:"note-icon-align-justify",alignLeft:"note-icon-align-left",alignRight:"note-icon-align-right",indent:"note-icon-align-indent",outdent:"note-icon-align-outdent",arrowsAlt:"note-icon-arrows-alt",bold:"note-icon-bold",caret:"note-icon-caret",circle:"note-icon-circle",close:"note-icon-close",code:"note-icon-code",eraser:"note-icon-eraser",font:"note-icon-font",frame:"note-icon-frame",italic:"note-icon-italic",link:"note-icon-link",unlink:"note-icon-chain-broken",magic:"note-icon-magic",menuCheck:"note-icon-check",minus:"note-icon-minus",orderedlist:"note-icon-orderedlist",pencil:"note-icon-pencil",picture:"note-icon-picture",question:"note-icon-question",redo:"note-icon-redo",square:"note-icon-square",strikethrough:"note-icon-strikethrough",subscript:"note-icon-subscript",superscript:"note-icon-superscript",table:"note-icon-table",textHeight:"note-icon-text-height",trash:"note-icon-trash",underline:"note-icon-underline",undo:"note-icon-undo",unorderedlist:"note-icon-unorderedlist",video:"note-icon-video"}}})});var wysihtml5,Base,Handlebars;Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var e=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return e.get.call(this)},set:function(t){return e.set.call(this,t)}})}(),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46},function(e,t){"function"==typeof define&&define.amd?define(e):t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==x||!(n!=N||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=N||!e[t])}function n(e,t){return typeof e[t]!=E}function o(e){return function(t,n){for(var o=n.length;o--;)if(!e(t,n[o]))return!1;return!0}}function i(e){return e&&A(e,k)&&_(e,R)}function r(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(n){t(window,"console")&&e(window.console,"log")&&window.console.log(n)}function s(e,t){t?window.alert(e):a(e)}function l(e){D.initialized=!0,D.supported=!1,s("Rangy is not supported on this page in your browser. Reason: "+e,D.config.alertOnFail)}function c(e){s("Rangy warning: "+e,D.config.alertOnWarn)}function d(e){return e.message||e.description||e+""}function u(){var t,n,o,s,c,u,h,m,p;if(!D.initialized){if(n=!1,o=!1,e(document,"createRange")&&(t=document.createRange(),A(t,S)&&_(t,T)&&(n=!0)),s=r(document),!s||"body"!=s.nodeName.toLowerCase())return void l("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),i(t)&&(o=!0)),!n&&!o)return void l("Neither Range nor TextRange are available");D.initialized=!0,D.features={implementsDomRange:n,implementsTextRange:o};for(h in L)(c=L[h])instanceof f&&c.init(c,D);for(m=0,p=y.length;p>m;++m)try{y[m](D)}catch(g){u="Rangy init listener threw an exception. Continuing. Detail: "+d(g),a(u)}}}function h(e){e=e||window,u();for(var t=0,n=b.length;n>t;++t)b[t](e)}function f(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n,o){var i=new f(t,n,function(e){if(!e.initialized){e.initialized=!0;try{o(D,e),e.supported=!0}catch(n){var i="Module '"+t+"' failed to load: "+d(n);a(i)}}});L[t]=i}function p(){}function g(){}var v,y,b,w,C,N="object",x="function",E="undefined",T=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],S=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],R=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],k=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],A=o(e),I=o(t),_=o(n),L={},D={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:A,areHostObjects:I,areHostProperties:_,isTextRange:i,getBody:r},features:{},modules:L,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==E?!0:rangyAutoInitialize}};return D.fail=l,D.warn=c,{}.hasOwnProperty?D.util.extend=function(e,t,n){var o,i,r;for(r in t)t.hasOwnProperty(r)&&(o=e[r],i=t[r],n&&null!==o&&"object"==typeof o&&null!==i&&"object"==typeof i&&D.util.extend(o,i,!0),e[r]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e}:l("hasOwnProperty not supported"),function(){var e,t,n=document.createElement("div");n.appendChild(document.createElement("span")),e=[].slice;try{1==e.call(n.childNodes,0)[0].nodeType&&(t=function(t){return e.call(t,0)})}catch(o){}t||(t=function(e){var t,n,o=[];for(t=0,n=e.length;n>t;++t)o[t]=e[t];return o}),D.util.toArray=t}(),e(document,"addEventListener")?v=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?v=function(e,t,n){e.attachEvent("on"+t,n)}:l("Document does not have required addEventListener or attachEvent method"),D.util.addListener=v,y=[],D.init=u,D.addInitListener=function(e){D.initialized?e(D):y.push(e)},b=[],D.addShimListener=function(e){b.push(e)},D.shim=D.createMissingNativeApi=h,f.prototype={init:function(){var e,t,n,o,i=this.dependencies||[];for(e=0,t=i.length;t>e;++e){if(o=i[e],n=L[o],!(n&&n instanceof f))throw Error("required module '"+o+"' not found");if(n.init(),!n.supported)throw Error("required module '"+o+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){D.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){D.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return Error("Error in Rangy "+this.name+" module: "+e)}},D.createModule=function(e){var t,n,o;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),o=m(!1,e,n,t),D.initialized&&o.init()},D.createCoreModule=function(e,t,n){m(!0,e,t,n)},D.RangePrototype=p,D.rangePrototype=new p,D.selectionPrototype=new g,w=!1,C=function(){w||(w=!0,!D.initialized&&D.config.autoInitialize&&u())},typeof window==E?void l("No window found"):typeof document==E?void l("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",C,!1),v(window,"load",C),D.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==O||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function o(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)++t;return t}function r(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(_(o,n))return n;return null}function s(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function l(e,t){return s(e,t,!0)}function c(e,t,n){for(var o,i=n?e:e.parentNode;i;){if(o=i.parentNode,o===t)return i;i=o}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function h(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function f(e,t,n){var o,r,a=e.cloneNode(!1);if(a.deleteData(0,t),e.deleteData(t,e.length-t),h(a,e),n)for(o=0;r=n[o++];)r.node==e&&r.offset>t?(r.node=a,r.offset-=t):r.node==e.parentNode&&r.offset>i(e)&&++r.offset;return a}function m(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=O)return e.ownerDocument;if(typeof e.document!=O)return e.document;if(e.parentNode)return m(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=m(e);if(typeof n.defaultView!=O)return n.defaultView;
if(typeof n.parentWindow!=O)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function g(e){if(typeof e.contentDocument!=O)return e.contentDocument;if(typeof e.contentWindow!=O)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=O)return e.contentWindow;if(typeof e.contentDocument!=O)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function y(e){return e&&P.isHostMethod(e,"setTimeout")&&P.isHostObject(e,"document")}function b(e,t,n){var o;if(e?P.isHostProperty(e,"nodeType")?o=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?g(e):m(e):y(e)&&(o=e.document):o=document,!o)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return o}function w(e){for(var t;t=e.parentNode;)e=t;return e}function C(e,n,o,r){var s,l,d,u,h;if(e==o)return n===r?0:r>n?-1:1;if(s=c(o,e,!0))return n<=i(s)?-1:1;if(s=c(e,o,!0))return i(s)<r?-1:1;if(l=a(e,o),!l)throw Error("comparePoints error: nodes have no common ancestor");if(d=e===l?l:c(e,l,!0),u=o===l?l:c(o,l,!0),d===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=l.firstChild;h;){if(h===d)return-1;if(h===u)return 1;h=h.nextSibling}}function N(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function x(e){if(!e)return"[No node]";if(L&&N(e))return"[Broken node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+i(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function E(e){for(var t,n=m(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function T(e){this.root=e,this._next=e}function S(e){return new T(e)}function R(e,t){this.node=e,this.offset=t}function k(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var A,I,_,L,D,O="undefined",P=e.util;P.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),P.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method"),A=document.createElement("div"),P.areHostMethods(A,["insertBefore","appendChild","cloneNode"]||!P.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),P.isHostProperty(A,"innerHTML")||t.fail("Element is missing innerHTML property"),I=document.createTextNode("test"),P.areHostMethods(I,["splitText","deleteData","insertData","appendData","cloneNode"]||!P.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"])||!P.areHostProperties(I,["data"]))||t.fail("Incomplete Text Node implementation"),_=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},L=!1,function(){var t,n=document.createElement("b");n.innerHTML="1",t=n.firstChild,n.innerHTML="<br>",L=N(t),e.features.crashyTextNodes=L}(),typeof window.getComputedStyle!=O?D=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=O?D=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),T.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},R.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},k.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},k.prototype.toString=function(){return this.message},e.dom={arrayContains:_,isHtmlNamespace:n,parentElement:o,getNodeIndex:i,getNodeLength:r,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:d,isTextOrCommentNode:u,insertAfter:h,splitDataNode:f,getDocument:m,getWindow:p,getIframeWindow:v,getIframeDocument:g,getBody:P.getBody,isWindow:y,getContentDocument:b,getRootContainer:w,comparePoints:C,isBrokenNode:N,inspectNode:x,getComputedStyleProperty:D,fragmentFromNodeChildren:E,createIterator:S,DomPosition:R},e.DOMException=k}),D.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(ae(e,t.startContainer)||ae(e,t.endContainer))}function n(e){return e.document||se(e.startContainer)}function o(e){return new ne(e.parentNode,re(e))}function i(e){return new ne(e.parentNode,re(e)+1)}function r(e,t,n){var o=11==e.nodeType?e.firstChild:e;return ie(t)?n==t.length?ee.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:ce(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function a(e,t,o){if(E(e),E(t),n(t)!=n(e))throw new oe("WRONG_DOCUMENT_ERR");var i=le(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=le(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return o?0>=i&&r>=0:0>i&&r>0}function s(e){var t,o,i,r;for(i=n(e.range).createDocumentFragment();o=e.next();){if(t=e.isPartiallySelectedSubtree(),o=o.cloneNode(!t),t&&(r=e.getSubtreeIterator(),o.appendChild(s(r)),r.detach()),10==o.nodeType)throw new oe("HIERARCHY_REQUEST_ERR");i.appendChild(o)}return i}function l(e,t,n){var o,i,r,a;for(n=n||{stop:!1};r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return void(n.stop=!0);if(a=e.getSubtreeIterator(),l(a,t,n),a.detach(),n.stop)return}else for(o=ee.createIterator(r);i=o.next();)if(t(i)===!1)return void(n.stop=!0)}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach()):e.remove()}function d(e){for(var t,o,i=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),o=e.getSubtreeIterator(),t.appendChild(d(o)),o.detach()):e.remove(),10==t.nodeType)throw new oe("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function u(e,t,n){var o,i,r=!(!t||!t.length),a=!!n;return r&&(o=RegExp("^("+t.join("|")+")$")),i=[],l(new f(e,!1),function(t){var s,l;(!r||o.test(t.nodeType))&&(!a||n(t))&&(s=e.startContainer,t==s&&ie(s)&&e.startOffset==s.length||(l=e.endContainer,t==l&&ie(l)&&0==e.endOffset||i.push(t)))}),i}function h(e){var t=void 0===e.getName?"Range":e.getName();return"["+t+"("+ee.inspectNode(e.startContainer)+":"+e.startOffset+", "+ee.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function f(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&ie(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||ie(this.sc)?de(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||ie(this.ec)?de(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){return function(t,n){for(var o,i=n?t:t.parentNode;i;){if(o=i.nodeType,he(e,o))return i;i=i.parentNode}return null}}function p(e,t){if(U(e,t))throw new oe("INVALID_NODE_TYPE_ERR")}function g(e,t){if(!he(t,e.nodeType))throw new oe("INVALID_NODE_TYPE_ERR")}function v(e,t){if(0>t||t>(ie(e)?e.length:e.childNodes.length))throw new oe("INDEX_SIZE_ERR")}function y(e,t){if(F(e,!0)!==F(t,!0))throw new oe("WRONG_DOCUMENT_ERR")}function b(e){if(z(e,!0))throw new oe("NO_MODIFICATION_ALLOWED_ERR")}function w(e,t){if(!e)throw new oe(t)}function C(e){return me&&ee.isBrokenNode(e)||!he(P,e.nodeType)&&!F(e,!0)}function N(e,t){return t<=(ie(e)?e.length:e.childNodes.length)}function x(e){return!!e.startContainer&&!!e.endContainer&&!C(e.startContainer)&&!C(e.endContainer)&&N(e.startContainer,e.startOffset)&&N(e.endContainer,e.endOffset)}function E(e){if(!x(e))throw Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function T(e,t){var n,o,i,r,a;E(e),n=e.startContainer,o=e.startOffset,i=e.endContainer,r=e.endOffset,a=n===i,ie(i)&&r>0&&r<i.length&&ce(i,r,t),ie(n)&&o>0&&o<n.length&&(n=ce(n,o,t),a?(r-=o,i=n):i==n.parentNode&&r>=re(n)&&r++,o=0),e.setStartAndEnd(n,o,i,r)}function S(e){E(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function R(e){e.START_TO_START=$,e.START_TO_END=K,e.END_TO_END=G,e.END_TO_START=Y,e.NODE_BEFORE=X,e.NODE_AFTER=Q,e.NODE_BEFORE_AND_AFTER=Z,e.NODE_INSIDE=J}function k(e){R(e),R(e.prototype)}function A(e,t){return function(){var n,o,r,a,s,c,d;return E(this),n=this.startContainer,o=this.startOffset,r=this.commonAncestorContainer,a=new f(this,!0),n!==r&&(s=de(n,r,!0),c=i(s),n=c.node,o=c.offset),l(a,b),a.reset(),d=e(a),a.detach(),t(this,n,o,n,o),d}}function I(n,r){function a(e,t){return function(n){g(n,O),g(fe(n),P);var r=(e?o:i)(n);(t?s:l)(this,r.node,r.offset)}}function s(e,t,n){var o=e.endContainer,i=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((fe(t)!=fe(o)||1==le(t,n,o,i))&&(o=t,i=n),r(e,t,n,o,i))}function l(e,t,n){var o=e.startContainer,i=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((fe(t)!=fe(o)||-1==le(t,n,o,i))&&(o=t,i=n),r(e,o,i,t,n))}var u=function(){};u.prototype=e.rangePrototype,n.prototype=new u,te.extend(n.prototype,{setStart:function(e,t){p(e,!0),v(e,t),s(this,e,t)},setEnd:function(e,t){p(e,!0),v(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,i=n;switch(e.length){case 3:i=e[2];break;case 4:o=e[2],i=e[3]}r(this,t,n,o,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){E(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){p(e,!0),r(this,e,0,e,ue(e))},selectNode:function(e){p(e,!1),g(e,O);var t=o(e),n=i(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:A(d,r),deleteContents:A(c,r),canSurroundContents:function(){var e,n;return E(this),b(this.startContainer),b(this.endContainer),e=new f(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this),e.detach(),!n},splitBoundaries:function(){T(this)},splitBoundariesPreservingPositions:function(e){T(this,e)},normalizeBoundaries:function(){var e,t,n,o,i,a,s,l,c;E(this),e=this.startContainer,t=this.startOffset,n=this.endContainer,o=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,o=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},a=function(i){var r,a,s=i.previousSibling;s&&s.nodeType==i.nodeType&&(e=i,r=i.length,t=s.length,i.insertData(0,s.data),s.parentNode.removeChild(s),e==n?(o+=t,n=e):n==i.parentNode&&(a=re(i),o==a?(n=i,o=r):o>a&&o--))},s=!0,ie(n)?n.length==o&&i(n):(o>0&&(l=n.childNodes[o-1],l&&ie(l)&&i(l)),s=!this.collapsed),s?ie(e)?0==t&&a(e):t<e.childNodes.length&&(c=e.childNodes[t],c&&ie(c)&&a(c)):(e=n,t=o),r(this,e,t,n,o)},collapseToPoint:function(e,t){p(e,!0),v(e,t),this.setStartAndEnd(e,t)}}),k(n)}function _(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:ee.getCommonAncestor(e.startContainer,e.endContainer)}function L(e,t,n,o,i){e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=i,e.document=ee.getDocument(t),_(e)}function D(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,_(this)}var O,P,M,H,B,F,z,U,j,q,V,W,$,K,G,Y,X,Q,Z,J,ee=e.dom,te=e.util,ne=ee.DomPosition,oe=e.DOMException,ie=ee.isCharacterDataNode,re=ee.getNodeIndex,ae=ee.isOrIsAncestorOf,se=ee.getDocument,le=ee.comparePoints,ce=ee.splitDataNode,de=ee.getClosestAncestorIn,ue=ee.getNodeLength,he=ee.arrayContains,fe=ee.getRootContainer,me=e.features.crashyTextNodes;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,ie(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!ie(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e,t,o,i,r,a;return this.isSingleCharacterDataNode?(e=this.range.cloneRange(),e.collapse(!1)):(e=new D(n(this.range)),t=this._current,o=t,i=0,r=t,a=ue(t),ae(t,this.sc)&&(o=this.sc,i=this.so),ae(t,this.ec)&&(r=this.ec,a=this.eo),L(e,o,i,r,a)),new f(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},O=[1,3,4,5,7,8,10],P=[2,9,11],M=[5,6,10,12],H=[1,3,4,5,7,8,10,11],B=[1,3,4,5,7,8],F=m([9,11]),z=m(M),U=m([6,10,12]),j=document.createElement("style"),q=!1;try{j.innerHTML="<b>x</b>",q=3==j.firstChild.nodeType}catch(pe){}e.features.htmlParsingConforms=q,V=q?function(e){var t,n=this.startContainer,o=se(n);if(!n)throw new oe("INVALID_STATE_ERR");return t=null,1==n.nodeType?t=n:ie(n)&&(t=ee.parentElement(n)),t=null===t||"HTML"==t.nodeName&&ee.isHtmlNamespace(se(t).documentElement)&&ee.isHtmlNamespace(t)?o.createElement("body"):t.cloneNode(!1),t.innerHTML=e,ee.fragmentFromNodeChildren(t)}:function(e){var t=n(this),o=t.createElement("body");return o.innerHTML=e,ee.fragmentFromNodeChildren(o)},W=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],$=0,K=1,G=2,Y=3,X=0,Q=1,Z=2,J=3,te.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){var n,o,i,r,a,s;return E(this),y(this.startContainer,t.startContainer),a=e==Y||e==$?"start":"end",s=e==K||e==$?"start":"end",n=this[a+"Container"],o=this[a+"Offset"],i=t[s+"Container"],r=t[s+"Offset"],le(n,o,i,r)},insertNode:function(e){if(E(this),g(e,H),b(this.startContainer),ae(e,this.startContainer))throw new oe("HIERARCHY_REQUEST_ERR");var t=r(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t,o;return E(this),this.collapsed?n(this).createDocumentFragment():this.startContainer===this.endContainer&&ie(this.startContainer)?(e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t):(o=new f(this,!0),e=s(o),o.detach(),e)},canSurroundContents:function(){var e,n;return E(this),b(this.startContainer),b(this.endContainer),e=new f(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this),e.detach(),!n},surroundContents:function(e){if(g(e,B),!this.canSurroundContents())throw new oe("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);r(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){var e,t,o;for(E(this),e=new D(n(this)),t=W.length;t--;)o=W[t],e[o]=this[o];return e},toString:function(){var e,t,n;return E(this),e=this.startContainer,e===this.endContainer&&ie(e)?3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"":(t=[],n=new f(this,!0),l(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join(""))},compareNode:function(e){var t,n,o,i;if(E(this),t=e.parentNode,n=re(e),!t)throw new oe("NOT_FOUND_ERR");return o=this.comparePoint(t,n),i=this.comparePoint(t,n+1),0>o?i>0?Z:X:i>0?Q:J},comparePoint:function(e,t){return E(this),w(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),le(e,t,this.startContainer,this.startOffset)<0?-1:le(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:V,toHtml:function(){return S(this)},intersectsNode:function(e,t){var o,i,r,a;return E(this),w(e,"NOT_FOUND_ERR"),se(e)!==n(this)?!1:(o=e.parentNode,i=re(e),w(o,"NOT_FOUND_ERR"),r=le(o,i,this.endContainer,this.endOffset),a=le(o,i+1,this.startContainer,this.startOffset),t?0>=r&&a>=0:0>r&&a>0)},isPointInRange:function(e,t){return E(this),w(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),le(e,t,this.startContainer,this.startOffset)>=0&&le(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return a(this,e,!1)},intersectsOrTouchesRange:function(e){return a(this,e,!0)},intersection:function(e){var t,n,o;return this.intersectsRange(e)?(t=le(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=le(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange(),-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o):null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==le(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==le(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new oe("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==J},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,ue(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t,n,o=this.cloneRange();return o.selectNode(e),t=o.getNodes([3]),t.length>0?(o.setStart(t[0],0),n=t.pop(),o.setEnd(n,n.length),this.containsRange(o)):this.containsNodeContents(e)},getNodes:function(e,t){return E(this),u(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var o,i,r,a=n(this),s=e.createRange(a);return t=t||ee.getBody(a),s.selectNodeContents(t),o=this.intersection(s),i=0,r=0,o&&(s.setEnd(o.startContainer,o.startOffset),i=(""+s).length,r=i+(""+o).length),{start:i,end:r,containerNode:t}},moveToBookmark:function(e){var t,n,o,i,r,a,s,l=e.containerNode,c=0;for(this.setStart(l,0),this.collapse(!0),t=[l],o=!1,i=!1;!i&&(n=t.pop());)if(3==n.nodeType)r=c+n.length,!o&&e.start>=c&&e.start<=r&&(this.setStart(n,e.start-c),o=!0),o&&e.end>=c&&e.end<=r&&(this.setEnd(n,e.end-c),i=!0),c=r;else for(s=n.childNodes,a=s.length;a--;)t.push(s[a])},getName:function(){return"DomRange"},equals:function(e){return D.rangesEqual(this,e)},isValid:function(){return x(this)},inspect:function(){return h(this)},detach:function(){}}),I(D,L),te.extend(D,{rangeProperties:W,RangeIterator:f,copyComparisonConstants:k,createPrototypeRange:I,inspect:h,toHtml:S,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=D}),D.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,o,i,r,a,s,l,c,d=e.dom,u=e.util,h=d.DomPosition,f=e.DomRange,m=d.getBody,p=d.getContentDocument,g=d.isCharacterDataNode;e.features.implementsDomRange&&!function(){function o(e){for(var t,n=y.length;n--;)t=y[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function i(e,t,n,o,i){var r=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=i,s=!e.equals(e.nativeRange);(r||a||s)&&(e.setEnd(o,i),e.setStart(t,n))}var r,a,s,l,c,h,g,v,y=f.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,o(this)},f.createPrototypeRange(n,i),r=n.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),o(this)},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),o(this)},r.collapse=function(e){this.nativeRange.collapse(e),o(this)},r.cloneRange=function(){return new n(this.nativeRange.cloneRange())},r.refresh=function(){o(this)},r.toString=function(){return""+this.nativeRange},s=document.createTextNode("test"),m(document).appendChild(s),l=document.createRange(),l.setStart(s,0),l.setEnd(s,0);try{l.setStart(s,1),r.setStart=function(e,t){this.nativeRange.setStart(e,t),o(this)},r.setEnd=function(e,t){this.nativeRange.setEnd(e,t),o(this)},a=function(e){return function(t){this.nativeRange[e](t),o(this)}}}catch(b){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}o(this)},r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}o(this)},a=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(i){this.nativeRange[t](n),this.nativeRange[e](n)}o(this)}}}r.setStartBefore=a("setStartBefore","setEndBefore"),r.setStartAfter=a("setStartAfter","setEndAfter"),r.setEndBefore=a("setEndBefore","setStartBefore"),r.setEndAfter=a("setEndAfter","setStartAfter"),r.selectNodeContents=function(e){this.setStartAndEnd(e,0,d.getNodeLength(e))},l.selectNodeContents(s),l.setEnd(s,3),c=document.createRange(),c.selectNodeContents(s),c.setEnd(s,4),c.setStart(s,2),r.compareBoundaryPoints=-1==l.compareBoundaryPoints(l.START_TO_END,c)&&1==l.compareBoundaryPoints(l.END_TO_START,c)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},h=document.createElement("div"),h.innerHTML="123",g=h.firstChild,v=m(document),v.appendChild(h),l.setStart(g,1),l.setEnd(g,2),l.deleteContents(),"13"==g.data&&(r.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return o(this),e}),v.removeChild(h),v=null,u.isHostMethod(l,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),m(document).removeChild(s),r.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=p(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange&&(i=function(e){var t,n,o,i=e.parentElement(),r=e.duplicate();return r.collapse(!0),t=r.parentElement(),r=e.duplicate(),r.collapse(!1),n=r.parentElement(),o=t==n?t:d.getCommonAncestor(t,n),o==i?o:d.getCommonAncestor(i,o)},r=function(e){return 0==e.compareEndPoints("StartToEnd",e)},a=function(e,t,n,o,i){var r,a,s,l,c,u,f,m,p,v,y,b,w,C,N,x,E=e.duplicate();if(E.collapse(n),r=E.parentElement(),d.isOrIsAncestorOf(t,r)||(r=t),!r.canHaveHTML)return a=new h(r.parentNode,d.getNodeIndex(r)),{boundaryPosition:a,nodeInfo:{nodeIndex:a.offset,containerElement:a.node}};for(s=d.getDocument(r).createElement("span"),s.parentNode&&s.parentNode.removeChild(s),c=n?"StartToStart":"StartToEnd",v=i&&i.containerElement==r?i.nodeIndex:0,y=r.childNodes.length,b=y,w=b;w==y?r.appendChild(s):r.insertBefore(s,r.childNodes[w]),E.moveToElementText(s),l=E.compareEndPoints(c,e),0!=l&&v!=b;){if(-1==l){if(b==v+1)break;v=w}else b=b==v+1?v:w;w=Math.floor((v+b)/2),r.removeChild(s)}if(p=s.nextSibling,-1==l&&p&&g(p)){if(E.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(p.data))for(N=E.duplicate(),x=N.text.replace(/\r\n/g,"\r").length,C=N.moveStart("character",x);-1==(l=N.compareEndPoints("StartToEnd",N));)C++,N.moveStart("character",1);else C=E.text.length;m=new h(p,C)}else u=(o||!n)&&s.previousSibling,f=(o||n)&&s.nextSibling,m=f&&g(f)?new h(f,0):u&&g(u)?new h(u,u.data.length):new h(r,d.getNodeIndex(s));return s.parentNode.removeChild(s),{boundaryPosition:m,nodeInfo:{nodeIndex:w,containerElement:r}}},s=function(e,t){var n,o,i,r,a=e.offset,s=d.getDocument(e.node),l=m(s).createTextRange(),c=g(e.node);return c?(n=e.node,o=n.parentNode):(r=e.node.childNodes,n=a<r.length?r[a]:null,o=e.node),i=s.createElement("span"),i.innerHTML="&#feff;",n?o.insertBefore(i,n):o.appendChild(i),l.moveToElementText(i),l.collapse(!t),o.removeChild(i),c&&l[t?"moveStart":"moveEnd"]("character",a),l},o=function(e){this.textRange=e,this.refresh()},o.prototype=new f(document),o.prototype.refresh=function(){var e,t,n,o=i(this.textRange);r(this.textRange)?t=e=a(this.textRange,o,!0,!0).boundaryPosition:(n=a(this.textRange,o,!0,!1),e=n.boundaryPosition,t=a(this.textRange,o,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},o.prototype.getName=function(){return"WrappedTextRange"},f.copyComparisonConstants(o),l=function(e){var t,n,o;return e.collapsed?s(new h(e.startContainer,e.startOffset),!0):(t=s(new h(e.startContainer,e.startOffset),!0),n=s(new h(e.endContainer,e.endOffset),!1),o=m(f.getRangeDocument(e)).createTextRange(),o.setEndPoint("StartToStart",t),o.setEndPoint("EndToEnd",n),o)},o.rangeToTextRange=l,o.prototype.toTextRange=function(){return l(this)},e.WrappedTextRange=o,(!e.features.implementsDomRange||e.config.preferTextRange)&&(c=function(){return this}(),void 0===c.Range&&(c.Range=o),e.createNativeRange=function(e){return e=p(e,t,"createNativeRange"),m(e).createTextRange()},e.WrappedRange=o)),e.createRange=function(n){return n=p(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=p(e,t,"createRangyRange"),new f(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addShimListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),D.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function o(e,n){if(e){if(S.isWindow(e))return e;if(e instanceof v)return e.win;var o=S.getContentDocument(e,t,n);return S.getWindow(o)}return window}function i(e){return o(e,"getWinSelection").getSelection()}function r(e){return o(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==S.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var o=n?"end":"start",i=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof A?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof I?n=t.nativeRange:P.implementsDomRange&&t instanceof S.getWindow(t.startContainer).Range&&(n=t),n}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!S.isAncestorOf(e[0],e[t]))return!1;return!0}function h(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function f(e){return!!e&&void 0!==e.text}function m(e,t){var n=new I(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function p(t){var n,o,i,r;if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else if(n=t.docSelection.createRange(),f(n))m(t,n);else{for(t.rangeCount=n.length,i=H(n.item(0)),r=0;r<t.rangeCount;++r)o=e.createRange(i),o.selectNode(n.item(r)),t._ranges.push(o);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}function g(e,n){var o,i,r=e.docSelection.createRange(),a=h(n),s=H(r.item(0)),l=B(s).createControlRange();for(o=0,i=r.length;i>o;++o)l.add(r.item(o));try{l.add(a)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}l.select(),p(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function y(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function b(e,t){for(var n,o,i=te.length;i--;)if(n=te[i],o=n.selection,"deleteAll"==t)y(o);else if(n.win==e)return"delete"==t?(te.splice(i,1),!0):o;return"deleteAll"==t&&(te.length=0),null}function w(e,n){var o,i,r,a=H(n[0].startContainer),s=B(a).createControlRange();for(o=0,r=n.length;r>o;++o){i=h(n[o]);try{s.add(i)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}s.select(),p(e)}function C(e,t){if(e.win.document!=H(t))throw new _("WRONG_DOCUMENT_ERR")}function N(t){return function(n,o){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,o)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,o)),this.setSingleRange(i,this.isBackward())}}function x(e){var t,n,o=[],i=new L(e.anchorNode,e.anchorOffset),r=new L(e.focusNode,e.focusOffset),a="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(t=0,n=e.rangeCount;n>t;++t)o[t]=A.inspect(e.getRangeAt(t));return"["+a+"(Ranges: "+o.join(", ")+")(anchor: "+i.inspect()+", focus: "+r.inspect()+"]"}var E,T,S,R,k,A,I,_,L,D,O,P,M,H,B,F,z,U,j,q,V,W,$,K,G,Y,X,Q,Z,J,ee,te,ne,oe,ie,re,ae,se;if(e.config.checkSelectionRanges=!0,E="boolean",T="number",S=e.dom,R=e.util,k=R.isHostMethod,A=e.DomRange,I=e.WrappedRange,_=e.DOMException,L=S.DomPosition,P=e.features,M="Control",H=S.getDocument,B=S.getBody,F=A.rangesEqual,z=k(window,"getSelection"),U=R.isHostObject(document,"selection"),P.implementsWinGetSelection=z,P.implementsDocSelection=U,j=U&&(!z||e.config.preferTextRange),j?(D=r,e.isSelectionValid=function(e){var t=o(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||H(n.createRange().parentElement())==t}):z?(D=i,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=D,q=D(),V=e.createNativeRange(document),W=B(document),$=R.areHostProperties(q,["anchorNode","focusNode","anchorOffset","focusOffset"]),P.selectionHasAnchorAndFocus=$,K=k(q,"extend"),P.selectionHasExtend=K,G=typeof q.rangeCount==T,P.selectionHasRangeCount=G,Y=!1,X=!0,Q=K?function(t,n){var o=A.getRangeDocument(n),i=e.createRange(o);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(d(i)),t.extend(n.startContainer,n.startOffset)}:null,R.areHostMethods(q,["addRange","getRangeAt","removeAllRanges"])&&typeof q.rangeCount==T&&P.implementsDomRange&&!function(){var t,n,o,i,r,s,l,c,d,u,h,f=window.getSelection();if(f){for(t=f.rangeCount,n=t>1,o=[],i=a(f),r=0;t>r;++r)o[r]=f.getRangeAt(r);for(s=B(document),l=s.appendChild(document.createElement("div")),l.contentEditable="false",c=l.appendChild(document.createTextNode("   ")),d=document.createRange(),d.setStart(c,1),d.collapse(!0),f.addRange(d),X=1==f.rangeCount,f.removeAllRanges(),n||(u=window.navigator.appVersion.match(/Chrome\/(.*?) /),u&&parseInt(u[1])>=36?Y=!1:(h=d.cloneRange(),d.setStart(c,0),h.setEnd(c,3),h.setStart(c,2),f.addRange(d),f.addRange(h),Y=2==f.rangeCount)),s.removeChild(l),f.removeAllRanges(),r=0;t>r;++r)0==r&&i?Q?Q(f,o[r]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),
f.addRange(o[r])):f.addRange(o[r])}}(),P.selectionSupportsMultipleRanges=Y,P.collapsedNonEditableSelectionsSupported=X,Z=!1,W&&k(W,"createControlRange")&&(J=W.createControlRange(),R.areHostProperties(J,["item","add"])&&(Z=!0)),P.implementsControlRange=Z,O=$?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1},k(q,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:$&&(ee=function(t){var n=H(t.anchorNode),o=e.createRange(n);return o.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),o.collapsed!==this.isCollapsed&&o.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),o}),v.prototype=e.selectionPrototype,te=[],ne=function(e){var t,n,i;return e&&e instanceof v?(e.refresh(),e):(e=o(e,"getNativeSelection"),t=b(e),n=D(e),i=U?r(e):null,t?(t.nativeSelection=n,t.docSelection=i,t.refresh()):(t=new v(n,i,e),te.push({win:e,selection:t})),t)},e.getSelection=ne,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(S.getIframeWindow(n))},oe=v.prototype,!j&&$&&R.areHostMethods(q,["removeAllRanges","addRange"]))oe.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)},ie=function(e,t){Q(e.nativeSelection,t),e.refresh()},oe.addRange=G?function(t,o){var i,r;Z&&U&&this.docSelection.type==M?g(this,t):n(o)&&K?ie(this,t):(Y?i=this.rangeCount:(this.removeAllRanges(),i=0),this.nativeSelection.addRange(d(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1?(e.config.checkSelectionRanges&&(r=ee(this.nativeSelection,this.rangeCount-1),r&&!F(r,t)&&(t=new I(r))),this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=O(this)):this.refresh())}:function(e,t){n(t)&&K?ie(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},oe.setRanges=function(e){if(Z&&U&&e.length>1)w(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}};else{if(!(k(q,"empty")&&k(V,"select")&&Z&&j))return t.fail("No means of selecting a Range or TextRange was found"),!1;oe.removeAllRanges=function(){var e,t,n;try{this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?e=H(this.anchorNode):this.docSelection.type==M&&(t=this.docSelection.createRange(),t.length&&(e=H(t.item(0)))),e&&(n=B(e).createTextRange(),n.select(),this.docSelection.empty()))}catch(o){}c(this)},oe.addRange=function(t){this.docSelection.type==M?g(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},oe.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?w(this,e):t&&this.addRange(e[0])}}if(oe.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new _("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},j)re=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=B(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==M?p(t):f(n)?m(t,n):c(t)};else if(k(q,"getRangeAt")&&typeof q.rangeCount==T)re=function(t){if(Z&&U&&t.docSelection.type==M)p(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,o=t.rangeCount;o>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=O(t)}else c(t)};else{if(!$||typeof q.isCollapsed!=E||typeof V.collapsed!=E||!P.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;re=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=O(e)):c(e)}}oe.refresh=function(e){var t,n=e?this._ranges.slice(0):null,o=this.anchorNode,i=this.anchorOffset;if(re(this),e){if(t=n.length,t!=this._ranges.length)return!0;if(this.anchorNode!=o||this.anchorOffset!=i)return!0;for(;t--;)if(!F(n[t],this._ranges[t]))return!0;return!1}},ae=function(e,t){var n,o,i=e.getAllRanges();for(e.removeAllRanges(),n=0,o=i.length;o>n;++n)F(t,i[n])||e.addRange(i[n]);e.rangeCount||c(e)},oe.removeRange=Z&&U?function(e){var t,n,o,i,r,a,s,l;if(this.docSelection.type==M){for(t=this.docSelection.createRange(),n=h(e),o=H(t.item(0)),i=B(o).createControlRange(),a=!1,s=0,l=t.length;l>s;++s)r=t.item(s),r!==n||a?i.add(t.item(s)):a=!0;i.select(),p(this)}else ae(this,e)}:function(e){ae(this,e)},!j&&$&&P.implementsDomRange?(se=a,oe.isBackward=function(){return se(this)}):se=oe.isBackward=function(){return!1},oe.isBackwards=oe.isBackward,oe.toString=function(){var e,t,n=[];for(e=0,t=this.rangeCount;t>e;++e)n[e]=""+this._ranges[e];return n.join("")},oe.collapse=function(t,n){C(this,t);var o=e.createRange(t);o.collapseToPoint(t,n),this.setSingleRange(o),this.isCollapsed=!0},oe.collapseToStart=function(){if(!this.rangeCount)throw new _("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},oe.collapseToEnd=function(){if(!this.rangeCount)throw new _("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},oe.selectAllChildren=function(t){C(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},oe.deleteFromDocument=function(){var e,t,n,o,i;if(Z&&U&&this.docSelection.type==M){for(e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount&&(n=this.getAllRanges(),n.length)){for(this.removeAllRanges(),o=0,i=n.length;i>o;++o)n[o].deleteContents();this.addRange(n[i-1])}},oe.eachRange=function(e,t){for(var n=0,o=this._ranges.length;o>n;++n)if(e(this.getRangeAt(n)))return t},oe.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},oe.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},oe.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(o){n.push(o[e].apply(o,t))}),n},oe.setStart=N(!0),oe.setEnd=N(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},oe.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},oe.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},oe.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},oe.moveToBookmark=function(t){var n,o,i,r=[];for(n=0;o=t.rangeBookmarks[n++];)i=e.createRange(this.win),i.moveToBookmark(o),r.push(i);t.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},oe.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(A.toHtml(t))}),e.join("")},P.implementsTextRange&&(oe.getNativeTextRange=function(){var n,o;if(n=this.docSelection){if(o=n.createRange(),f(o))return o;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),oe.getName=function(){return"WrappedSelection"},oe.inspect=function(){return x(this)},oe.detach=function(){b(this.win,"delete"),y(this)},v.detachAll=function(){b(null,"deleteAll")},v.inspect=x,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=oe,e.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})}),D)},this),function(e,t){"function"==typeof define&&define.amd?define(["rangy"],e):e(t.rangy)}(function(e){e.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function o(e,t){var n,o="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),i=m.getDocument(e.startContainer),r=e.cloneRange();return r.collapse(t),n=i.createElement("span"),n.id=o,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(i.createTextNode(p)),r.insertNode(n),n}function i(e,o,i,r){var a=n(i,e);a?(o[r?"setStartBefore":"setEndBefore"](a),a.parentNode.removeChild(a)):t.warn("Marker element has been removed. Cannot restore selection.")}function r(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function a(t,n){var i,r,a=e.DomRange.getRangeDocument(t),s=""+t;return t.collapsed?(r=o(t,!1),{document:a,markerId:r.id,collapsed:!0}):(r=o(t,!1),i=o(t,!0),{document:a,startMarkerId:i.id,endMarkerId:r.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+s+"', new text: '"+t+"'"}})}function s(o,r){var a,s,l,c=o.document;return void 0===r&&(r=!0),a=e.createRange(c),o.collapsed?(s=n(o.markerId,c),s?(s.style.display="inline",l=s.previousSibling,l&&3==l.nodeType?(s.parentNode.removeChild(s),a.collapseToPoint(l,l.length)):(a.collapseBefore(s),s.parentNode.removeChild(s))):t.warn("Marker element has been removed. Cannot restore selection.")):(i(c,a,o.startMarkerId,!0),i(c,a,o.endMarkerId,!1)),r&&a.normalizeBoundaries(),a}function l(t,o){var i,s,l,c,d=[];for(t=t.slice(0),t.sort(r),l=0,c=t.length;c>l;++l)d[l]=a(t[l],o);for(l=c-1;l>=0;--l)i=t[l],s=e.DomRange.getRangeDocument(i),i.collapsed?i.collapseAfter(n(d[l].markerId,s)):(i.setEndBefore(n(d[l].endMarkerId,s)),i.setStartAfter(n(d[l].startMarkerId,s)));return d}function c(n){var o,i,r,a;return e.isSelectionValid(n)?(o=e.getSelection(n),i=o.getAllRanges(),r=1==i.length&&o.isBackward(),a=l(i,r),r?o.setSingleRange(i[0],"backward"):o.setRanges(i),{win:n,rangeInfos:a,restored:!1}):(t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null)}function d(e){var t,n=[],o=e.length;for(t=o-1;t>=0;t--)n[t]=s(e[t],!0);return n}function u(t,n){var o,i,r,a;t.restored||(o=t.rangeInfos,i=e.getSelection(t.win),r=d(o),a=o.length,1==a&&n&&e.features.selectionHasExtend&&o[0].backward?(i.removeAllRanges(),i.addRange(r[0],!0)):i.setRanges(r),t.restored=!0)}function h(e,t){var o=n(t,e);o&&o.parentNode.removeChild(o)}function f(e){var t,n,o,i=e.rangeInfos;for(t=0,n=i.length;n>t;++t)o=i[t],o.collapsed?h(e.doc,o.markerId):(h(e.doc,o.startMarkerId),h(e.doc,o.endMarkerId))}var m=e.dom,p="\ufeff";e.util.extend(e,{saveRange:a,restoreRange:s,saveRanges:l,restoreRanges:d,saveSelection:c,restoreSelection:u,removeMarkerElement:h,removeMarkers:f})})},this),Base=function(){},Base.extend=function(e,t){var n,o,i,r=Base.prototype.extend;return Base._prototyping=!0,n=new this,r.call(n,e),n.base=function(){},delete Base._prototyping,o=n.constructor,i=n.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,o.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||r).call(arguments[0],n)},i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=n,i.toString=this.toString,i.valueOf=function(e){return"object"==e?i:o.valueOf()},r.call(i,t),"function"==typeof i.init&&i.init(),i},Base.prototype={extend:function(e,t){var n,o,i,r,a,s,l;if(arguments.length>1)n=this[e],!n||"function"!=typeof t||n.valueOf&&n.valueOf()==t.valueOf()||!/\bbase\b/.test(t)||(o=t.valueOf(),t=function(){var e,t=this.base||Base.prototype.base;return this.base=n,e=o.apply(this,arguments),this.base=t,e},t.valueOf=function(e){return"object"==e?t:o},t.toString=Base.toString),this[e]=t;else if(e){for(i=Base.prototype.extend,Base._prototyping||"function"==typeof this||(i=this.extend||i),r={toSource:null},a=["constructor","toString","valueOf"],s=Base._prototyping?0:1;l=a[s++];)e[l]!=r[l]&&i.call(this,l,e[l]);for(l in e)r[l]||i.call(this,l,e[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var o in e)void 0===this.prototype[o]&&t.call(n,e[o],o,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return this.valueOf()+""}}),wysihtml5.browser=function(){function e(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function t(e){return+(e.match(/android (\d+)/)||[void 0,0])[1]}function n(e,t){var n,o=-1;return"Microsoft Internet Explorer"==navigator.appName?n=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(n=RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),n&&null!=n.exec(navigator.userAgent)&&(o=parseFloat(RegExp.$1)),-1===o?!1:e?t?"<"===t?o>e:">"===t?e>o:"<="===t?o>=e:">="===t?e>=o:void 0:e===o:!0}var o=navigator.userAgent,i=document.createElement("div"),r=-1!==o.indexOf("Gecko")&&-1===o.indexOf("KHTML"),a=-1!==o.indexOf("AppleWebKit/"),s=-1!==o.indexOf("Chrome/"),l=-1!==o.indexOf("Opera/");return{USER_AGENT:o,supported:function(){var n=this.USER_AGENT.toLowerCase(),o="contentEditable"in i,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,a=document.querySelector&&document.querySelectorAll,s=this.isIos()&&e(n)<5||this.isAndroid()&&t(n)<4||-1!==n.indexOf("opera mobi")||-1!==n.indexOf("hpwos/");return o&&r&&a&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return n()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return n()},hasCurrentStyleProperty:function(){return"currentStyle"in i},hasHistoryIssue:function(){return r&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in i||function(){return i.setAttribute("on"+e,"return;"),"function"==typeof i["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!l},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:function(){var e={formatBlock:n(10,"<="),insertUnorderedList:n(),insertOrderedList:n()},t={insertHTML:r};return function(n,o){var i=e[o];if(!i){try{return n.queryCommandSupported(o)}catch(r){}try{return n.queryCommandEnabled(o)}catch(a){return!!t[o]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||l||a},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||n()||l},autoScrollsToCaret:function(){return!a},autoClosesUnclosedTags:function(){var e,t,n=i.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==(document.getElementsByClassName+"").indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return l},supportsSpeechApiOn:function(e){var t=o.match(/Chrome\/(\d+)/)||[void 0,0];return t[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return n(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return n()},hasProblemsSettingCaretAfterImg:function(){return n()},hasUndoInContextMenu:function(){return r||s||l},hasInsertNodeIssue:function(){return l},hasIframeFocusIssue:function(){return n()},createsNestedInvalidMarkupAfterPaste:function(){return a},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(Array.isArray(t)){for(var n=t.length;n--;)if(-1!==wysihtml5.lang.array(e).indexOf(t[n]))return!0;return!1}return-1!==wysihtml5.lang.array(e).indexOf(t)},indexOf:function(t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;o>n;n++)if(e[n]===t)return n;return-1},without:function(t){t=wysihtml5.lang.array(t);for(var n=[],o=0,i=e.length;i>o;o++)t.contains(e[o])||n.push(e[o]);return n},get:function(){for(var t=0,n=e.length,o=[];n>t;t++)o.push(e[t]);return o},map:function(t,n){if(Array.prototype.map)return e.map(t,n);for(var o=e.length>>>0,i=Array(o),r=0;o>r;r++)i[r]=t.call(n,e[r],r,e);return i},unique:function(){for(var t=[],n=e.length,o=0;n>o;)wysihtml5.lang.array(t).contains(e[o])||t.push(e[o]),o++;return t}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,o,i=0;if(e){for(n=this.events[e]||[],o=[];i<n.length;i++)n[i]!==t&&t&&o.push(n[i]);this.events[e]=o}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],o=0;o<n.length;o++)n[o].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(t){var n,o={};if(null===e||!wysihtml5.lang.object(e).isPlainObject())return e;for(n in e)e.hasOwnProperty(n)&&(o[n]=t?wysihtml5.lang.object(e[n]).clone(t):e[n]);return o},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(e)},isPlainObject:function(){return"[object Object]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/,n=/[&<>\t"]/g,o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(i){return i+="",{trim:function(){return i.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)i=this.replace("#{"+t+"}").by(e[t]);return i},replace:function(e){return{by:function(t){return i.split(e).join(t)}}},escapeHTML:function(e,t){var r=i.replace(n,function(e){return o[e]});return e&&(r=r.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(r=r.replace(/  /gi,"&nbsp; ")),r}}}}(),function(e){function t(e,t){return r(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),a(e,t))}function n(e){return e.replace(l,function(e,t){var n,o,i=(t.match(c)||[])[1]||"",r=u[i];return t=t.replace(c,""),t.split(r).length>t.split(i).length&&(t+=i,i=""),n=t,o=t,t.length>d&&(o=o.substr(0,d)+"..."),"www."===n.substr(0,4)&&(n="http://"+n),'<a href="'+n+'">'+o+"</a>"+i})}function o(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function i(t){var i=t.parentNode,r=e.lang.string(t.data).escapeHTML(),a=o(i.ownerDocument);for(a.innerHTML="<span></span>"+n(r),a.removeChild(a.firstChild);a.firstChild;)i.insertBefore(a.firstChild,t);i.removeChild(t)}function r(t,n){for(var o;t.parentNode;){if(t=t.parentNode,o=t.nodeName,t.className&&e.lang.array(t.className.split(" ")).contains(n))return!0;if(s.contains(o))return!0;if("body"===o)return!1}return!1}function a(t,n){if(!(s.contains(t.nodeName)||t.className&&e.lang.array(t.className.split(" ")).contains(n))){if(t.nodeType===e.TEXT_NODE&&t.data.match(l))return void i(t);for(var o=e.lang.array(t.childNodes).get(),r=o.length,c=0;r>c;c++)a(o[c],n);return t}}var s=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,c=/([^\w\/\-](,?))$/i,d=100,u={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=l}(wysihtml5),function(e){var t=e.dom;t.addClass=function(e,n){var o=e.classList;return o?o.add(n):void(t.hasClass(e,n)||(e.className+=" "+n))},t.removeClass=function(e,t){var n=e.classList;return n?n.remove(t):void(e.className=e.className.replace(RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))},t.hasClass=function(e,t){var n,o=e.classList;return o?o.contains(t):(n=e.className,n.length>0&&(n==t||RegExp("(^|\\s)"+t+"(\\s|$)").test(n)))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}function t(e,t){return e.createElement(t)}function n(n,o,i){if("UL"===n.nodeName||"OL"===n.nodeName||"MENU"===n.nodeName)return n;var r,a,s,l,c,d,u,h,f,m=n.ownerDocument,p=t(m,o),g=n.querySelectorAll("br"),v=g.length;for(f=0;v>f;f++)for(l=g[f];(c=l.parentNode)&&c!==n&&c.lastChild===l;){if("block"===wysihtml5.dom.getStyle("display").from(c)){c.removeChild(l);break}wysihtml5.dom.insert(l).after(l.parentNode)}for(r=wysihtml5.lang.array(n.childNodes).get(),a=r.length,f=0;a>f;f++)h=h||e(m,p),s=r[f],d="block"===wysihtml5.dom.getStyle("display").from(s),u="BR"===s.nodeName,!d||i&&wysihtml5.dom.hasClass(s,i)?u?h=h.firstChild?null:h:h.appendChild(s):(h=h.firstChild?e(m,p):h,h.appendChild(s),h=null);return 0===r.length&&e(m,p),n.parentNode.replaceChild(p,n),p}return n}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var o,i=0,r=e.length;r>i;i++)o=e[i],void 0!==t[o]&&""!==t[o]&&(n[o]=t[o]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(t){return o(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},o=function(n){for(var o=0,i=t.length;i>o;o++)if("border-box"===e.getStyle(t[o]).from(n))return t[o]};e.copyStyles=function(o){return{from:function(i){n(i)&&(o=wysihtml5.lang.array(o).without(t));for(var r,a="",s=o.length,l=0;s>l;l++)r=o[l],a+=r+":"+e.getStyle(r).from(i)+";";return{to:function(t){return e.setStyles(a).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,n,o,i){return e.dom.observe(t,o,function(o){for(var r=o.target,a=e.lang.array(t.querySelectorAll(n));r&&r!==t;){if(a.contains(r)){i.call(r,o);break}r=r.parentNode}})}}(wysihtml5),function(e){e.dom.domNode=function(t){var n=[e.ELEMENT_NODE,e.TEXT_NODE],o=function(t){return t.nodeType===e.TEXT_NODE&&/^\s*$/g.test(t.data)};return{prev:function(i){var r=t.previousSibling,a=i&&i.nodeTypes?i.nodeTypes:n;return r?!e.lang.array(a).contains(r.nodeType)||i&&i.ignoreBlankTexts&&o(r)?e.dom.domNode(r).prev(i):r:null},next:function(i){var r=t.nextSibling,a=i&&i.nodeTypes?i.nodeTypes:n;return r?!e.lang.array(a).contains(r.nodeType)||i&&i.ignoreBlankTexts&&o(r)?e.dom.domNode(r).next(i):r:null}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(o){}return t.body.removeChild(n),n},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,o=n.length;o>t;t++)e.createElement(n[t]);e._wysihtml5_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,o){o=o||document;var i;return"object"==typeof n&&n.nodeType?(i=o.createElement("div"),i.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(o)?(i=o.createElement("div"),i.innerHTML=n):(t(o),i=e(n,o)),i}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return t&&t.length?"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e):!0}function t(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function n(e,t,n){var o=(e.className||"").match(n)||[];return t?o[o.length-1]===t:!!o.length}function o(e,t,n){var o=(e.getAttribute("style")||"").match(n)||[];return t?o[o.length-1]===t:!!o.length}return function(i,r,a,s){var l=r.cssStyle||r.styleRegExp,c=r.className||r.classRegExp;for(a=a||50;a--&&i&&"BODY"!==i.nodeName&&(!s||i!==s);){if(t(i)&&e(i.nodeName,r.nodeName)&&(!l||o(i,r.cssStyle,r.styleRegExp))&&(!c||n(i,r.className,r.classRegExp)))return i;i=i.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(n,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(o){var i,r,a,s,l,c,d,u,h;if(o.nodeType===wysihtml5.ELEMENT_NODE){if(i=o.ownerDocument,r=t[n]||e(n),a=o.style,s=o.currentStyle,l=a[r])return l;if(s)try{return s[r]}catch(f){}return c=i.defaultView||i.parentWindow,d=("height"===n||"width"===n)&&"TEXTAREA"===o.nodeName,c.getComputedStyle?(d&&(u=a.overflow,a.overflow="hidden"),h=c.getComputedStyle(o,null).getPropertyValue(n),d&&(a.overflow=u||""),h):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(e,t){var n=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||n.push(e):n=n.concat(wysihtml5.dom.getTextNodes(e,t));return n},wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var t={},n=1;return function(n,o){var i=e(n)+":"+o,r=t[i];return r||(r=t[i]=n.getElementsByTagName(o)),r.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=o++)}var n={},o=1;e.dom.hasElementWithClassName=function(o,i){if(!e.browser.supportsNativeGetElementsByClassName())return!!o.querySelector("."+i);var r=t(o)+":"+i,a=n[r];return a||(a=n[r]=o.getElementsByClassName(i)),a.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n,o,i=t.createElement("style");return i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(t.createTextNode(e)),n=t.querySelector("head link"),n?void n.parentNode.insertBefore(i,n):(o=t.querySelector("head"),void(o&&o.appendChild(i)))}}},function(e){e.dom.lineBreaks=function(t){function n(e){return"BR"===e.nodeName}function o(t){return n(t)?!0:"block"===e.dom.getStyle("display").from(t)}return{add:function(){var n=t.ownerDocument,i=e.dom.domNode(t).next({ignoreBlankTexts:!0}),r=e.dom.domNode(t).prev({ignoreBlankTexts:!0});i&&!o(i)&&e.dom.insert(n.createElement("br")).after(t),r&&!o(r)&&e.dom.insert(n.createElement("br")).before(t)},remove:function(){var o=e.dom.domNode(t).next({ignoreBlankTexts:!0}),i=e.dom.domNode(t).prev({ignoreBlankTexts:!0});o&&n(o)&&o.parentNode.removeChild(o),i&&n(i)&&i.parentNode.removeChild(i)}}}}(wysihtml5),wysihtml5.dom.observe=function(e,t,n){t="string"==typeof t?[t]:t;for(var o,i,r=0,a=t.length;a>r;r++)i=t[r],e.addEventListener?e.addEventListener(i,n,!1):(o=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+i,o));return{stop:function(){for(var i,r=0,a=t.length;a>r;r++)i=t[r],e.removeEventListener?e.removeEventListener(i,n,!1):e.detachEvent("on"+i,o)}}},wysihtml5.dom.parse=function(e,t){function n(e,t){var n,r,a,s,l,c,d,u,h;for(wysihtml5.lang.object(b).merge(y).merge(t.rules).get(),n=t.context||e.ownerDocument||document,r=n.createDocumentFragment(),a="string"==typeof e,s=!1,t.clearInternals===!0&&(s=!0),l=a?wysihtml5.dom.getAsDom(e,n):e,b.selectors&&i(l,b.selectors);l.firstChild;)d=l.firstChild,c=o(d,t.cleanUp,s,t.uneditableClass),c&&r.appendChild(c),d!==c&&l.removeChild(d);if(t.unjoinNbsps)for(u=wysihtml5.dom.getTextNodes(r),h=u.length;h--;)u[h].nodeValue=u[h].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return l.innerHTML="",l.appendChild(r),a?wysihtml5.quirks.getCorrectInnerHTML(l):l}function o(e,t,n,i){var r,a,s,l=e.nodeType,c=e.childNodes,d=c.length,u=p[l],h=0;if(i&&1===l&&wysihtml5.dom.hasClass(e,i))return e;if(a=u&&u(e,n),!a){if(a===!1){for(r=e.ownerDocument.createDocumentFragment(),h=d;h--;)c[h]&&(s=o(c[h],t,n,i),s&&(c[h]===s&&h--,r.insertBefore(s,r.firstChild)));return"block"===wysihtml5.dom.getStyle("display").from(e)&&r.appendChild(e.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||r.appendChild(e.ownerDocument.createTextNode(" "))),r.normalize&&r.normalize(),r}return null}for(h=0;d>h;h++)c[h]&&(s=o(c[h],t,n,i),s&&(c[h]===s&&h--,a.appendChild(s)));if(t&&a.nodeName.toLowerCase()===g&&(!a.childNodes.length||/^\s*$/gi.test(a.innerHTML)&&(n||"_wysihtml5-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!a.attributes.length)){for(r=a.ownerDocument.createDocumentFragment();a.firstChild;)r.appendChild(a.firstChild);return r.normalize&&r.normalize(),r}return a.normalize&&a.normalize(),a}function i(e,t){var n,o,i,r;for(n in t)if(t.hasOwnProperty(n))for(wysihtml5.lang.object(t[n]).isFunction()?o=t[n]:"string"==typeof t[n]&&T[t[n]]&&(o=T[t[n]]),i=e.querySelectorAll(n),r=i.length;r--;)o(i[r])}function r(e,t){var n,o,i,r=b.tags,s=e.nodeName.toLowerCase(),c=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(c&&"HTML"!=c&&(s=c+":"+s),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(s="div")),s in r){if(n=r[s],!n||n.remove)return null;if(n.unwrap)return!1;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:g}}if(n.one_of_type&&!a(e,b,n.one_of_type,t)){if(!n.remove_action)return null;if("unwrap"===n.remove_action)return!1;if("rename"!==n.remove_action)return null;i=n.remove_action_rename_to||g}return o=e.ownerDocument.createElement(i||n.rename_tag||s),h(e,o,n,t),l(e,o,n),e=null,o.normalize&&o.normalize(),o}function a(e,t,n,o){var i,r;if("SPAN"===e.nodeName&&!o&&("_wysihtml5-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(r in n)if(n.hasOwnProperty(r)&&t.type_definitions&&t.type_definitions[r]&&(i=t.type_definitions[r],s(e,i)))return!0;return!1}function s(e,t){var n,o,i,r,a,s,l,c,d=e.getAttribute("class"),u=e.getAttribute("style");if(t.methods)for(s in t.methods)if(t.methods.hasOwnProperty(s)&&E[s]&&E[s](e))return!0;if(d&&t.classes)for(d=d.replace(/^\s+/g,"").replace(/\s+$/g,"").split(v),n=d.length,l=0;n>l;l++)if(t.classes[d[l]])return!0;if(u&&t.styles){u=u.split(";");for(o in t.styles)if(t.styles.hasOwnProperty(o))for(c=u.length;c--;)if(a=u[c].split(":"),a[0].replace(/\s/g,"").toLowerCase()===o&&(t.styles[o]===!0||1===t.styles[o]||wysihtml5.lang.array(t.styles[o]).contains(a[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(i in t.attrs)if(t.attrs.hasOwnProperty(i)&&(r=wysihtml5.dom.getAttribute(e,i),"string"==typeof r&&r.search(t.attrs[i])>-1))return!0;return!1}function l(e,t,n){var o,i;if(n&&n.keep_styles)for(o in n.keep_styles)if(n.keep_styles.hasOwnProperty(o)){if(i="float"===o?e.style.styleFloat||e.style.cssFloat:e.style[o],n.keep_styles[o]instanceof RegExp&&!n.keep_styles[o].test(i))continue;"float"===o?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=i:e.style[o]&&(t.style[o]=i)}}function c(e,t){var n,o=[];for(n in t)t.hasOwnProperty(n)&&0===n.indexOf(e)&&o.push(n);return o}function d(e,t,n,o){var i,r=C[n];
return r&&(t||"alt"===e&&"IMG"==o)&&(i=r(t),"string"==typeof i)?i:!1}function u(e,t){var n,o,i,r,a,s=wysihtml5.lang.object(b.attributes||{}).clone(),l=wysihtml5.lang.object(s).merge(wysihtml5.lang.object(t||{}).clone()).get(),u={},h=wysihtml5.dom.getAttributes(e);for(n in l)if(/\*$/.test(n))for(i=c(n.slice(0,-1),h),r=0,a=i.length;a>r;r++)o=d(i[r],h[i[r]],l[n],e.nodeName),o!==!1&&(u[i[r]]=o);else o=d(n,h[n],l[n],e.nodeName),o!==!1&&(u[n]=o);return u}function h(e,t,n,o){var i,r,a,s,l,c={},d=n.set_class,h=n.add_class,f=n.add_style,m=n.set_attributes,p=b.classes,g=0,y=[],w=[],C=[],E=[];if(m&&(c=wysihtml5.lang.object(m).clone()),c=wysihtml5.lang.object(c).merge(u(e,n.check_attributes)).get(),d&&y.push(d),h)for(s in h)l=x[h[s]],l&&(a=l(wysihtml5.dom.getAttribute(e,s)),"string"==typeof a&&y.push(a));if(f)for(s in f)l=N[f[s]],l&&(newStyle=l(wysihtml5.dom.getAttribute(e,s)),"string"==typeof newStyle&&w.push(newStyle));if("string"==typeof p&&"any"===p&&e.getAttribute("class"))if(b.classes_blacklist){for(E=e.getAttribute("class"),E&&(y=y.concat(E.split(v))),i=y.length;i>g;g++)r=y[g],b.classes_blacklist[r]||C.push(r);C.length&&(c["class"]=wysihtml5.lang.array(C).unique().join(" "))}else c["class"]=e.getAttribute("class");else{for(o||(p["_wysihtml5-temp-placeholder"]=1,p._rangySelectionBoundary=1,p["wysiwyg-tmp-selected-cell"]=1),E=e.getAttribute("class"),E&&(y=y.concat(E.split(v))),i=y.length;i>g;g++)r=y[g],p[r]&&C.push(r);C.length&&(c["class"]=wysihtml5.lang.array(C).unique().join(" "))}c["class"]&&o&&(c["class"]=c["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(c["class"])&&delete c["class"]),w.length&&(c.style=wysihtml5.lang.array(w).unique().join(" "));for(s in c)try{t.setAttribute(s,c[s])}catch(T){}c.src&&(void 0!==c.width&&t.setAttribute("width",c.width),void 0!==c.height&&t.setAttribute("height",c.height))}function f(e){var t,n=e.nextSibling;return n&&n.nodeType===wysihtml5.TEXT_NODE?void(n.data=e.data.replace(w,"")+n.data.replace(w,"")):(t=e.data.replace(w,""),e.ownerDocument.createTextNode(t))}function m(e){return b.comments?e.ownerDocument.createComment(e.nodeValue):void 0}var p={1:r,3:f,8:m},g="span",v=/\s+/,y={tags:{},classes:{}},b={},w=/\uFEFF/g,C={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),href:function(){var e=/^(#|\/|https?:\/\/|mailto:)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}(),any:function(){return function(e){return e}}()},N={align_text:function(){var e={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return e[(t+"").toLowerCase()]}}()},x={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[(t+"").toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[(t+"").toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[(t+"").toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[(t+"").charAt(0)]}}()},E={has_visible_contet:function(){var e,t=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(n){if(e=(n.innerText||n.textContent).replace(/\s/g,""),e&&e.length>0)return!0;for(var o=t.length;o--;)if(n.querySelector(t[o]))return!0;return!!(n.offsetWidth&&n.offsetWidth>0&&n.offsetHeight&&n.offsetHeight>0)}}()},T={unwrap:function(e){wysihtml5.dom.unwrap(e)},remove:function(e){e.parentNode.removeChild(e)}};return n(e,t)},wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,n=wysihtml5.lang.array(e.childNodes).get(),o=n.length,i=0;o>i;i++)t=n[i],t.nodeType===wysihtml5.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var n,o=e.ownerDocument.createElement(t);n=e.firstChild;)o.appendChild(n);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(o),e.parentNode.replaceChild(o,e),o},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return void e.parentNode.removeChild(e);for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function n(e){return"BR"===e.nodeName}function o(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function i(e,i){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var r,a,s,l,c,d,u=e.ownerDocument,h=u.createDocumentFragment(),f=wysihtml5.dom.domNode(e).prev({ignoreBlankTexts:!0});if(i)for(!f||t(f)||n(f)||o(h);d=e.firstElementChild||e.firstChild;){for(a=d.lastChild;r=d.firstChild;)s=r===a,l=s&&!t(r)&&!n(r),h.appendChild(r),l&&o(h);d.parentNode.removeChild(d)}else for(;d=e.firstElementChild||e.firstChild;){if(d.querySelector&&d.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;r=d.firstChild;)h.appendChild(r);else{for(c=u.createElement("p");r=d.firstChild;)c.appendChild(r);h.appendChild(c)}d.parentNode.removeChild(d)}e.parentNode.replaceChild(h,e)}}e.resolveList=i}(wysihtml5.dom),function(e){var t=document,n=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],o=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],i=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,o=t.createElement("iframe");return o.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(o),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(o.src="javascript:'<html></html>'"),o.onload=function(){o.onreadystatechange=o.onload=null,n._onLoadIframe(o)},o.onreadystatechange=function(){/loaded|complete/.test(o.readyState)&&(o.onreadystatechange=o.onload=null,n._onLoadIframe(o))},o},_onLoadIframe:function(r){var a,s,l,c,d,u,h;if(e.dom.contains(t.documentElement,r)){if(a=this,s=r.contentWindow,l=r.contentWindow.document,c=t.characterSet||t.charset||"utf-8",d=this._getHtml({charset:c,stylesheets:this.config.stylesheets}),l.open("text/html","replace"),l.write(d),l.close(),this.getWindow=function(){return r.contentWindow},this.getDocument=function(){return r.contentWindow.document},s.onerror=function(e,t,n){throw Error("wysihtml5.Sandbox: "+e,t,n)},!e.browser.supportsSandboxedIframes()){for(u=0,h=n.length;h>u;u++)this._unset(s,n[u]);for(u=0,h=o.length;h>u;u++)this._unset(s,o[u],e.EMPTY_FUNCTION);for(u=0,h=i.length;h>u;u++)this._unset(l,i[u]);this._unset(l,"cookie","",!0)}this.loaded=!0,setTimeout(function(){a.callback(a)},0)}},_getHtml:function(t){var n,o=t.stylesheets,i="",r=0;if(o="string"==typeof o?[o]:o)for(n=o.length;n>r;r++)i+='<link rel="stylesheet" href="'+o[r]+'">';return t.stylesheets=i,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,o,i){try{t[n]=o}catch(r){}try{t.__defineGetter__(n,function(){return o})}catch(r){}if(i)try{t.__defineSetter__(n,function(){})}catch(r){}if(!e.browser.crashesWhenDefineProperty(n))try{var a={get:function(){return o}};i&&(a.set=function(){}),Object.defineProperty(t,n,a)}catch(r){}}})}(wysihtml5),function(e){var t=document;e.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(t,n,o){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.element=o?this._bindElement(o):this._createElement()},_createElement:function(){var e=t.createElement("div");return e.className="wysihtml5-sandbox",this._loadElement(e),e},_bindElement:function(e){return e.className=e.className&&""!=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n,o=this;t||(n=this._getHtml(),e.innerHTML=n),this.getWindow=function(){return e.ownerDocument.defaultView},this.getDocument=function(){return e.ownerDocument},this.loaded=!0,setTimeout(function(){o.callback(o)},0)},_getHtml:function(){return""}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var o in t)n.setAttribute(e[o]||o,t[o])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var n,o=t.style;if("string"==typeof e)return void(o.cssText+=";"+e);for(n in e)"float"===n?(o.cssFloat=e[n],o.styleFloat=e[n]):o[n]=e[n]}}},function(e){e.simulatePlaceholder=function(t,n,o){var i="placeholder",r=function(){var t=n.element.offsetWidth>0&&n.element.offsetHeight>0;n.hasPlaceholderSet()&&(n.clear(),n.element.focus(),t&&setTimeout(function(){var e=n.selection.getSelection();e.focusNode&&e.anchorNode||n.selection.selectNode(n.element.firstChild||n.element)},0)),n.placeholderSet=!1,e.removeClass(n.element,i)},a=function(){n.isEmpty()&&(n.placeholderSet=!0,n.setValue(o),e.addClass(n.element,i))};t.on("set_placeholder",a).on("unset_placeholder",r).on("focus:composer",r).on("paste:composer",r).on("blur:composer",a),a()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(e,t){var n,o,i,r=!wysihtml5.browser.supportsGetAttributeCorrectly();return t=t.toLowerCase(),n=e.nodeName,"IMG"==n&&"src"==t&&wysihtml5.dom.isLoadedImage(e)===!0?e.src:r&&"outerHTML"in e?(o=e.outerHTML.toLowerCase(),i=-1!=o.indexOf(" "+t+"="),i?e.getAttribute(t):null):e.getAttribute(t)},wysihtml5.dom.getAttributes=function(e){var t,n=!wysihtml5.browser.supportsGetAttributeCorrectly(),o=e.nodeName,i=[];for(t in e.attributes)(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(t)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,t))&&e.attributes[t].specified&&("IMG"==o&&"src"==e.attributes[t].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(e)===!0?i.src=e.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(e.attributes[t].name.toLowerCase())&&n?1!==e.attributes[t].value&&(i[e.attributes[t].name]=e.attributes[t].value):i[e.attributes[t].name]=e.attributes[t].value);return i},wysihtml5.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}},function(e){function t(e,t){var n,o,i,r,a=[];for(o=0,i=e.length;i>o;o++)if(n=e[o].querySelectorAll(t))for(r=n.length;r--;a.unshift(n[r]));return a}function n(e){e.parentNode.removeChild(e)}function o(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function i(e,t){for(var n=e.nextSibling;1!=n.nodeType;)if(n=n.nextSibling,!t||t==n.tagName.toLowerCase())return n;return null}var r=e.dom,a=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},s=function(e,t){e?(this.cell=e,this.table=r.getParentElement(e,{nodeName:["TABLE"]})):t&&(this.table=t,this.cell=this.table.querySelectorAll("th, td")[0])};s.prototype={addSpannedCellToMap:function(e,t,n,o,i,r){var s,l,c=[],d=n+(r?parseInt(r,10)-1:0),u=o+(i?parseInt(i,10)-1:0);for(s=n;d>=s;s++)for(void 0===t[s]&&(t[s]=[]),l=o;u>=l;l++)t[s][l]=new a(e),t[s][l].isColspan=i&&parseInt(i,10)>1,t[s][l].isRowspan=r&&parseInt(r,10)>1,t[s][l].firstCol=l==o,t[s][l].lastCol=l==u,t[s][l].firstRow=s==n,t[s][l].lastRow=s==d,t[s][l].isReal=l==o&&s==n,t[s][l].spanCollection=c,c.push(t[s][l])},setCellAsModified:function(e){if(e.modified=!0,e.spanCollection.length>0)for(var t=0,n=e.spanCollection.length;n>t;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e,t,n,o,i,s,l,c,d=[],u=this.getTableRows();for(e=0;e<u.length;e++)for(t=u[e],n=this.getRowCells(t),s=0,void 0===d[e]&&(d[e]=[]),o=0;o<n.length;o++){for(i=n[o];void 0!==d[e][s];)s++;l=r.getAttribute(i,"colspan"),c=r.getAttribute(i,"rowspan"),l||c?(this.addSpannedCellToMap(i,d,e,s,l,c),s+=l?parseInt(l,10):1):(d[e][s]=new a(i),s++)}return this.map=d,d},getRowCells:function(n){var o=this.table.querySelectorAll("table"),i=o?t(o,"th, td"):[],r=n.querySelectorAll("th, td"),a=i.length>0?e.lang.array(r).without(i):r;return a},getTableRows:function(){var n=this.table.querySelectorAll("table"),o=n?t(n,"tr"):[],i=this.table.querySelectorAll("tr"),r=o.length>0?e.lang.array(i).without(o):i;return r},getMapIndex:function(e){var t,n,o=this.map.length,i=this.map&&this.map[0]?this.map[0].length:0;for(t=0;o>t;t++)for(n=0;i>n;n++)if(this.map[t][n].el===e)return{row:t,col:n};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t,n,o,i,r,a,s=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(n=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=n),null!=this.idx_start&&null!=this.idx_end)for(o=this.idx_start.row,i=this.idx_end.row;i>=o;o++)for(r=this.idx_start.col,a=this.idx_end.col;a>=r;r++)s.push(this.map[o][r].el);return s},orderSelectionEnds:function(e){var t,n;return this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(n=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=n),{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,n){var o,i,r,a=this.table.ownerDocument,s=a.createDocumentFragment();for(i=0;t>i;i++){if(o=a.createElement(e),n)for(r in n)n.hasOwnProperty(r)&&o.setAttribute(r,n[r]);o.appendChild(document.createTextNode(" ")),s.appendChild(o)}return s},correctColIndexForUnreals:function(e,t){var n,o,i=this.map[t],r=-1;for(n=0,o=e;e>n;n++)i[n].isReal&&r++;return r},getLastNewCellOnRow:function(e,t){var n,o,i,r,a=this.getRowCells(e);for(i=0,r=a.length;r>i;i++)if(n=a[i],o=this.getMapIndex(n),o===!1||void 0!==t&&o.row!=t)return n;return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return e&&0!=e.length?!1:(n(this.table),!0)},splitRowToCells:function(e){var t,n,i;e.isColspan&&(t=parseInt(r.getAttribute(e.el,"colspan")||1,10),n=e.el.tagName.toLowerCase(),t>1&&(i=this.createCells(n,t-1),o(e.el,i)),e.el.removeAttribute("colspan"))},getRealRowEl:function(e,t){var n,o,i=null,a=null;for(t=t||this.idx,n=0,o=this.map[t.row].length;o>n;n++)if(a=this.map[t.row][n],a.isReal&&(i=r.getParentElement(a.el,{nodeName:["TR"]})))return i;return null===i&&e&&(i=r.getParentElement(this.map[t.row][t.col].el,{nodeName:["TR"]})||null),i},injectRowAt:function(e,t,n,i,a){var s,l,c=this.getRealRowEl(!1,{row:e,col:t}),d=this.createCells(i,n);c?(s=this.correctColIndexForUnreals(t,e),s>=0?o(this.getRowCells(c)[s],d):c.insertBefore(d,c.firstChild)):(l=this.table.ownerDocument.createElement("tr"),l.appendChild(d),o(r.getParentElement(a.el,{nodeName:["TR"]}),l))},canMerge:function(e){var t,n,o,i,r,a;for(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(n=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=n),o=this.idx_start.row,i=this.idx_end.row;i>=o;o++)for(r=this.idx_start.col,a=this.idx_end.col;a>=r;r++)if(this.map[o][r].isColspan||this.map[o][r].isRowspan)return!1;return!0},decreaseCellSpan:function(e,t){var n=parseInt(r.getAttribute(e.el,t),10)-1;n>=1?e.el.setAttribute(t,n):(e.el.removeAttribute(t),"colspan"==t&&(e.isColspan=!1),"rowspan"==t&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,t,o,i,a,s,l,c;if(this.setTableMap(),this.map){for(o=0,i=this.map.length;i>o;o++){for(e=this.map[o],l=!0,a=0,s=e.length;s>a;a++)if(t=e[a],!(r.getAttribute(t.el,"rowspan")&&parseInt(r.getAttribute(t.el,"rowspan"),10)>1&&t.firstRow!==!0)){l=!1;break}if(l)for(a=0;s>a;a++)this.decreaseCellSpan(e[a],"rowspan")}for(c=this.getTableRows(),o=0,i=c.length;i>o;o++)e=c[o],0==e.childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&n(e)}},fillMissingCells:function(){var e,t,n,i=0,r=0,s=null;if(this.setTableMap(),this.map){for(i=this.map.length,e=0;i>e;e++)this.map[e].length>r&&(r=this.map[e].length);for(t=0;i>t;t++)for(n=0;r>n;n++)this.map[t]&&!this.map[t][n]&&n>0&&(this.map[t][n]=new a(this.createCells("td",1)),s=this.map[t][n-1],s&&s.el&&s.el.parent&&o(this.map[t][n-1].el,this.map[t][n].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){var e,t,n,o,i,a;if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){if(e=this.map[this.idx.row][this.idx.col],t=r.getAttribute(e.el,"colspan")?parseInt(r.getAttribute(e.el,"colspan"),10):1,n=e.el.tagName.toLowerCase(),e.isRowspan){if(o=parseInt(r.getAttribute(e.el,"rowspan"),10),o>1)for(i=1,a=o-1;a>=i;i++)this.injectRowAt(this.idx.row+i,this.idx.col,t,n,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function(e){var t,o,i,r,a,s;if(this.rectify())if(this.canMerge(e)){for(t=this.idx_end.row-this.idx_start.row+1,o=this.idx_end.col-this.idx_start.col+1,i=this.idx_start.row,r=this.idx_end.row;r>=i;i++)for(a=this.idx_start.col,s=this.idx_end.col;s>=a;a++)i==this.idx_start.row&&a==this.idx_start.col?(t>1&&this.map[i][a].el.setAttribute("rowspan",t),o>1&&this.map[i][a].el.setAttribute("colspan",o)):(/^\s*<br\/?>\s*$/.test(this.map[i][a].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[i][a].el.innerHTML),n(this.map[i][a].el));this.rectify()}else window.console&&void 0},collapseCellToNextRow:function(e){var t,n,i,a=this.getMapIndex(e.el),s=a.row+1,l={row:s,col:a.col};s<this.map.length&&(t=this.getRealRowEl(!1,l),null!==t&&(n=this.correctColIndexForUnreals(l.col,l.row),n>=0?o(this.getRowCells(t)[n],e.el):(i=this.getLastNewCellOnRow(t,s),null!==i?o(i,e.el):t.insertBefore(e.el,t.firstChild)),parseInt(r.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")))},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):n(e.el):parseInt(r.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e,t,n,o=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(e=this.map[this.idx.row],t=0,n=e.length;n>t;t++)e[t].isReal&&o.push(e[t].el);return o},getColumnElementsByCell:function(){var e,t,n=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(e=0,t=this.map.length;t>e;e++)this.map[e][this.idx.col]&&this.map[e][this.idx.col].isReal&&n.push(this.map[e][this.idx.col].el);return n},removeRow:function(){var e,t,o,i=r.getParentElement(this.cell,{nodeName:["TR"]});if(i){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(e=this.map[this.idx.row],t=0,o=e.length;o>t;t++)e[t].modified||(this.setCellAsModified(e[t]),this.removeRowCell(e[t]));n(i)}},removeColCell:function(e){e.isColspan?parseInt(r.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(r.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&n(e.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var e=0,t=this.map.length;t>e;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var t,n,i,a,s,l=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&r.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(r.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(t=this.map[this.idx.row],n=l.createElement("tr"),i=0,a=t.length;a>i;i++)t[i].modified||(this.setCellAsModified(t[i]),this.addRowCell(t[i],n,e));switch(e){case"below":o(this.getRealRowEl(!0),n);break;case"above":s=r.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]}),s&&s.parentNode.insertBefore(n,s)}}},addRowCell:function(e,t,n){var o=e.isColspan?{colspan:r.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=n&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)+1):t.appendChild(this.createCells("td",1,o)):"above"!=n&&e.isRowspan&&e.lastRow?t.appendChild(this.createCells("td",1,o)):c.isRowspan&&e.el.attr("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&(("below"==e||"above"==e)&&this.addRow(e),("before"==e||"after"==e)&&this.addColumn(e))},addColCell:function(e,t,n){var i,a=e.el.tagName.toLowerCase();switch(n){case"before":i=!e.isColspan||e.firstCol;break;case"after":i=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(i){switch(n){case"before":e.el.parentNode.insertBefore(this.createCells(a,1),e.el);break;case"after":o(e.el,this.createCells(a,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,t+1,n)}else e.el.setAttribute("colspan",parseInt(r.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var t,n,o,i;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&r.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(r.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(o=0,i=this.map.length;i>o;o++)t=this.map[o],t[this.idx.col]&&(n=t[this.idx.col],n.modified||(this.setCellAsModified(n),this.addColCell(n,o,e)))},handleCellAddWithRowspan:function(e,t,n){var a,s,l,c,d=parseInt(r.getAttribute(this.cell,"rowspan"),10)-1,u=r.getParentElement(e.el,{nodeName:["TR"]}),h=e.el.tagName.toLowerCase(),f=this.table.ownerDocument;for(c=0;d>c;c++)if(a=this.correctColIndexForUnreals(this.idx.col,t+c),u=i(u,"tr"))if(a>0)switch(n){case"before":s=this.getRowCells(u),a>0&&this.map[t+c][this.idx.col].el!=s[a]&&a==s.length-1?o(s[a],this.createCells(h,1)):s[a].parentNode.insertBefore(this.createCells(h,1),s[a]);break;case"after":o(this.getRowCells(u)[a],this.createCells(h,1))}else u.insertBefore(this.createCells(h,1),u.firstChild);else l=f.createElement("tr"),l.appendChild(this.createCells(h,1)),this.table.appendChild(l)}},r.table={getCellsBetween:function(e,t){var n=new s(e);return n.getMapElsTo(t)},addCells:function(e,t){var n=new s(e);n.add(t)},removeCells:function(e,t){var n=new s(e);n.remove(t)},mergeCellsBetween:function(e,t){var n=new s(e);n.merge(t)},unmergeCell:function(e){var t=new s(e);t.unmerge()},orderSelectionEnds:function(e,t){var n=new s(e);return n.orderSelectionEnds(t)},indexOf:function(e){var t=new s(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){var n=new s(null,e);return n.getElementAtIndex(t)},findRowByCell:function(e){var t=new s(e);return t.getRowElementsByCell()},findColumnByCell:function(e){var t=new s(e);return t.getColumnElementsByCell()},canMerge:function(e,t){var n=new s(e);return n.canMerge(t)}}}(wysihtml5),wysihtml5.dom.query=function(e,t){var n,o,i,r,a=[];for(e.nodeType&&(e=[e]),o=0,i=e.length;i>o;o++)if(n=e[o].querySelectorAll(t))for(r=n.length;r--;a.unshift(n[r]));return a},wysihtml5.dom.compareDocumentPosition=function(){var e=document.documentElement;return e.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var n,o,i,r,a,s,l,c,d;if(n=9===e.nodeType?e:e.ownerDocument,o=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(n!==o)return 1;if(2===e.nodeType&&e.childNodes&&-1!==wysihtml5.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==wysihtml5.lang.array(t.childNodes).indexOf(e))return 10;for(i=e,r=[],a=null;i;){if(i==t)return 10;r.push(i),i=i.parentNode}for(i=t,a=null;i;){if(i==e)return 20;if(s=wysihtml5.lang.array(r).indexOf(i),-1!==s)return l=r[s],c=wysihtml5.lang.array(l.childNodes).indexOf(r[s-1]),d=wysihtml5.lang.array(l.childNodes).indexOf(a),c>d?2:4;a=i,i=i.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(e){if(e.parentNode){for(;e.lastChild;)wysihtml5.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}},wysihtml5.dom.getPastedHtml=function(e){var t;return e.clipboardData&&(wysihtml5.lang.array(e.clipboardData.types).contains("text/html")?t=e.clipboardData.getData("text/html"):wysihtml5.lang.array(e.clipboardData.types).contains("text/plain")&&(t=wysihtml5.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t},wysihtml5.dom.getPastedHtmlWithDiv=function(e,t){var n=e.selection.getBookmark(),o=e.element.ownerDocument,i=o.createElement("DIV");o.body.appendChild(i),i.style.width="1px",i.style.height="1px",i.style.overflow="hidden",i.setAttribute("contenteditable","true"),i.focus(),setTimeout(function(){e.selection.setBookmark(n),t(i.innerHTML),i.parentNode.removeChild(i)},0)},wysihtml5.quirks.cleanPastedHTML=function(){var e=function(e){var t=wysihtml5.lang.string(e).trim(),n=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return RegExp("^((?!^"+n+"$).)*$","i")},t=function(t,n){var o,i,r=wysihtml5.lang.object(t).clone(!0);for(o in r.tags)if(r.tags.hasOwnProperty(o)&&r.tags[o].keep_styles)for(i in r.tags[o].keep_styles)r.tags[o].keep_styles.hasOwnProperty(i)&&n[i]&&(r.tags[o].keep_styles[i]=e(n[i]));return r},n=function(e,t){var n,o,i;if(!e)return null;for(o=0,i=e.length;i>o;o++)if(e[o].condition||(n=e[o].set),e[o].condition&&e[o].condition.test(t))return e[o].set;return n};return function(e,o){var i,r={color:wysihtml5.dom.getStyle("color").from(o.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(o.referenceNode)},a=t(n(o.rules,e)||{},r);return i=wysihtml5.dom.parse(e,{rules:a,cleanUp:!0,context:o.referenceNode.ownerDocument,uneditableClass:o.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)&&(e.innerHTML="")},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],e)}}(),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(n){var o,i,r,a,s,l=n.innerHTML;if(-1===l.indexOf(t))return l;for(o=n.querySelectorAll("[href*='~'], [src*='~']"),s=0,a=o.length;a>s;s++)i=o[s].href||o[s].src,r=e.lang.string(i).replace("~").by(t),l=e.lang.string(l).replace(r).by(i);return l}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(n){e.dom.addClass(n,t),e.dom.removeClass(n,t);try{var o=n.ownerDocument;o.execCommand("italic",!1,null),o.execCommand("italic",!1,null)}catch(i){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(e,t){function n(){return d.observe(e,"mousedown",function(e){var t=wysihtml5.dom.getParentElement(e.target,{nodeName:["TD","TH"]});t&&o(t)}),u}function o(n){u.start=n,u.end=n,u.cells=[n],u.table=d.getParentElement(u.start,{nodeName:["TABLE"]}),u.table&&(i(),d.addClass(n,h),f=d.observe(e,"mousemove",a),m=d.observe(e,"mouseup",s),t.fire("tableselectstart").fire("tableselectstart:composer"))}function i(){var t,n;if(e&&(t=e.querySelectorAll("."+h),t.length>0))for(n=0;n<t.length;n++)d.removeClass(t[n],h)}function r(e){for(var t=0;t<e.length;t++)d.addClass(e[t],h)}function a(e){var n,o=null,a=d.getParentElement(e.target,{nodeName:["TD","TH"]});a&&u.table&&u.start&&(o=d.getParentElement(a,{nodeName:["TABLE"]}),o&&o===u.table&&(i(),n=u.end,u.end=a,u.cells=d.table.getCellsBetween(u.start,a),u.cells.length>1&&t.composer.selection.deselect(),r(u.cells),u.end!==n&&t.fire("tableselectchange").fire("tableselectchange:composer")))}function s(){f.stop(),m.stop(),t.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){l()},0)}function l(){var n=d.observe(e.ownerDocument,"click",function(e){n.stop(),d.getParentElement(e.target,{nodeName:["TABLE"]})!=u.table&&(i(),u.table=null,u.start=null,u.end=null,t.fire("tableunselect").fire("tableunselect:composer"))})}function c(e,n){u.start=e,u.end=n,u.table=d.getParentElement(u.start,{nodeName:["TABLE"]}),selectedCells=d.table.getCellsBetween(u.start,u.end),r(selectedCells),l(),t.fire("tableselect").fire("tableselect:composer")}var d=wysihtml5.dom,u={table:null,start:null,end:null,cells:null,select:c},h="wysiwyg-tmp-selected-cell",f=null,m=null;return n()},function(e){var t=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,n=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,o=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,i=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,r=function(e){return RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};e.quirks.styleParser={parseColor:function(a,s){var l,c,d,u=r(s),h=a.match(u),f=10;if(h){for(d=h.length;d--;)h[d]=e.lang.string(h[d].split(":")[1]).trim();if(l=h[h.length-1],t.test(l))c=l.match(t);else if(n.test(l))c=l.match(n);else if(o.test(l))c=l.match(o),f=16;else if(i.test(l))return c=l.match(i),c.shift(),c.push(1),e.lang.array(c).map(function(e,t){return 3>t?16*parseInt(e,16)+parseInt(e,16):parseFloat(e)});if(c)return c.shift(),c[3]||c.push(1),e.lang.array(c).map(function(e,t){return 3>t?parseInt(e,f):parseFloat(e)})}return!1},unparseColor:function(e,t){if(t){if("hex"==t)return e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();
if("hash"==t)return"#"+e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("rgb"==t)return"rgb("+e[0]+","+e[1]+","+e[2]+")";if("rgba"==t)return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")";if("csv"==t)return e[0]+","+e[1]+","+e[2]+","+e[3]}return e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(t){var n=t.match(r("font-size"));return n?e.lang.string(n[n.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}function n(e,t){for(var n=0;t!==e;)if(n++,t=t.parentNode,!t)throw Error("not a descendant of ancestor!");return n}function o(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,o=n(t,e.startContainer),i=n(t,e.endContainer);!e.canSurroundContents();)o>i?(e.setStartBefore(e.startContainer),o=n(t,e.startContainer)):(e.setEndAfter(e.endContainer),i=n(t,e.endContainer))}var i=e.dom;e.Selection=Base.extend({constructor:function(e,t,n){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&o(e),e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(t,n){var o=rangy.createRange(this.doc),r=t.nodeType===e.ELEMENT_NODE,a="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,s=r?t.innerHTML:t.data,l=""===s||s===e.INVISIBLE_SPACE,c=i.getStyle("display").from(t),d="block"===c||"list-item"===c;if(l&&r&&a&&!n)try{t.innerHTML=e.INVISIBLE_SPACE}catch(u){}a?o.selectNodeContents(t):o.selectNode(t),a&&l&&r?o.collapse(d):a&&l&&(o.setStartAfter(t),o.setEndAfter(t)),this.setSelection(o)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange(),n&&n.length)?n.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc),n?n.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var e=this.getRange();o(e),this.setSelection(e)},getSelectedOwnNodes:function(){var e,t,n=this.getOwnRanges(),o=[];for(e=0,t=n.length;t>e;e++)o.push(n[e].commonAncestorContainer||this.doc.body);return o},findNodesInSelection:function(t){var n,o,i,r=this.getOwnRanges(),a=[];for(o=0,i=r.length;i>o;o++)n=r[o].getNodes([1],function(n){return e.lang.array(t).contains(n.nodeName)}),a=a.concat(n);return a},containsUneditable:function(){var e,t,n=this.getOwnUneditables(),o=this.getSelection();for(e=0,t=n.length;t>e;e++)if(o.containsNode(n[e]))return!0;return!1},deleteContents:function(){var e,t=this.getOwnRanges();for(e=t.length;e--;)t[e].deleteContents();this.setSelection(t[0])},getPreviousNode:function(t,n){var o,i,r;return t||(o=this.getSelection(),t=o.anchorNode),t===this.contain?!1:(i=t.previousSibling,i===this.contain?!1:(i&&3!==i.nodeType&&1!==i.nodeType?i=this.getPreviousNode(i,n):i&&3===i.nodeType&&/^\s*$/.test(i.textContent)?i=this.getPreviousNode(i,n):n&&i&&1===i.nodeType&&!e.lang.array(["BR","HR","IMG"]).contains(i.nodeName)&&/^[\s]*$/.test(i.innerHTML)?i=this.getPreviousNode(i,n):i||t===this.contain||(r=t.parentNode,r!==this.contain&&(i=this.getPreviousNode(r,n))),i!==this.contain?i:!1))},getSelectionParentsByTag:function(){var t,n,o,i=this.getSelectedOwnNodes(),r=[];for(n=0,o=i.length;o>n;n++)t=i[n].nodeName&&"LI"===i[n].nodeName?i[n]:e.dom.getParentElement(i[n],{nodeName:["LI"]},!1,this.contain),t&&r.push(t);return r.length?r:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,o=rangy.createRange(this.doc);return o.selectNodeContents(t),o.setStart(t,n),o}},caretIsLastInSelection:function(){var e=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),t=e.textContent;return/^\s*$/.test(t)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),n=this.getSelection(),o=this.getRange(),i=o.startContainer;return i.nodeType===e.TEXT_NODE?this.isCollapsed()&&i.nodeType===e.TEXT_NODE&&/^\s*$/.test(i.data.substr(0,o.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===n.anchorNode||t.endContainer===n.anchorNode)&&t.startOffset===n.anchorOffset)},caretIsInTheBeginnig:function(t){var n=this.getSelection(),o=n.anchorNode,i=n.anchorOffset;return t?0===i&&(o.nodeName&&o.nodeName===t.toUpperCase()||e.dom.getParentElement(o.parentNode,{nodeName:t},1)):0===i&&!this.getPreviousNode(o,!0)},caretIsBeforeUneditable:function(){var e,t,n,o,i=this.getSelection(),r=i.anchorNode,a=i.anchorOffset;if(0===a&&(e=this.getPreviousNode(r,!0)))for(t=this.getOwnUneditables(),n=0,o=t.length;o>n;n++)if(e===t[n])return t[n];return!1},executeAndRestoreRangy:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.saveSelection(t);if(n)try{e()}catch(o){setTimeout(function(){throw o},0)}else e();rangy.restoreSelection(n)},executeAndRestore:function(t,n){var o,r,a,s,l,c,d,u,h,f=this.doc.body,m=n&&f.scrollTop,p=n&&f.scrollLeft,g="_wysihtml5-temp-placeholder",v='<span class="'+g+'">'+e.INVISIBLE_SPACE+"</span>",y=this.getRange(!0);if(!y)return void t(f,f);y.collapsed||(d=y.cloneRange(),c=d.createContextualFragment(v),d.collapse(!1),d.insertNode(c),d.detach()),l=y.createContextualFragment(v),y.insertNode(l),c&&(o=this.contain.querySelectorAll("."+g),y.setStartBefore(o[0]),y.setEndAfter(o[o.length-1])),this.setSelection(y);try{t(y.startContainer,y.endContainer)}catch(b){setTimeout(function(){throw b},0)}if(o=this.contain.querySelectorAll("."+g),o&&o.length)for(u=rangy.createRange(this.doc),a=o[0].nextSibling,o.length>1&&(s=o[o.length-1].previousSibling),s&&a?(u.setStartBefore(a),u.setEndAfter(s)):(r=this.doc.createTextNode(e.INVISIBLE_SPACE),i.insert(r).after(o[0]),u.setStartBefore(r),u.setEndAfter(r)),this.setSelection(u),h=o.length;h--;)o[h].parentNode.removeChild(o[h]);else this.contain.focus();n&&(f.scrollTop=m,f.scrollLeft=p);try{o.parentNode.removeChild(o)}catch(w){}},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t,n=(rangy.createRange(this.doc),this.doc.createElement("DIV")),o=this.doc.createDocumentFragment();for(n.innerHTML=e,t=n.lastChild;n.firstChild;)o.appendChild(n.firstChild);this.insertNode(o),t&&this.setAfter(t)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t,n,o=this.getOwnRanges(),i=[];if(0==o.length)return i;for(n=o.length;n--;){t=this.doc.createElement(e.nodeName),i.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{o[n].surroundContents(t),this.selectNode(t)}catch(r){t.appendChild(o[n].extractContents()),o[n].insertNode(t)}}return i},deblockAndSurround:function(t){var n,o,i,r=this.doc.createElement("div"),a=rangy.createRange(this.doc);if(r.className=t.className,this.composer.commands.exec("formatBlock",t.nodeName,t.className),n=this.contain.querySelectorAll("."+t.className),n[0])for(n[0].parentNode.insertBefore(r,n[0]),a.setStartBefore(n[0]),a.setEndAfter(n[n.length-1]),o=a.extractContents();o.firstChild;)if(i=o.firstChild,1==i.nodeType&&e.dom.hasClass(i,t.className)){for(;i.firstChild;)r.appendChild(i.firstChild);"BR"!==i.nodeName&&r.appendChild(this.doc.createElement("br")),o.removeChild(i)}else r.appendChild(i);else r=null;return r},scrollIntoView:function(){var n,o=this.doc,i=5,r=o.documentElement.scrollHeight>o.documentElement.offsetHeight,a=o._wysihtml5ScrollIntoViewElement=o._wysihtml5ScrollIntoViewElement||function(){var t=o.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();r&&(this.insertNode(a),n=t(a),a.parentNode.removeChild(a),n>=o.body.scrollTop+o.documentElement.offsetHeight-i&&(o.body.scrollTop=n))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView,t=e.getSelection();t.modify("move","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,n,o,i,r=this.doc.selection.createRange(),a=r.boundingTop,s=this.doc.body.scrollWidth;if(r.moveToPoint){for(0===a&&(n=this.doc.createElement("span"),this.insertNode(n),a=n.offsetTop,n.parentNode.removeChild(n)),a+=1,o=-10;s>o;o+=2)try{r.moveToPoint(o,a);break}catch(l){}for(e=a,t=this.doc.selection.createRange(),i=s;i>=0;i--)try{t.moveToPoint(i,e);break}catch(c){}r.setEndPoint("EndToEnd",t),r.select()}},getText:function(){var e=this.getSelection();return e?""+e:""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},fixRangeOverflow:function(e){var t,n;this.contain&&this.contain.firstChild&&e&&(t=e.compareNode(this.contain),2!==t?(1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(e)&&(n=e.endContainer.previousElementSibling,n&&e.setEnd(n,this._endOffsetForNode(n))))},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=i.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return e!==!0&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var t=i.query(this.contain,"."+this.unselectableClass),n=i.query(t,"."+this.unselectableClass);return e.lang.array(t).without(n)},getOwnRanges:function(){var e,t,n,o,i,r,a,s=[],l=this.getRange();if(l&&s.push(l),this.unselectableClass&&this.contain&&l&&(t=this.getOwnUneditables(),t.length>0))for(o=0,i=t.length;i>o;o++)for(e=[],r=0,a=s.length;a>r;r++){if(s[r])switch(s[r].compareNode(t[o])){case 2:break;case 3:n=s[r].cloneRange(),n.setEndBefore(t[o]),e.push(n),n=s[r].cloneRange(),n.setStartAfter(t[o]),e.push(n);break;default:e.push(s[r])}s=e}return s},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.getSelection(t);return n.setSingleRange(e)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(t){var n=this.getRange(),o=n.commonAncestorContainer,i=n.startContainer,r=n.endContainer;if(o.nodeType===e.TEXT_NODE&&(o=o.parentNode),i.nodeType===e.TEXT_NODE&&!/^\s*$/.test(i.data.substr(n.startOffset)))return!1;if(r.nodeType===e.TEXT_NODE&&!/^\s*$/.test(r.data.substr(n.endOffset)))return!1;for(;i&&i!==o;){if(i.nodeType!==e.TEXT_NODE&&!e.dom.contains(o,i))return!1;if(e.dom.domNode(i).prev({ignoreBlankTexts:!0}))return!1;i=i.parentNode}for(;r&&r!==o;){if(r.nodeType!==e.TEXT_NODE&&!e.dom.contains(o,r))return!1;if(e.dom.domNode(r).next({ignoreBlankTexts:!0}))return!1;r=r.parentNode}return e.lang.array(t).contains(o.nodeName)?o:!1},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(wysihtml5),function(e,t){function n(e,t,n){if(!e.className)return!1;var o=e.className.match(n)||[];return o[o.length-1]===t}function o(e,t){return e.getAttribute&&e.getAttribute("style")?(e.getAttribute("style").match(t),!!e.getAttribute("style").match(t)):!1}function i(e,t,n){e.getAttribute("style")?(s(e,n),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function r(e,t,n){e.className?(a(e,n),e.className+=" "+t):e.className=t}function a(e,t){e.className&&(e.className=e.className.replace(t,""))}function s(e,t){var n,o,i=[];if(e.getAttribute("style")){for(n=e.getAttribute("style").split(";"),o=n.length;o--;)n[o].match(t)||/^\s*$/.test(n[o])||i.push(n[o]);i.length?e.setAttribute("style",i.join(";")):e.removeAttribute("style")}}function l(e,t){var n,o,i,r=[],a=t.split(";"),s=e.getAttribute("style");if(s){for(s=s.replace(/\s/gi,"").toLowerCase(),r.push(RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi")),n=a.length;n-- >0;)/^\s*$/.test(a[n])||r.push(RegExp("(^|\\s|;)"+a[n].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(o=0,i=r.length;i>o;o++)if(s.match(r[o]))return r[o]}return!1}function c(n,o,i,r){return i?l(n,i):r?e.dom.hasClass(n,r):t.dom.arrayContains(o,n.tagName.toLowerCase())}function d(e,t,n,o){for(var i=e.length;i--;)if(!c(e[i],t,n,o))return!1;return!!e.length}function u(e,t,n){var o=l(e,t);return o?(s(e,o),"remove"):(i(e,t,n),"change")}function h(e,t){return e.className.replace(w," ")==t.className.replace(w," ")}function f(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function m(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,o,i,r=0,a=e.attributes.length;a>r;++r)if(n=e.attributes[r],i=n.name,"class"!=i){if(o=t.attributes.getNamedItem(i),n.specified!=o.specified)return!1;if(n.specified&&n.nodeValue!==o.nodeValue)return!1}return!0}function p(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:n>0&&n<e.childNodes.length}function g(e,n,o,i){var r,a;if(t.dom.isCharacterDataNode(n)&&(0==o?(o=t.dom.getNodeIndex(n),n=n.parentNode):o==n.length?(o=t.dom.getNodeIndex(n)+1,n=n.parentNode):r=t.dom.splitDataNode(n,o)),!(r||i&&n===i)){for(r=n.cloneNode(!1),r.id&&r.removeAttribute("id");a=n.childNodes[o];)r.appendChild(a);t.dom.insertAfter(r,n)}return n==e?r:g(e,r.parentNode,t.dom.getNodeIndex(r),i)}function v(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function y(e,t,n,o,i,r,a){this.tagNames=e||[b],this.cssClass=t||(t===!1?!1:""),this.similarClassRegExp=n,this.cssStyle=i||"",this.similarStyleRegExp=r,this.normalize=o,this.applyToAnyTagName=!1,this.container=a}var b="span",w=/\s+/g;v.prototype={doMerge:function(){var e,t,n,o,i,r=[];for(o=0,i=this.textNodes.length;i>o;++o)e=this.textNodes[o],t=e.parentNode,r[o]=e.data,o&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=r.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e,t,n=[];for(e=0,t=this.textNodes.length;t>e;++e)n[e]="'"+this.textNodes[e].data+"'";return"[Merge("+n.join(",")+")]"}},y.prototype={getAncestorWithClass:function(o){for(var i;o;){if(i=this.cssClass?n(o,this.cssClass,this.similarClassRegExp):""===this.cssStyle,o.nodeType==e.ELEMENT_NODE&&"false"!=o.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,o.tagName.toLowerCase())&&i)return o;o=o.parentNode}return!1},getAncestorWithStyle:function(n){for(var i;n;){if(i=this.cssStyle?o(n,this.similarStyleRegExp):!1,n.nodeType==e.ELEMENT_NODE&&"false"!=n.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&i)return n;n=n.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),n=!1;return t?this.cssStyle&&(n="class"):(t=this.getAncestorWithStyle(e),t&&(n="style")),{element:t,type:n}},postApply:function(e,t){var n,o,i,r,a,s,l=e[0],c=e[e.length-1],d=[],u=l,h=c,f=0,m=c.length;for(r=0,a=e.length;a>r;++r)o=e[r],i=null,o&&o.parentNode&&(i=this.getAdjacentMergeableTextNode(o.parentNode,!1)),i?(n||(n=new v(i),d.push(n)),n.textNodes.push(o),o===l&&(u=n.firstTextNode,f=u.length),o===c&&(h=n.firstTextNode,m=n.getLength())):n=null;if(c&&c.parentNode&&(s=this.getAdjacentMergeableTextNode(c.parentNode,!0),s&&(n||(n=new v(c),d.push(n)),n.textNodes.push(s))),d.length){for(r=0,a=d.length;a>r;++r)d[r].doMerge();t.setStart(u,f),t.setEnd(h,m)}},getAdjacentMergeableTextNode:function(t,n){var o,i=t.nodeType==e.TEXT_NODE,r=i?t.parentNode:t,a=n?"nextSibling":"previousSibling";if(i){if(o=t[a],o&&o.nodeType==e.TEXT_NODE)return o}else if(o=r[a],o&&this.areElementsMergeable(t,o))return o[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&h(e,n)&&m(e,n)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var n,o=e.parentNode;1==o.childNodes.length&&t.dom.arrayContains(this.tagNames,o.tagName.toLowerCase())?(this.cssClass&&r(o,this.cssClass,this.similarClassRegExp),this.cssStyle&&i(o,this.cssStyle,this.similarStyleRegExp)):(n=this.createContainer(t.dom.getDocument(e)),e.parentNode.insertBefore(n,e),n.appendChild(e))},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&""===e.lang.string(n.className).trim()&&(!n.getAttribute("style")||""===e.lang.string(n.getAttribute("style")).trim())},undoToTextNode:function(e,t,n,o){var i,r=!n,s=n||o,l=!1;t.containsNode(s)||(i=t.cloneRange(),i.selectNode(s),i.isPointInRange(t.endContainer,t.endOffset)&&p(t.endContainer,t.endOffset)&&(g(s,t.endContainer,t.endOffset,this.container),t.setEndAfter(s)),i.isPointInRange(t.startContainer,t.startOffset)&&p(t.startContainer,t.startOffset)&&(s=g(s,t.startContainer,t.startOffset,this.container))),!r&&this.similarClassRegExp&&a(s,this.similarClassRegExp),r&&this.similarStyleRegExp&&(l="change"===u(s,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(s)&&!l&&f(s)},applyToRange:function(t){var n,o,i,r,a,s;for(o=t.length;o--;){if(n=t[o].getNodes([e.TEXT_NODE]),!n.length)try{return i=this.createContainer(t[o].endContainer.ownerDocument),t[o].surroundContents(i),void this.selectNode(t[o],i)}catch(l){}if(t[o].splitBoundaries(),n=t[o].getNodes([e.TEXT_NODE]),n.length){for(a=0,s=n.length;s>a;++a)r=n[a],this.getMatchingAncestor(r).element||this.applyToTextNode(r);t[o].setStart(n[0],0),r=n[n.length-1],t[o].setEnd(r,r.length),this.normalize&&this.postApply(n,t[o])}}},undoToRange:function(t){var n,o,i,r,a,s,l,c;for(r=t.length;r--;){for(n=t[r].getNodes([e.TEXT_NODE]),n.length?(t[r].splitBoundaries(),n=t[r].getNodes([e.TEXT_NODE])):(a=t[r].endContainer.ownerDocument,s=a.createTextNode(e.INVISIBLE_SPACE),t[r].insertNode(s),t[r].selectNode(s),n=[s]),l=0,c=n.length;c>l;++l)t[r].isValid()&&(o=n[l],i=this.getMatchingAncestor(o),"style"===i.type?this.undoToTextNode(o,t[r],!1,i.element):i.element&&this.undoToTextNode(o,t[r],i.element));1==c?this.selectNode(t[r],n[0]):(t[r].setStart(n[0],0),o=n[n.length-1],t[r].setEnd(o,o.length),this.normalize&&this.postApply(n,t[r]))}},selectNode:function(t,n){var o=n.nodeType===e.ELEMENT_NODE,i="canHaveHTML"in n?n.canHaveHTML:!0,r=o?n.innerHTML:n.data,a=""===r||r===e.INVISIBLE_SPACE;if(a&&o&&i)try{n.innerHTML=e.INVISIBLE_SPACE}catch(s){}t.selectNodeContents(n),a&&o?t.collapse(!1):a&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n,o,i=t.cloneRange();return i.selectNodeContents(e),n=i.intersection(t),o=n?""+n:"",i.detach(),o},isAppliedToRange:function(t){var n,o,i,r,a,s,l=[],c="full";for(i=t.length;i--;){if(o=t[i].getNodes([e.TEXT_NODE]),!o.length)return n=this.getMatchingAncestor(t[i].startContainer).element,n?{elements:[n],coverage:c}:!1;for(r=0,a=o.length;a>r;++r)s=this.getTextSelectedByRange(o[r],t[i]),n=this.getMatchingAncestor(o[r]).element,n&&""!=s?(l.push(n),1===e.dom.getTextNodes(n,!0).length?c="full":"full"===c&&(c="inline")):n||(c="partial")}return l.length?{elements:l,coverage:c}:!1},toggleRange:function(e){var t,n=this.isAppliedToRange(e);n?"full"===n.coverage?this.undoToRange(e):"inline"===n.coverage?(t=d(n.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),t||this.applyToRange(e)):(d(n.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},e.selection.HTMLApplier=y}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml5.commands[e],o=wysihtml5.lang.array(arguments).get(),i=n&&n.exec,r=null;if(this.editor.fire("beforecommand:composer"),i)o.unshift(this.composer),r=i.apply(n,o);else try{r=this.doc.execCommand(e,!1,t)}catch(a){}return this.editor.fire("aftercommand:composer"),r},state:function(e){var t=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),o=t&&t.state;if(o)return n.unshift(this.composer),o.apply(t,n);try{return this.doc.queryCommandState(e)}catch(i){return!1}},stateValue:function(e){var t=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),o=t&&t.stateValue;return o?(n.unshift(this.composer),o.apply(t,n)):!1}}),wysihtml5.commands.bold={exec:function(e,t){wysihtml5.commands.formatInline.execWithToggle(e,t,"b")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"b")}},function(e){function t(t,n){var a,s,l,c,d,u,h,f,m,p=t.doc,g="_wysihtml5-temp-"+ +new Date,v=/non-matching-class/g,y=0;for(e.commands.formatInline.exec(t,o,i,g,v,o,o,!0,!0),s=p.querySelectorAll(i+"."+g),a=s.length;a>y;y++){l=s[y],l.removeAttribute("class");for(m in n)"text"!==m&&l.setAttribute(m,n[m])}u=l,1===a&&(h=r.getTextContent(l),c=!!l.querySelector("*"),d=""===h||h===e.INVISIBLE_SPACE,!c&&d&&(r.setTextContent(l,n.text||l.href),f=p.createTextNode(" "),t.selection.setAfter(l),r.insert(f).after(l),u=f)),t.selection.setAfter(u)}function n(e,t,n){var o,i,r,a;for(i=t.length;i--;){for(o=t[i].attributes,r=o.length;r--;)t[i].removeAttribute(o.item(r).name);for(a in n)n.hasOwnProperty(a)&&t[i].setAttribute(a,n[a])}}var o,i="A",r=e.dom;e.commands.createLink={exec:function(e,o,i){var r=this.state(e,o);r?e.selection.executeAndRestore(function(){n(e,r,i)}):(i="object"==typeof i?i:{href:i},t(e,i))},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),function(e){function t(e,t){for(var o,i,r,a=t.length,s=0;a>s;s++)o=t[s],i=n.getParentElement(o,{nodeName:"code"}),r=n.getTextContent(o),r.match(n.autoLink.URL_REG_EXP)&&!i?i=n.renameElement(o,"code"):n.replaceWithChildNodes(o)}var n=e.dom;e.commands.removeLink={exec:function(e,n){var o=this.state(e,n);o&&e.selection.executeAndRestore(function(){t(e,o)})},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),function(e){var t=/wysiwyg-font-size-[0-9a-z\-]+/g;e.commands.fontSize={exec:function(n,o,i){e.commands.formatInline.execWithToggle(n,o,"span","wysiwyg-font-size-"+i,t)},state:function(n,o,i){return e.commands.formatInline.state(n,o,"span","wysiwyg-font-size-"+i,t)}}}(wysihtml5),function(e){var t=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;e.commands.fontSizeStyle={exec:function(n,o,i){i="object"==typeof i?i.size:i,/^\s*$/.test(i)||e.commands.formatInline.execWithToggle(n,o,"span",!1,!1,"font-size:"+i,t)},state:function(n,o){return e.commands.formatInline.state(n,o,"span",!1,!1,"font-size",t)},stateValue:function(t,n){var o,i=this.state(t,n);return i&&e.lang.object(i).isArray()&&(i=i[0]),i&&(o=i.getAttribute("style"))?e.quirks.styleParser.parseFontSize(o):!1}}}(wysihtml5),function(e){var t=/wysiwyg-color-[0-9a-z]+/g;e.commands.foreColor={exec:function(n,o,i){e.commands.formatInline.execWithToggle(n,o,"span","wysiwyg-color-"+i,t)},state:function(n,o,i){return e.commands.formatInline.state(n,o,"span","wysiwyg-color-"+i,t)}}}(wysihtml5),function(e){var t=/(\s|^)color\s*:\s*[^;\s]+;?/gi;e.commands.foreColorStyle={exec:function(n,o,i){var r,a=e.quirks.styleParser.parseColor("object"==typeof i?"color:"+i.color:"color:"+i,"color");a&&(r="color: rgb("+a[0]+","+a[1]+","+a[2]+");",1!==a[3]&&(r+="color: rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+");"),e.commands.formatInline.execWithToggle(n,o,"span",!1,!1,r,t))},state:function(n,o){return e.commands.formatInline.state(n,o,"span",!1,!1,"color",t)},stateValue:function(t,n,o){var i,r=this.state(t,n);return r&&e.lang.object(r).isArray()&&(r=r[0]),r&&(i=r.getAttribute("style"),i&&i)?(val=e.quirks.styleParser.parseColor(i,"color"),e.quirks.styleParser.unparseColor(val,o)):!1}}}(wysihtml5),function(e){var t=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;e.commands.bgColorStyle={exec:function(n,o,i){var r,a=e.quirks.styleParser.parseColor("object"==typeof i?"background-color:"+i.color:"background-color:"+i,"background-color");a&&(r="background-color: rgb("+a[0]+","+a[1]+","+a[2]+");",1!==a[3]&&(r+="background-color: rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+");"),e.commands.formatInline.execWithToggle(n,o,"span",!1,!1,r,t))},state:function(n,o){return e.commands.formatInline.state(n,o,"span",!1,!1,"background-color",t)},stateValue:function(t,n,o){var i,r=this.state(t,n),a=!1;return r&&e.lang.object(r).isArray()&&(r=r[0]),r&&(i=r.getAttribute("style"))?(a=e.quirks.styleParser.parseColor(i,"background-color"),e.quirks.styleParser.unparseColor(a,o)):!1}}}(wysihtml5),function(e){function t(t,n,i){t.className?(o(t,i),t.className=e.lang.string(t.className+" "+n).trim()):t.className=n}function n(t,n,o){i(t,o),t.getAttribute("style")?t.setAttribute("style",e.lang.string(t.getAttribute("style")+" "+n).trim()):t.setAttribute("style",n)}function o(t,n){var o=n.test(t.className);return t.className=t.className.replace(n,""),""==e.lang.string(t.className).trim()&&t.removeAttribute("class"),o}function i(t,n){var o=n.test(t.getAttribute("style"));return t.setAttribute("style",(t.getAttribute("style")||"").replace(n,"")),""==e.lang.string(t.getAttribute("style")||"").trim()&&t.removeAttribute("style"),o}function r(e){var t=e.lastChild;t&&a(t)&&t.parentNode.removeChild(t)}function a(e){return"BR"===e.nodeName}function s(t,n){var o,i,a;for(t.selection.isCollapsed()&&t.selection.selectLine(),o=t.selection.surround(n),i=0,a=o.length;a>i;i++)e.dom.lineBreaks(o[i]).remove(),r(o[i])}function l(t){return!!e.lang.string(t.className).trim()}function c(t){return!!e.lang.string(t.getAttribute("style")||"").trim()}var d=e.dom,u=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];e.commands.formatBlock={exec:function(r,a,h,f,m,p,g){var v,y,b,w,C,N=(r.doc,this.state(r,a,h,f,m,p,g)),x=r.config.useLineBreaks,E=x?"DIV":"P";return h="string"==typeof h?h.toUpperCase():h,N.length?void r.selection.executeAndRestoreRangy(function(){var t,n,r;for(t=N.length;t--;){if(m&&(y=o(N[t],m)),g&&(w=i(N[t],g)),(w||y)&&null===h&&N[t].nodeName!=E)return;n=l(N[t]),r=c(N[t]),n||r||!x&&"P"!==h?d.renameElement(N[t],"P"===h?"DIV":E):(e.dom.lineBreaks(N[t]).add(),d.replaceWithChildNodes(N[t]))}}):void((null!==h&&!e.lang.array(u).contains(h)||(v=r.selection.findNodesInSelection(u).concat(r.selection.getSelectedOwnNodes()),r.selection.executeAndRestoreRangy(function(){for(var e=v.length;e--;)C=d.getParentElement(v[e],{nodeName:u}),C==r.element&&(C=null),C&&(h&&(C=d.renameElement(C,h)),f&&t(C,f,m),p&&n(C,p,g),b=!0)}),!b))&&s(r,{nodeName:h||E,className:f||null,cssStyle:p||null}))},state:function(t,n,o,i,r,a,s){var l,c,u,h=t.selection.getSelectedOwnNodes(),f=[];for(o="string"==typeof o?o.toUpperCase():o,c=0,u=h.length;u>c;c++)l=d.getParentElement(h[c],{nodeName:o,className:i,classRegExp:r,cssStyle:a,styleRegExp:s}),l&&-1==e.lang.array(f).indexOf(l)&&f.push(l);return 0==f.length?!1:f}}}(wysihtml5),wysihtml5.commands.formatCode={exec:function(e,t,n){var o,i,r,a=this.state(e);a?e.selection.executeAndRestore(function(){o=a.querySelector("code"),wysihtml5.dom.replaceWithChildNodes(a),o&&wysihtml5.dom.replaceWithChildNodes(o)}):(i=e.selection.getRange(),r=i.extractContents(),a=e.doc.createElement("pre"),o=e.doc.createElement("code"),n&&(o.className=n),a.appendChild(o),o.appendChild(r),i.insertNode(a),e.selection.selectNode(a))},state:function(e){var t=e.selection.getSelectedNode();return t&&t.nodeName&&"PRE"==t.nodeName&&t.firstChild&&t.firstChild.nodeName&&"CODE"==t.firstChild.nodeName?t:wysihtml5.dom.getParentElement(t,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(t,{nodeName:"PRE"})}},function(e){function t(e){var t=o[e];return t?[e.toLowerCase(),t.toLowerCase()]:[e.toLowerCase()]}function n(n,o,r,a,s,l){var c=n;return o&&(c+=":"+o),a&&(c+=":"+a),i[c]||(i[c]=new e.selection.HTMLApplier(t(n),o,r,!0,a,s,l)),i[c]}var o={strong:"b",em:"i",b:"strong",i:"em"},i={};e.commands.formatInline={exec:function(e,t,o,i,r,a,s,l,c){var d=e.selection.createRange(),u=e.selection.getOwnRanges();return u&&0!=u.length?(e.selection.getSelection().removeAllRanges(),n(o,i,r,a,s,e.element).toggleRange(u),void(l?c||e.cleanUp():(d.setStart(u[0].startContainer,u[0].startOffset),d.setEnd(u[u.length-1].endContainer,u[u.length-1].endOffset),e.selection.setSelection(d),e.selection.executeAndRestore(function(){c||e.cleanUp()},!0,!0)))):!1},execWithToggle:function(t,n,o,i,r,a,s){var l,c=this;this.state(t,n,o,i,r,a,s)&&t.selection.isCollapsed()&&!t.selection.caretIsLastInSelection()&&!t.selection.caretIsFirstInSelection()?(l=c.state(t,n,o,i,r)[0],t.selection.executeAndRestoreRangy(function(){l.parentNode,t.selection.selectNode(l,!0),e.commands.formatInline.exec(t,n,o,i,r,a,s,!0,!0)})):this.state(t,n,o,i,r,a,s)&&!t.selection.isCollapsed()?t.selection.executeAndRestoreRangy(function(){e.commands.formatInline.exec(t,n,o,i,r,a,s,!0,!0)}):e.commands.formatInline.exec(t,n,o,i,r,a,s)},state:function(t,i,r,a,s,l,c){var d,u,h=t.doc,f=o[r]||r;return e.dom.hasElementWithTagName(h,r)||e.dom.hasElementWithTagName(h,f)?a&&!e.dom.hasElementWithClassName(h,a)?!1:(d=t.selection.getOwnRanges(),d&&0!==d.length?(u=n(r,a,s,l,c,t.element).isAppliedToRange(d),u&&u.elements?u.elements:!1):!1):!1}}}(wysihtml5),function(e){e.commands.insertBlockQuote={exec:function(t,n){var o=this.state(t,n),i=t.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);t.selection.executeAndRestore(function(){if(o)t.config.useLineBreaks&&e.dom.lineBreaks(o).add(),e.dom.unwrap(o);else if(t.selection.isCollapsed()&&t.selection.selectLine(),i){var n=i.ownerDocument.createElement("blockquote");e.dom.insert(n).after(i),n.appendChild(i)}else t.selection.surround({nodeName:"blockquote"})})},state:function(t){var n=t.selection.getSelectedNode(),o=e.dom.getParentElement(n,{nodeName:"BLOCKQUOTE"},!1,t.element);return o?o:!1}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}},function(e){var t="IMG";e.commands.insertImage={exec:function(n,o,i){var r,a,s,l,c;if(i="object"==typeof i?i:{src:i},r=n.doc,a=this.state(n))return n.selection.setBefore(a),l=a.parentNode,l.removeChild(a),e.dom.removeEmptyTextNodes(l),"A"!==l.nodeName||l.firstChild||(n.selection.setAfter(l),l.parentNode.removeChild(l)),void e.quirks.redraw(n.element);a=r.createElement(t);for(c in i)a.setAttribute("className"===c?"class":c,i[c]);n.selection.insertNode(a),e.browser.hasProblemsSettingCaretAfterImg()?(s=r.createTextNode(e.INVISIBLE_SPACE),n.selection.insertNode(s),n.selection.setAfter(s)):n.selection.setAfter(a)},state:function(n){var o,i,r,a=n.doc;return e.dom.hasElementWithTagName(a,t)?(o=n.selection.getSelectedNode(),o?o.nodeName===t?o:o.nodeType!==e.ELEMENT_NODE?!1:(i=n.selection.getText(),i=e.lang.string(i).trim(),i?!1:(r=n.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==r.length?!1:r[0])):!1):!1}}}(wysihtml5),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(n,o){
n.commands.support(o)?(n.doc.execCommand(o,!1,null),e.browser.autoScrollsToCaret()||n.selection.scrollIntoView()):n.commands.exec("insertHTML",t)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(e,t){wysihtml5.commands.insertList.exec(e,t,"OL")},state:function(e,t){return wysihtml5.commands.insertList.state(e,t,"OL")}},wysihtml5.commands.insertUnorderedList={exec:function(e,t){wysihtml5.commands.insertList.exec(e,t,"UL")},state:function(e,t){return wysihtml5.commands.insertList.state(e,t,"UL")}},wysihtml5.commands.insertList=function(e){var t=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},n=function(n,o,i){var r,a,s={el:null,other:!1};return n&&(r=e.dom.getParentElement(n,{nodeName:"LI"}),a="UL"===o?"OL":"UL",t(n,o)?s.el=n:t(n,a)?s={el:n,other:!0}:r&&(t(r.parentNode,o)?s.el=r.parentNode:t(r.parentNode,a)&&(s={el:r.parentNode,other:!0}))),s.el&&!i.element.contains(s.el)&&(s.el=null),s},o=function(t,n,o){var i,a="UL"===n?"OL":"UL";o.selection.executeAndRestore(function(){var s,l,c=r(a,o);if(c.length)for(s=c.length;s--;)e.dom.renameElement(c[s],n.toLowerCase());else{for(i=r(["OL","UL"],o),l=i.length;l--;)e.dom.resolveList(i[l],o.config.useLineBreaks);e.dom.resolveList(t,o.config.useLineBreaks)}})},i=function(t,n,o){var i="UL"===n?"OL":"UL";o.selection.executeAndRestore(function(){var a,s=[t].concat(r(i,o));for(a=s.length;a--;)e.dom.renameElement(s[a],n.toLowerCase())})},r=function(e,n){var o,i=n.selection.getOwnRanges(),r=[];for(o=i.length;o--;)r=r.concat(i[o].getNodes([1],function(n){return t(n,e)}));return r},a=function(t,n){n.selection.executeAndRestoreRangy(function(){var o,i,r="_wysihtml5-temp-"+(new Date).getTime(),a=n.selection.deblockAndSurround({nodeName:"div",className:r}),s=/\uFEFF/g;a.innerHTML=a.innerHTML.replace(s,""),a&&(o=e.lang.array(["","<br>",e.INVISIBLE_SPACE]).contains(a.innerHTML),i=e.dom.convertToList(a,t.toLowerCase(),n.parent.config.uneditableContainerClassname),o&&n.selection.selectNode(i.querySelector("li"),!0))})};return{exec:function(e,t,r){var s=e.doc,l="OL"===r?"insertOrderedList":"insertUnorderedList",c=e.selection.getSelectedNode(),d=n(c,r,e);d.el?d.other?i(d.el,r,e):o(d.el,r,e):e.commands.support(l)?s.execCommand(l,!1,null):a(r,e)},state:function(e,t,o){var i=e.selection.getSelectedNode(),r=n(i,o,e);return r.el&&!r.other?r.el:!1}}}(wysihtml5),wysihtml5.commands.italic={exec:function(e,t){wysihtml5.commands.formatInline.execWithToggle(e,t,"i")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"i")}},function(e){var t="wysiwyg-text-align-center",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyCenter={exec:function(o){return e.commands.formatBlock.exec(o,"formatBlock",null,t,n)},state:function(o){return e.commands.formatBlock.state(o,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-left",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyLeft={exec:function(o){return e.commands.formatBlock.exec(o,"formatBlock",null,t,n)},state:function(o){return e.commands.formatBlock.state(o,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-right",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyRight={exec:function(o){return e.commands.formatBlock.exec(o,"formatBlock",null,t,n)},state:function(o){return e.commands.formatBlock.state(o,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-justify",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyFull={exec:function(o){return e.commands.formatBlock.exec(o,"formatBlock",null,t,n)},state:function(o){return e.commands.formatBlock.state(o,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="text-align: right;",n=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;e.commands.alignRightStyle={exec:function(o){return e.commands.formatBlock.exec(o,"formatBlock",null,null,null,t,n)},state:function(o){return e.commands.formatBlock.state(o,"formatBlock",null,null,null,t,n)}}}(wysihtml5),function(e){var t="text-align: left;",n=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;e.commands.alignLeftStyle={exec:function(o){return e.commands.formatBlock.exec(o,"formatBlock",null,null,null,t,n)},state:function(o){return e.commands.formatBlock.state(o,"formatBlock",null,null,null,t,n)}}}(wysihtml5),function(e){var t="text-align: center;",n=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;e.commands.alignCenterStyle={exec:function(o){return e.commands.formatBlock.exec(o,"formatBlock",null,null,null,t,n)},state:function(o){return e.commands.formatBlock.state(o,"formatBlock",null,null,null,t,n)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(){return!1}},wysihtml5.commands.underline={exec:function(e,t){wysihtml5.commands.formatInline.execWithToggle(e,t,"u")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"u")}},wysihtml5.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(){return!1}},wysihtml5.commands.createTable={exec:function(e,t,n){var o,i,r;if(n&&n.cols&&n.rows&&parseInt(n.cols,10)>0&&parseInt(n.rows,10)>0){for(r=n.tableStyle?'<table style="'+n.tableStyle+'">':"<table>",r+="<tbody>",i=0;i<n.rows;i++){for(r+="<tr>",o=0;o<n.cols;o++)r+="<td>&nbsp;</td>";r+="</tr>"}r+="</tbody></table>",e.commands.exec("insertHTML",r)}},state:function(){return!1}},wysihtml5.commands.mergeTableCells={exec:function(e,t){e.tableSelection&&e.tableSelection.start&&e.tableSelection.end&&(this.state(e,t)?wysihtml5.dom.table.unmergeCell(e.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(e.tableSelection.start,e.tableSelection.end))},state:function(e){if(e.tableSelection){var t=e.tableSelection.start,n=e.tableSelection.end;if(t&&n&&t==n&&(wysihtml5.dom.getAttribute(t,"colspan")&&parseInt(wysihtml5.dom.getAttribute(t,"colspan"),10)>1||wysihtml5.dom.getAttribute(t,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(t,"rowspan"),10)>1))return[t]}return!1}},wysihtml5.commands.addTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var o=wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end);"before"==n||"above"==n?wysihtml5.dom.table.addCells(o.start,n):("after"==n||"below"==n)&&wysihtml5.dom.table.addCells(o.end,n),setTimeout(function(){e.tableSelection.select(o.start,o.end)},0)}},state:function(){return!1}},wysihtml5.commands.deleteTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var o,i=wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end),r=wysihtml5.dom.table.indexOf(i.start),a=e.tableSelection.table;wysihtml5.dom.table.removeCells(i.start,n),setTimeout(function(){o=wysihtml5.dom.table.findCell(a,r),o||("row"==n&&(o=wysihtml5.dom.table.findCell(a,{row:r.row-1,col:r.col})),"column"==n&&(o=wysihtml5.dom.table.findCell(a,{row:r.row,col:r.col-1}))),o&&e.tableSelection.select(o,o)},0)}},state:function(){return!1}},wysihtml5.commands.indentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPushLiLevel(t,e.selection):!1},state:function(){return!1},tryToPushLiLevel:function(e,t){var n,o,i,r,a,s=!1;return t.executeAndRestoreRangy(function(){for(var t=e.length;t--;)r=e[t],n="OL"===r.parentNode.nodeName?"OL":"UL",o=r.ownerDocument.createElement(n),i=wysihtml5.dom.domNode(r).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),a=i?i.querySelector("ul, ol"):null,i&&(a?a.appendChild(r):(o.appendChild(r),i.appendChild(o)),s=!0)}),s}},wysihtml5.commands.outdentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPullLiLevel(t,e):!1},state:function(){return!1},tryToPullLiLevel:function(e,t){var n,o,i,r,a,s=!1,l=this;return t.selection.executeAndRestoreRangy(function(){var c,d;for(c=e.length;c--;)if(r=e[c],r.parentNode&&(n=r.parentNode,"OL"===n.tagName||"UL"===n.tagName)){if(s=!0,o=wysihtml5.dom.getParentElement(n.parentNode,{nodeName:["OL","UL"]},!1,t.element),i=wysihtml5.dom.getParentElement(n.parentNode,{nodeName:["LI"]},!1,t.element),o&&i)r.nextSibling&&(a=l.getAfterList(n,r),r.appendChild(a)),o.insertBefore(r,i.nextSibling);else{for(r.nextSibling&&(a=l.getAfterList(n,r),r.appendChild(a)),d=r.childNodes.length;d--;)n.parentNode.insertBefore(r.childNodes[d],n.nextSibling);n.parentNode.insertBefore(document.createElement("br"),n.nextSibling),r.parentNode.removeChild(r)}0===n.childNodes.length&&n.parentNode.removeChild(n)}}),s},getAfterList:function(e,t){for(var n=e.nodeName,o=document.createElement(n);t.nextSibling;)o.appendChild(t.nextSibling);return o}},function(e){var t=90,n=89,o=8,i=46,r=25,a="data-wysihtml5-selection-node",s="data-wysihtml5-selection-offset",l=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",e.dom);e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var e,r=this;this.composer.sandbox.getDocument(),l.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var o=e.keyCode,i=o===t&&!e.shiftKey,a=o===t&&e.shiftKey||o===n;i?(r.undo(),e.preventDefault()):a&&(r.redo(),e.preventDefault())}}),l.observe(this.element,"keydown",function(t){var n=t.keyCode;n!==e&&(e=n,(n===o||n===i)&&r.transact())}),this.editor.on("newword:composer",function(){r.transact()}).on("beforecommand:composer",function(){r.transact()})},transact:function(){var t,n,o,i,l,c,d,u=this.historyStr[this.position-1],h=this.composer.getValue(!1,!1),f=this.element.offsetWidth>0&&this.element.offsetHeight>0;h!==u&&(c=this.historyStr.length=this.historyDom.length=this.position,c>r&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,f&&(t=this.composer.selection.getRange(),n=t&&t.startContainer?t.startContainer:this.element,o=t&&t.startOffset?t.startOffset:0,n.nodeType===e.ELEMENT_NODE?i=n:(i=n.parentNode,l=this.getChildNodeIndex(i,n)),i.setAttribute(s,o),void 0!==l&&i.setAttribute(a,l)),d=this.element.cloneNode(!!h),this.historyDom.push(d),this.historyStr.push(h),i&&(i.removeAttribute(s),i.removeAttribute(a)))},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){var t,n,o,i,r,l;for(this.element.innerHTML="",t=0,n=e.childNodes,o=e.childNodes.length;o>t;t++)this.element.appendChild(n[t].cloneNode(!0));e.hasAttribute(s)?(i=e.getAttribute(s),l=e.getAttribute(a),r=this.element):(r=this.element.querySelector("["+s+"]")||this.element,i=r.getAttribute(s),l=r.getAttribute(a),r.removeAttribute(s),r.removeAttribute(a)),null!==l&&(r=this.getChildNodeByIndex(r,+l)),this.composer.selection.set(r,i)},getChildNodeIndex:function(e,t){for(var n=0,o=e.childNodes,i=o.length;i>n;n++)if(o[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t,n){var o=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(o=this.parent.parse(o,n!==!1)),o},setValue:function(e,t){t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(n){this.element.innerText=e}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&this.selection&&("BR"===n.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){e._create()},{},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){e._create()}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e,n=this;this.sandbox=new t.Sandbox(function(){n._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe(),e=this.textarea.element,t.insert(this.editableArea).after(e),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml5_mode",e.value=1,t.insert(e).after(this.textarea.element)}},_create:function(){var o,i,r=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new e.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new e.Commands(this.parent),this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe(),o=this.config.name,o&&(t.addClass(this.element,o),this.config.contentEditableMode||t.addClass(this.editableArea,o)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable(),i="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"),i&&t.simulatePlaceholder(this.parent,this,i),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||n.isIos()||setTimeout(function(){r.focus(!0)},100),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var o,i,r,a=this,s=n.canDisableAutoLinking(),l=n.doesAutoLinkingInContentEditable();s&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink&&((!l||l&&s)&&(this.parent.on("newword:composer",function(){t.getTextContent(a.element).match(t.autoLink.URL_REG_EXP)&&a.selection.executeAndRestore(function(n,o){var i,r=a.element.querySelectorAll("."+a.config.uneditableContainerClassname),s=!1;for(i=r.length;i--;)e.dom.contains(r[i],o)&&(s=!0);s||t.autoLink(o.parentNode,[a.config.uneditableContainerClassname])})}),t.observe(this.element,"blur",function(){t.autoLink(a.element,[a.config.uneditableContainerClassname])})),o=this.sandbox.getDocument().getElementsByTagName("a"),i=t.autoLink.URL_REG_EXP,r=function(n){var o=e.lang.string(t.getTextContent(n)).trim();return"www."===o.substr(0,4)&&(o="http://"+o),o},t.observe(this.element,"keydown",function(e){if(o.length){var n,s=a.selection.getSelectedNode(e.target.ownerDocument),l=t.getParentElement(s,{nodeName:"A"},4);l&&(n=r(l),setTimeout(function(){var e=r(l);e!==n&&e.match(i)&&l.setAttribute("href",e)},0))}}))},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),n.supportsEvent("resizeend")){var o=["width","height"],i=o.length,r=this.element;t.observe(r,"resizeend",function(t){var n,a=t.target||t.srcElement,s=a.style,l=0;if("IMG"===a.nodeName){for(;i>l;l++)n=o[l],s[n]&&(a.setAttribute(n,parseInt(s[n],10)),s[n]="");e.quirks.redraw(r)}})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function o(e){var n=t.getParentElement(e,{nodeName:["P","DIV"]},2);n&&t.contains(i.element,n)&&i.selection.executeAndRestore(function(){i.config.useLineBreaks?t.replaceWithChildNodes(n):"P"!==n.nodeName&&t.renameElement(n,"p")})}var i=this,r=["LI","P","H1","H2","H3","H4","H5","H6"],a=["UL","OL","MENU"];this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(i.isEmpty()){var e=i.doc.createElement("P");i.element.innerHTML="",i.element.appendChild(e),n.displaysCaretInEmptyContentEditableCorrectly()?i.selection.selectNode(e,!0):(e.innerHTML="<br>",i.selection.setBefore(e.firstChild))}}),t.observe(this.element,"keydown",function(n){var s,l=n.keyCode;return n.shiftKey||l!==e.ENTER_KEY&&l!==e.BACKSPACE_KEY?void 0:(s=t.getParentElement(i.selection.getSelectedNode(),{nodeName:r},4),s?void setTimeout(function(){var n,r=i.selection.getSelectedNode();if("LI"===s.nodeName){if(!r)return;n=t.getParentElement(r,{nodeName:a},2),n||o(r)}l===e.ENTER_KEY&&s.nodeName.match(/^H[1-6]$/)&&o(r)},0):void(i.config.useLineBreaks&&l===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(n.preventDefault(),i.commands.exec("insertLineBreak"))))})}})}(wysihtml5),function(e){var t=e.dom,n=document,o=window,i=n.createElement("div"),r=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],a=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],s=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],l=function(e){if(e.setActive)try{e.setActive()}catch(i){}else{var r=e.style,a=n.documentElement.scrollTop||n.body.scrollTop,s=n.documentElement.scrollLeft||n.body.scrollLeft,l={position:r.position,top:r.top,left:r.left,WebkitUserSelect:r.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(l).on(e),o.scrollTo&&o.scrollTo(s,a)}};e.views.Composer.prototype.style=function(){var o,c,d=this,u=n.querySelector(":focus"),h=this.textarea.element,f=h.hasAttribute("placeholder"),m=f&&h.getAttribute("placeholder"),p=h.style.display,g=h.disabled;return this.focusStylesHost=i.cloneNode(!1),this.blurStylesHost=i.cloneNode(!1),this.disabledStylesHost=i.cloneNode(!1),f&&h.removeAttribute("placeholder"),h===u&&h.blur(),h.disabled=!1,h.style.display=o="none",(h.getAttribute("rows")&&"auto"===t.getStyle("height").from(h)||h.getAttribute("cols")&&"auto"===t.getStyle("width").from(h))&&(h.style.display=o=p),t.copyStyles(a).from(h).to(this.editableArea).andTo(this.blurStylesHost),t.copyStyles(r).from(h).to(this.element).andTo(this.blurStylesHost),t.insertCSS(s).into(this.element.ownerDocument),h.disabled=!0,t.copyStyles(a).from(h).to(this.disabledStylesHost),t.copyStyles(r).from(h).to(this.disabledStylesHost),h.disabled=g,h.style.display=p,l(h),h.style.display=o,t.copyStyles(a).from(h).to(this.focusStylesHost),t.copyStyles(r).from(h).to(this.focusStylesHost),h.style.display=p,t.copyStyles(["display"]).from(h).to(this.editableArea),c=e.lang.array(a).without(["display"]),u?u.focus():h.blur(),f&&h.setAttribute("placeholder",m),this.parent.on("focus:composer",function(){t.copyStyles(c).from(d.focusStylesHost).to(d.editableArea),t.copyStyles(r).from(d.focusStylesHost).to(d.element)}),this.parent.on("blur:composer",function(){t.copyStyles(c).from(d.blurStylesHost).to(d.editableArea),t.copyStyles(r).from(d.blurStylesHost).to(d.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(c).from(d.disabledStylesHost).to(d.editableArea),t.copyStyles(r).from(d.disabledStylesHost).to(d.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(c).from(d.blurStylesHost).to(d.editableArea),t.copyStyles(r).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,o={66:"bold",73:"italic",85:"underline"},i=function(e,t,n){var o,i=e.getPreviousNode(t,!0),r=e.getSelectedNode();if(1!==r.nodeType&&r.parentNode!==n&&(r=r.parentNode),i)if(1==r.nodeType){if(o=r.firstChild,1==i.nodeType)for(;r.firstChild;)i.appendChild(r.firstChild);else for(;r.firstChild;)t.parentNode.insertBefore(r.firstChild,t);r.parentNode&&r.parentNode.removeChild(r),e.setBefore(o)}else 1==i.nodeType?i.appendChild(r):t.parentNode.insertBefore(r,t),e.setBefore(r)},r=function(e,t,n,o){var r,a,s;t.isCollapsed()?t.caretIsInTheBeginnig("LI")?(e.preventDefault(),o.commands.exec("outdentList")):t.caretIsInTheBeginnig()?e.preventDefault():(t.caretIsFirstInSelection()&&t.getPreviousNode()&&t.getPreviousNode().nodeName&&/^H\d$/gi.test(t.getPreviousNode().nodeName)&&(r=t.getPreviousNode(),e.preventDefault(),/^\s*$/.test(r.textContent||r.innerText)?r.parentNode.removeChild(r):(a=r.ownerDocument.createRange(),a.selectNodeContents(r),a.collapse(!1),t.setSelection(a))),s=t.caretIsBeforeUneditable(),s&&(e.preventDefault(),i(t,s,n))):t.containsUneditable()&&(e.preventDefault(),t.deleteContents())},a=function(e){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("LI")&&e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")};e.views.Composer.prototype.observe=function(){var i,s,l=this,c=this.getValue(!1,!1),d=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),u=this.element,h=n.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?u:this.sandbox.getWindow(),f=["drop","paste","beforepaste"],m=["drop","paste","mouseup","focus","keyup"];t.observe(d,"DOMNodeRemoved",function(){clearInterval(i),l.parent.fire("destroy:composer")}),n.supportsMutationEvents()||(i=setInterval(function(){t.contains(document.documentElement,d)||(clearInterval(i),l.parent.fire("destroy:composer"))},250)),t.observe(h,m,function(){setTimeout(function(){l.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&e.browser.supportsCommand(this.doc,"enableObjectResizing")&&e.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=t.observe(d,["focus","mouseup","mouseover"],function(){l.doc.execCommand("enableObjectResizing",!1,"false"),l.doc.execCommand("enableInlineTableEditing",!1,"false"),l.tableClickHandle.stop()}):setTimeout(function(){l.doc.execCommand("enableObjectResizing",!1,"false"),l.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=e.quirks.tableCellsSelection(u,l.parent)),t.observe(h,"focus",function(e){l.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){c=l.getValue(!1,!1)},0)}),t.observe(h,"blur",function(e){if(c!==l.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),l.parent.fire("change",t).fire("change:composer",t)}l.parent.fire("blur",e).fire("blur:composer",e)}),t.observe(u,"dragenter",function(){l.parent.fire("unset_placeholder")}),t.observe(u,f,function(e){l.parent.fire(e.type,e).fire(e.type+":composer",e)}),this.config.copyedFromMarking&&t.observe(u,"copy",function(e){e.clipboardData&&(e.clipboardData.setData("text/html",l.config.copyedFromMarking+l.selection.getHtml()),e.preventDefault()),l.parent.fire(e.type,e).fire(e.type+":composer",e)}),t.observe(u,"keyup",function(t){var n=t.keyCode;(n===e.SPACE_KEY||n===e.ENTER_KEY)&&l.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){l.parent.fire("newword:composer")},0)}),n.canSelectImagesInContentEditable()||t.observe(u,"mousedown",function(t){var n=t.target,o=u.querySelectorAll("img"),i=u.querySelectorAll("."+l.config.uneditableContainerClassname+" img"),r=e.lang.array(o).without(i);"IMG"===n.nodeName&&e.lang.array(r).contains(n)&&l.selection.selectNode(n)}),n.canSelectImagesInContentEditable()||t.observe(u,"drop",function(){setTimeout(function(){l.selection.getSelection().removeAllRanges()},0)}),n.hasHistoryIssue()&&n.supportsSelectionModify()&&t.observe(u,"keydown",function(e){if(e.metaKey||e.ctrlKey){var t=e.keyCode,n=u.ownerDocument.defaultView,o=n.getSelection();(37===t||39===t)&&(37===t&&(o.modify("extend","left","lineboundary"),e.shiftKey||o.collapseToStart()),39===t&&(o.modify("extend","right","lineboundary"),e.shiftKey||o.collapseToEnd()),e.preventDefault())}}),t.observe(u,"keydown",function(e){var t=e.keyCode,n=o[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&n&&(l.commands.exec(n),e.preventDefault()),8===t?r(e,l.selection,u,l):l.config.handleTabKey&&9===t&&(e.preventDefault(),a(l,u))}),t.observe(u,"keydown",function(t){var n,o=l.selection.getSelectedNode(!0),i=t.keyCode;!o||"IMG"!==o.nodeName||i!==e.BACKSPACE_KEY&&i!==e.DELETE_KEY||(n=o.parentNode,n.removeChild(o),"A"!==n.nodeName||n.firstChild||n.parentNode.removeChild(n),setTimeout(function(){e.quirks.redraw(u)},0),t.preventDefault())}),!this.config.contentEditableMode&&n.hasIframeFocusIssue()&&(t.observe(d,"focus",function(){setTimeout(function(){l.doc.querySelector(":focus")!==l.element&&l.focus()},0)}),t.observe(this.element,"blur",function(){setTimeout(function(){l.selection.getSelection().removeAllRanges()},0)})),s={IMG:"Image: ",A:"Link: "},t.observe(u,"mouseover",function(e){var t,n,o=e.target,i=o.nodeName;("A"===i||"IMG"===i)&&(n=o.hasAttribute("title"),n||(t=s[i]+(o.getAttribute("href")||o.getAttribute("src")),o.setAttribute("title",t)))})}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var n,o=this,i=this.textarea.element.form,r=function(){n=setInterval(function(){o.fromComposerToTextarea()},t)},a=function(){clearInterval(n),n=null};r(),i&&(e.dom.observe(i,"submit",function(){o.sync(!0)}),e.dom.observe(i,"reset",function(){setTimeout(function(){o.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"!==e||n?"textarea"===e&&(o.fromComposerToTextarea(!0),a()):(o.fromTextareaToComposer(!0),r())}),this.editor.on("destroy:composer",a)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e!==!1&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(){var e=this.parent.parse(this.element.value);this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value,o=!n;return e&&o||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},o=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){wysihtml5.dom.observe(e,o,function(e){var o=n[e.type]||e.type;t.fire(o).fire(o+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t,n={name:t,style:!0,toolbar:t,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,o){if(this.editableElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(n).merge(o).get(),this._isCompatible=e.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,
this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new e.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var i=this;return void setTimeout(function(){i.fire("beforeload").fire("load")},0)}e.dom.addClass(document.body,this.config.bodyClassName),this.composer=new e.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t,n){var o=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,i=this.config.parser(t,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:o,uneditableClass:this.config.uneditableContainerClassname,clearInternals:n});return"object"==typeof t&&e.quirks.redraw(t),i},_initParser:function(){var t,n=this;e.browser.supportsModenPaste()?this.on("paste:composer",function(o){o.preventDefault(),t=e.dom.getPastedHtml(o),t&&n._cleanAndPaste(t)}):this.on("beforepaste:composer",function(t){t.preventDefault(),e.dom.getPastedHtmlWithDiv(n.composer,function(e){e&&n._cleanAndPaste(e)})})},_cleanAndPaste:function(t){var n=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(n)}})}(wysihtml5),function(e){var t=e.dom,n="wysihtml5-command-dialog-opened",o="input, select, textarea",i="[data-wysihtml5-dialog-field]",r="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){var i,r,a,s,l,c;if(!this._observed){for(i=this,r=function(e){var t=i._serialize();t==i.elementToChange?i.fire("edit",t):i.fire("save",t),i.hide(),e.preventDefault(),e.stopPropagation()},t.observe(i.link,"click",function(){t.hasClass(i.link,n)&&setTimeout(function(){i.hide()},0)}),t.observe(this.container,"keydown",function(t){var n=t.keyCode;n===e.ENTER_KEY&&r(t),n===e.ESCAPE_KEY&&(i.fire("cancel"),i.hide())}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",r),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){i.fire("cancel"),i.hide(),e.preventDefault(),e.stopPropagation()}),a=this.container.querySelectorAll(o),s=0,l=a.length,c=function(){clearInterval(i.interval)};l>s;s++)t.observe(a[s],"change",c);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll(i),n=t.length,o=0;n>o;o++)e[t[o].getAttribute(r)]=t[o].value;return e},_interpolate:function(e){for(var t,n,o,a=document.querySelector(":focus"),s=this.container.querySelectorAll(i),l=s.length,c=0;l>c;c++)t=s[c],t!==a&&(e&&"hidden"===t.type||(n=t.getAttribute(r),o=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(n)||"":t.defaultValue,t.value=o))},show:function(e){if(!t.hasClass(this.link,n)){var i=this,r=this.container.querySelector(o);if(this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){i._interpolate(!0)},500)),t.addClass(this.link,n),this.container.style.display="",this.fire("show"),r&&!e)try{r.focus()}catch(a){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,n),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},o={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},i={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},r={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(a,s){var l,c,d,u=document.createElement("input");return e.browser.supportsSpeechApiOn(u)?(l=a.editor.textarea.element.getAttribute("lang"),l&&(r.lang=l),c=document.createElement("div"),e.lang.object(o).merge({width:s.offsetWidth+"px",height:s.offsetHeight+"px"}),t.insert(u).into(c),t.insert(c).into(s),t.setStyles(i).on(u),t.setAttributes(r).on(u),t.setStyles(o).on(c),t.setStyles(n).on(s),d="onwebkitspeechchange"in u?"webkitspeechchange":"speechchange",t.observe(u,d,function(){a.execCommand("insertText",u.value),u.value=""}),void t.observe(u,"click",function(e){t.hasClass(s,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})):void(s.style.display="none")}}(wysihtml5),function(e){var t="wysihtml5-command-disabled",n="wysihtml5-commands-disabled",o="wysihtml5-command-active",i="wysihtml5-action-active",r=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(r,a,s){this.editor=r,this.container="string"==typeof a?document.getElementById(a):a,this.composer=r.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),s&&this.show(),null!=r.config.classNameCommandDisabled&&(t=r.config.classNameCommandDisabled),null!=r.config.classNameCommandsDisabled&&(n=r.config.classNameCommandsDisabled),null!=r.config.classNameCommandActive&&(o=r.config.classNameCommandActive),null!=r.config.classNameActionActive&&(i=r.config.classNameActionActive);for(var l=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),c=l.length,d=0;c>d;d++)new e.toolbar.Speech(this,l[d])},_getLinks:function(t){for(var n,o,i,r,a,s=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),l=s.length,c=0,d=this[t+"Mapping"]={};l>c;c++)n=s[c],i=n.getAttribute("data-wysihtml5-"+t),r=n.getAttribute("data-wysihtml5-"+t+"-value"),o=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+i+"']"),a=this._getDialog(n,i),d[i+":"+r]={link:n,group:o,name:i,value:r,dialog:a,state:!1}},_getDialog:function(t,n){var o,i,r=this,a=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']");return a&&(o=e.toolbar["Dialog_"+n]?new e.toolbar["Dialog_"+n](t,a):new e.toolbar.Dialog(t,a),o.on("show",function(){i=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:n,dialogContainer:a,commandLink:t})}),o.on("save",function(e){i&&r.composer.selection.setBookmark(i),r._execCommand(n,e),r.editor.fire("save:dialog",{command:n,dialogContainer:a,commandLink:t})}),o.on("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:n,dialogContainer:a,commandLink:t})})),o},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&t.textarea&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")),"showSource"==e&&t.fire("showSource")},_observe:function(){for(var e=this,t=this.editor,o=this.container,i=this.commandLinks.concat(this.actionLinks),a=i.length,s=0;a>s;s++)"A"===i[s].nodeName?r.setAttributes({href:"javascript:;",unselectable:"on"}).on(i[s]):r.setAttributes({unselectable:"on"}).on(i[s]);r.delegate(o,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),r.delegate(o,"[data-wysihtml5-command]","click",function(t){var n=this,o=n.getAttribute("data-wysihtml5-command"),i=n.getAttribute("data-wysihtml5-command-value");e.execCommand(o,i),t.preventDefault()}),r.delegate(o,"[data-wysihtml5-action]","click",function(t){var n=this.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),t.on("interaction:composer",function(){e._updateLinkStates()}),t.on("focus:composer",function(){e.bookmark=null}),this.editor.config.handleTables&&(t.on("tableselect:composer",function(){e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),t.on("tableunselect:composer",function(){e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),t.on("change_view",function(i){t.textarea&&setTimeout(function(){e.commandsDisabled="composer"!==i,e._updateLinkStates(),e.commandsDisabled?r.addClass(o,n):r.removeClass(o,n)},0)})},_updateLinkStates:function(){var n,a,s,l,c=this.commandMapping,d=this.actionMapping;for(n in c)l=c[n],this.commandsDisabled?(a=!1,r.removeClass(l.link,o),l.group&&r.removeClass(l.group,o),l.dialog&&l.dialog.hide()):(a=this.composer.commands.state(l.name,l.value),r.removeClass(l.link,t),l.group&&r.removeClass(l.group,t)),l.state!==a&&(l.state=a,a?(r.addClass(l.link,o),l.group&&r.addClass(l.group,o),l.dialog&&("object"==typeof a||e.lang.object(a).isArray()?(!l.dialog.multiselect&&e.lang.object(a).isArray()&&(a=1===a.length?a[0]:!0,l.state=a),l.dialog.show(a)):l.dialog.hide())):(r.removeClass(l.link,o),l.group&&r.removeClass(l.group,o),l.dialog&&l.dialog.hide()));for(n in d)s=d[n],"change_view"===s.name&&(s.state=this.editor.currentView===this.editor.textarea,s.state?r.addClass(s.link,i):r.removeClass(s.link,i))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){e.toolbar.Dialog_createTable=e.toolbar.Dialog.extend({show:function(e){this.base(e)}})}(wysihtml5),function(e){var t=(e.dom,"[data-wysihtml5-dialog-field]"),n="data-wysihtml5-dialog-field";e.toolbar.Dialog_foreColorStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var e={},o=this.container.querySelectorAll(t),i=o.length,r=0;i>r;r++)e[o[r].getAttribute(n)]=o[r].value;return e},_interpolate:function(o){for(var i,r=document.querySelector(":focus"),a=this.container.querySelectorAll(t),s=a.length,l=0,c=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,d=c?c.getAttribute("style"):null,u=d?e.quirks.styleParser.parseColor(d,"color"):null;s>l;l++)i=a[l],i!==r&&(o&&"hidden"===i.type||"color"===i.getAttribute(n)&&(i.value=u?u[3]&&1!=u[3]?"rgba("+u[0]+","+u[1]+","+u[2]+","+u[3]+");":"rgb("+u[0]+","+u[1]+","+u[2]+");":"rgb(0,0,0);"))}})}(wysihtml5),function(e){e.dom,e.toolbar.Dialog_fontSizeStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(){var t=document.querySelector(":focus"),n=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),o=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,i=o?o.getAttribute("style"):null,r=i?e.quirks.styleParser.parseFontSize(i):null;n&&n!==t&&r&&!/^\s*$/.test(r)&&(n.value=r)}})}(wysihtml5),Handlebars=function(){var e=function(){"use strict";function e(e){this.string=e}var t;return e.prototype.toString=function(){return""+this.string},t=e}(),t=function(e){"use strict";function t(e){return d[e]||"&amp;"}function n(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}function o(e){return e instanceof c?""+e:e||0===e?(e=""+e,h.test(e)?e.replace(u,t):e):""}function i(e){return e||0===e?!(!s(e)||0!==e.length):!0}var r,a,s,l={},c=e,d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},u=/[&<>"'`]/g,h=/[&<>"'`]/;return l.extend=n,r=Object.prototype.toString,l.toString=r,a=function(e){return"function"==typeof e},a(/x/)&&(a=function(e){return"function"==typeof e&&"[object Function]"===r.call(e)}),l.isFunction=a,s=Array.isArray||function(e){return e&&"object"==typeof e?"[object Array]"===r.call(e):!1},l.isArray=s,l.escapeExpression=o,l.isEmpty=i,l}(e),n=function(){"use strict";function e(e,t){var o,i,r;for(t&&t.firstLine&&(o=t.firstLine,e+=" - "+o+":"+t.firstColumn),i=Error.prototype.constructor.call(this,e),r=0;r<n.length;r++)this[n[r]]=i[n[r]];o&&(this.lineNumber=o,this.column=t.firstColumn)}var t,n=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=Error(),t=e}(),o=function(e,t){"use strict";function n(e,t){this.helpers=e||{},this.partials=t||{},o(this)}function o(e){e.registerHelper("helperMissing",function(e){if(2!==arguments.length)throw new p("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var o=n.inverse||function(){},i=n.fn;return l(t)&&(t=t.call(this)),t===!0?i(this):t===!1||null==t?o(this):s(t)?t.length>0?e.helpers.each(t,n):o(this):i(t)}),e.registerHelper("each",function(e,t){var n,o,i,r=t.fn,a=t.inverse,c=0,d="";if(l(e)&&(e=e.call(this)),t.data&&(n=h(t.data)),e&&"object"==typeof e)if(s(e))for(o=e.length;o>c;c++)n&&(n.index=c,n.first=0===c,n.last=c===e.length-1),d+=r(e[c],{data:n});else for(i in e)e.hasOwnProperty(i)&&(n&&(n.key=i,n.index=c,n.first=0===c),d+=r(e[i],{data:n}),c++);return 0===c&&(d=a(this)),d}),e.registerHelper("if",function(e,t){return l(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||m.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){return l(e)&&(e=e.call(this)),m.isEmpty(e)?void 0:t.fn(e)}),e.registerHelper("log",function(t,n){var o=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(o,t)})}function i(e,t){u.log(e,t)}var r,a,s,l,c,d,u,h,f={},m=e,p=t,g="1.3.0";return f.VERSION=g,r=4,f.COMPILER_REVISION=r,a={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},f.REVISION_CHANGES=a,s=m.isArray,l=m.isFunction,c=m.toString,d="[object Object]",f.HandlebarsEnvironment=n,n.prototype={constructor:n,logger:u,log:i,registerHelper:function(e,t,n){if(c.call(e)===d){if(n||t)throw new p("Arg not supported with multiple helpers");m.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){c.call(e)===d?m.extend(this.partials,e):this.partials[e]=t}},u={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(u.level<=e){var n=u.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}},f.logger=u,f.log=i,h=function(e){var t={};return m.extend(t,e),t},f.createFrame=h,f}(t,n),i=function(e,t,n){"use strict";function o(e){var t,n,o=e&&e[0]||1,i=h;if(o!==i){if(i>o)throw t=f[i],n=f[o],new u("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+t+") or downgrade your runtime to an older version ("+n+").");throw new u("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function i(e,t){if(!t)throw new u("No environment passed to template");var n=function(e,n,o,i,r,a){var s,l=t.VM.invokePartial.apply(this,arguments);if(null!=l)return l;if(t.compile)return s={helpers:i,partials:r,data:a},r[n]=t.compile(e,{data:void 0!==a},t),r[n](o,s);throw new u("The partial "+n+" could not be compiled when running in runtime-only mode")},o={escapeExpression:d.escapeExpression,invokePartial:n,programs:[],program:function(e,t,n){var o=this.programs[e];return n?o=a(e,t,n):o||(o=this.programs[e]=a(e,t)),o},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},d.extend(n,t),d.extend(n,e)),n},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(n,i){var r,a,s,l;return i=i||{},s=i.partial?i:t,i.partial||(r=i.helpers,a=i.partials),l=e.call(o,s,n,r,a,i.data),i.partial||t.VM.checkRevision(o.compilerInfo),l}}function r(e,t,n){var o=Array.prototype.slice.call(arguments,3),i=function(e,i){return i=i||{},t.apply(this,[e,i.data||n].concat(o))};return i.program=e,i.depth=o.length,i}function a(e,t,n){var o=function(e,o){return o=o||{},t(e,o.data||n)};return o.program=e,o.depth=0,o}function s(e,t,n,o,i,r){var a={partial:!0,helpers:o,partials:i,data:r};if(void 0===e)throw new u("The partial "+t+" could not be found");return e instanceof Function?e(n,a):void 0}function l(){return""}var c={},d=e,u=t,h=n.COMPILER_REVISION,f=n.REVISION_CHANGES;return c.checkRevision=o,c.template=i,c.programWithDepth=r,c.program=a,c.invokePartial=s,c.noop=l,c}(t,n,o),r=function(e,t,n,o,i){"use strict";var r,a=e,s=t,l=n,c=o,d=i,u=function(){var e=new a.HandlebarsEnvironment;return c.extend(e,a),e.SafeString=s,e.Exception=l,e.Utils=c,e.VM=d,e.template=function(t){return d.template(t,e)},e},h=u();return h.create=u,r=h}(o,e,n,t,i);return r}(),this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=Handlebars.template(function(e,t,n,o,i){function r(e){var t,n="";return n+="btn-"+u((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===d?t.apply(e):t))}function a(){return' \n      <span class="fa fa-quote-left"></span>\n    '}function s(){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var l,c="",d="function",u=this.escapeExpression,h=this;return c+='<li>\n  <a class="btn ',l=n["if"].call(t,(l=t&&t.options,l=null==l||l===!1?l:l.toolbar,null==l||l===!1?l:l.size),{hash:{},inverse:h.noop,fn:h.program(1,r,i),data:i}),(l||0===l)&&(c+=l),c+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',l=n["if"].call(t,(l=t&&t.options,l=null==l||l===!1?l:l.toolbar,null==l||l===!1?l:l.fa),{hash:{},inverse:h.program(5,s,i),fn:h.program(3,a,i),data:i}),(l||0===l)&&(c+=l),c+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.color=Handlebars.template(function(e,t,n,o,i){function r(e){var t,n="";return n+="btn-"+c((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===l?t.apply(e):t))}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,s="",l="function",c=this.escapeExpression,d=this;return s+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',a=n["if"].call(t,(a=t&&t.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.size),{hash:{},inverse:d.noop,fn:d.program(1,r,i),data:i}),(a||0===a)&&(s+=a),s+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.black,typeof a===l?a.apply(t):a))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.black,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.silver,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.gray,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.maroon,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.red,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.purple,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.green,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.olive,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.navy,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.blue,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.colours,a=null==a||a===!1?a:a.orange,typeof a===l?a.apply(t):a))+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.emphasis=Handlebars.template(function(e,t,n,o,i){function r(e){var t,n="";return n+="btn-"+d((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===c?t.apply(e):t))}function a(e,t){var o,i="";return i+='\n    <a class="btn ',o=n["if"].call(e,(o=e&&e.options,o=null==o||o===!1?o:o.toolbar,null==o||o===!1?o:o.size),{hash:{},inverse:u.noop,fn:u.program(1,r,t),data:t}),(o||0===o)&&(i+=o),i+=' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+d((o=e&&e.locale,o=null==o||o===!1?o:o.emphasis,o=null==o||o===!1?o:o.small,typeof o===c?o.apply(e):o))+"</a>\n    "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,l="",c="function",d=this.escapeExpression,u=this;return l+='<li>\n  <div class="btn-group">\n    <a class="btn ',s=n["if"].call(t,(s=t&&t.options,s=null==s||s===!1?s:s.toolbar,null==s||s===!1?s:s.size),{hash:{},inverse:u.noop,fn:u.program(1,r,i),data:i}),(s||0===s)&&(l+=s),l+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+d((s=t&&t.locale,s=null==s||s===!1?s:s.emphasis,s=null==s||s===!1?s:s.bold,typeof s===c?s.apply(t):s))+'</a>\n    <a class="btn ',s=n["if"].call(t,(s=t&&t.options,s=null==s||s===!1?s:s.toolbar,null==s||s===!1?s:s.size),{hash:{},inverse:u.noop,fn:u.program(1,r,i),data:i}),(s||0===s)&&(l+=s),l+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+d((s=t&&t.locale,s=null==s||s===!1?s:s.emphasis,s=null==s||s===!1?s:s.italic,typeof s===c?s.apply(t):s))+'</a>\n    <a class="btn ',s=n["if"].call(t,(s=t&&t.options,s=null==s||s===!1?s:s.toolbar,null==s||s===!1?s:s.size),{hash:{},inverse:u.noop,fn:u.program(1,r,i),data:i}),(s||0===s)&&(l+=s),l+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+d((s=t&&t.locale,s=null==s||s===!1?s:s.emphasis,s=null==s||s===!1?s:s.underline,typeof s===c?s.apply(t):s))+"</a>\n    ",s=n["if"].call(t,(s=t&&t.options,s=null==s||s===!1?s:s.toolbar,s=null==s||s===!1?s:s.emphasis,null==s||s===!1?s:s.small),{hash:{},inverse:u.noop,fn:u.program(3,a,i),data:i}),(s||0===s)&&(l+=s),l+="\n  </div>\n</li>\n"}),this.wysihtml5.tpl["font-styles"]=Handlebars.template(function(e,t,n,o,i){function r(e){var t,n="";return n+="btn-"+u((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===d?t.apply(e):t))}function a(){return'\n      <span class="fa fa-font"></span>\n    '}function s(){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var l,c="",d="function",u=this.escapeExpression,h=this;return c+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',l=n["if"].call(t,(l=t&&t.options,l=null==l||l===!1?l:l.toolbar,null==l||l===!1?l:l.size),{hash:{},inverse:h.noop,fn:h.program(1,r,i),data:i}),(l||0===l)&&(c+=l),c+='" data-toggle="dropdown">\n    ',l=n["if"].call(t,(l=t&&t.options,l=null==l||l===!1?l:l.toolbar,null==l||l===!1?l:l.fa),{hash:{},inverse:h.program(5,s,i),fn:h.program(3,a,i),data:i}),(l||0===l)&&(c+=l),c+='\n    <span class="current-font">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.normal,typeof l===d?l.apply(t):l))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.normal,typeof l===d?l.apply(t):l))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.h1,typeof l===d?l.apply(t):l))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.h2,typeof l===d?l.apply(t):l))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.h3,typeof l===d?l.apply(t):l))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.h4,typeof l===d?l.apply(t):l))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.h5,typeof l===d?l.apply(t):l))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+u((l=t&&t.locale,l=null==l||l===!1?l:l.font_styles,l=null==l||l===!1?l:l.h6,typeof l===d?l.apply(t):l))+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.html=Handlebars.template(function(e,t,n,o,i){function r(e){var t,n="";return n+="btn-"+u((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===d?t.apply(e):t))}function a(){return'\n        <span class="fa fa-pencil"></span>\n      '}function s(){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var l,c="",d="function",u=this.escapeExpression,h=this;return c+='<li>\n  <div class="btn-group">\n    <a class="btn ',l=n["if"].call(t,(l=t&&t.options,l=null==l||l===!1?l:l.toolbar,null==l||l===!1?l:l.size),{hash:{},inverse:h.noop,fn:h.program(1,r,i),data:i}),(l||0===l)&&(c+=l),c+=' btn-default" data-wysihtml5-action="change_view" title="'+u((l=t&&t.locale,l=null==l||l===!1?l:l.html,l=null==l||l===!1?l:l.edit,typeof l===d?l.apply(t):l))+'" tabindex="-1">\n      ',l=n["if"].call(t,(l=t&&t.options,l=null==l||l===!1?l:l.toolbar,null==l||l===!1?l:l.fa),{hash:{},inverse:h.program(5,s,i),fn:h.program(3,a,i),data:i}),(l||0===l)&&(c+=l),c+="\n    </a>\n  </div>\n</li>\n"}),this.wysihtml5.tpl.image=Handlebars.template(function(e,t,n,o,i){function r(){return"modal-sm"}function a(e){var t,n="";return n+="btn-"+h((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===u?t.apply(e):t))}function s(){return'\n      <span class="fa fa-file-image-o"></span>\n    '}function l(){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var c,d="",u="function",h=this.escapeExpression,f=this;return d+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',c=n["if"].call(t,(c=t&&t.options,c=null==c||c===!1?c:c.toolbar,null==c||c===!1?c:c.smallmodals),{hash:{},inverse:f.noop,fn:f.program(1,r,i),data:i}),(c||0===c)&&(d+=c),d+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+h((c=t&&t.locale,c=null==c||c===!1?c:c.image,c=null==c||c===!1?c:c.insert,typeof c===u?c.apply(t):c))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+h((c=t&&t.locale,c=null==c||c===!1?c:c.image,c=null==c||c===!1?c:c.cancel,typeof c===u?c.apply(t):c))+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+h((c=t&&t.locale,c=null==c||c===!1?c:c.image,c=null==c||c===!1?c:c.insert,typeof c===u?c.apply(t):c))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',c=n["if"].call(t,(c=t&&t.options,c=null==c||c===!1?c:c.toolbar,null==c||c===!1?c:c.size),{hash:{},inverse:f.noop,fn:f.program(3,a,i),data:i}),(c||0===c)&&(d+=c),d+=' btn-default" data-wysihtml5-command="insertImage" title="'+h((c=t&&t.locale,c=null==c||c===!1?c:c.image,c=null==c||c===!1?c:c.insert,typeof c===u?c.apply(t):c))+'" tabindex="-1">\n    ',c=n["if"].call(t,(c=t&&t.options,c=null==c||c===!1?c:c.toolbar,null==c||c===!1?c:c.fa),{hash:{},inverse:f.program(7,l,i),fn:f.program(5,s,i),data:i}),(c||0===c)&&(d+=c),d+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.link=Handlebars.template(function(e,t,n,o,i){function r(){return"modal-sm"}function a(e){var t,n="";return n+="btn-"+h((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===u?t.apply(e):t))}function s(){return'\n      <span class="fa fa-share-square-o"></span>\n    '}function l(){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var c,d="",u="function",h=this.escapeExpression,f=this;return d+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',c=n["if"].call(t,(c=t&&t.options,c=null==c||c===!1?c:c.toolbar,null==c||c===!1?c:c.smallmodals),{hash:{},inverse:f.noop,fn:f.program(1,r,i),data:i}),(c||0===c)&&(d+=c),d+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+h((c=t&&t.locale,
c=null==c||c===!1?c:c.link,c=null==c||c===!1?c:c.insert,typeof c===u?c.apply(t):c))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+h((c=t&&t.locale,c=null==c||c===!1?c:c.link,c=null==c||c===!1?c:c.target,typeof c===u?c.apply(t):c))+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+h((c=t&&t.locale,c=null==c||c===!1?c:c.link,c=null==c||c===!1?c:c.cancel,typeof c===u?c.apply(t):c))+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+h((c=t&&t.locale,c=null==c||c===!1?c:c.link,c=null==c||c===!1?c:c.insert,typeof c===u?c.apply(t):c))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',c=n["if"].call(t,(c=t&&t.options,c=null==c||c===!1?c:c.toolbar,null==c||c===!1?c:c.size),{hash:{},inverse:f.noop,fn:f.program(3,a,i),data:i}),(c||0===c)&&(d+=c),d+=' btn-default" data-wysihtml5-command="createLink" title="'+h((c=t&&t.locale,c=null==c||c===!1?c:c.link,c=null==c||c===!1?c:c.insert,typeof c===u?c.apply(t):c))+'" tabindex="-1">\n    ',c=n["if"].call(t,(c=t&&t.options,c=null==c||c===!1?c:c.toolbar,null==c||c===!1?c:c.fa),{hash:{},inverse:f.program(7,l,i),fn:f.program(5,s,i),data:i}),(c||0===c)&&(d+=c),d+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.lists=Handlebars.template(function(e,t,n,o,i){function r(e){var t,n="";return n+="btn-"+v((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===g?t.apply(e):t))}function a(){return'\n      <span class="fa fa-list-ul"></span>\n    '}function s(){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '}function l(){return'\n      <span class="fa fa-list-ol"></span>\n    '}function c(){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '}function d(){return'\n      <span class="fa fa-outdent"></span>\n    '}function u(){return'\n      <span class="glyphicon glyphicon-indent-right"></span>\n    '}function h(){return'\n      <span class="fa fa-indent"></span>\n    '}function f(){return'\n      <span class="glyphicon glyphicon-indent-left"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var m,p="",g="function",v=this.escapeExpression,y=this;return p+='<li>\n  <div class="btn-group">\n    <a class="btn ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.size),{hash:{},inverse:y.noop,fn:y.program(1,r,i),data:i}),(m||0===m)&&(p+=m),p+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+v((m=t&&t.locale,m=null==m||m===!1?m:m.lists,m=null==m||m===!1?m:m.unordered,typeof m===g?m.apply(t):m))+'" tabindex="-1">\n    ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.fa),{hash:{},inverse:y.program(5,s,i),fn:y.program(3,a,i),data:i}),(m||0===m)&&(p+=m),p+='\n    </a>\n    <a class="btn ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.size),{hash:{},inverse:y.noop,fn:y.program(1,r,i),data:i}),(m||0===m)&&(p+=m),p+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+v((m=t&&t.locale,m=null==m||m===!1?m:m.lists,m=null==m||m===!1?m:m.ordered,typeof m===g?m.apply(t):m))+'" tabindex="-1">\n    ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.fa),{hash:{},inverse:y.program(9,c,i),fn:y.program(7,l,i),data:i}),(m||0===m)&&(p+=m),p+='\n    </a>\n    <a class="btn ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.size),{hash:{},inverse:y.noop,fn:y.program(1,r,i),data:i}),(m||0===m)&&(p+=m),p+=' btn-default" data-wysihtml5-command="Outdent" title="'+v((m=t&&t.locale,m=null==m||m===!1?m:m.lists,m=null==m||m===!1?m:m.outdent,typeof m===g?m.apply(t):m))+'" tabindex="-1">\n    ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.fa),{hash:{},inverse:y.program(13,u,i),fn:y.program(11,d,i),data:i}),(m||0===m)&&(p+=m),p+='\n    </a>\n    <a class="btn ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.size),{hash:{},inverse:y.noop,fn:y.program(1,r,i),data:i}),(m||0===m)&&(p+=m),p+=' btn-default" data-wysihtml5-command="Indent" title="'+v((m=t&&t.locale,m=null==m||m===!1?m:m.lists,m=null==m||m===!1?m:m.indent,typeof m===g?m.apply(t):m))+'" tabindex="-1">\n    ',m=n["if"].call(t,(m=t&&t.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.fa),{hash:{},inverse:y.program(17,f,i),fn:y.program(15,h,i),data:i}),(m||0===m)&&(p+=m),p+="\n    </a>\n  </div>\n</li>\n"}),function(e){"use strict";"function"==typeof define&&define.amd?define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],e):e(jQuery,wysihtml5)}(function(e,t){"use strict";var n=function(e,t){var n,o,i,r=function(e,n,o){return t.tpl[e]?t.tpl[e]({locale:n,options:o}):void 0},a=function(n,i){var r,a;this.el=n,r=e.extend(!0,{},o,i);for(a in r.customTemplates)r.customTemplates.hasOwnProperty(a)&&(t.tpl[a]=r.customTemplates[a]);this.toolbar=this.createToolbar(n,r),this.editor=this.createEditor(r)};a.prototype={constructor:a,createEditor:function(t){t=t||{},t=e.extend(!0,{},t),t.toolbar=this.toolbar[0],this.initializeEditor(this.el[0],t)},initializeEditor:function(e,n){var o,i=new t.Editor(this.el[0],n);if(i.on("beforeload",this.syncBootstrapDialogEvents),i.on("beforeload",this.loadParserRules),i.composer.editableArea.contentDocument?this.addMoreShortcuts(i,i.composer.editableArea.contentDocument.body||i.composer.editableArea.contentDocument,n.shortcuts):this.addMoreShortcuts(i,i.composer.editableArea,n.shortcuts),n&&n.events)for(o in n.events)n.events.hasOwnProperty(o)&&i.on(o,n.events[o]);return i},loadParserRules:function(){"string"===e.type(this.config.parserRules)&&e.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(e,t,n){},success:function(e){void(this.config.parserRules=e)}}),this.config.pasteParserRulesets&&"string"===e.type(this.config.pasteParserRulesets)&&e.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(e,t,n){},success:function(e){this.config.pasteParserRulesets=e}})},syncBootstrapDialogEvents:function(){var t=this;e.map(this.toolbar.commandMapping,function(e){return[e]}).filter(function(e){return e.dialog}).map(function(e){return e.dialog}).forEach(function(n){n.on("show",function(){e(this.container).modal("show")}),n.on("hide",function(){e(this.container).modal("hide"),setTimeout(t.composer.focus,0)}),e(n.container).on("shown.bs.modal",function(){e(this).find("input, select, textarea").first().focus()})}),this.on("change_view",function(){e(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(t,n){var a,s,l=this,c=e("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"}),d=n.locale||o.locale||"en";i.hasOwnProperty(d)||(d="en"),a=e.extend(!0,{},i.en,i[d]);for(s in n.toolbar)n.toolbar[s]&&c.append(r(s,a,n));return c.find('a[data-wysihtml5-command="formatBlock"]').click(function(t){var n=t.delegateTarget||t.target||t.srcElement,o=e(n),i=o.data("wysihtml5-display-format-name"),r=o.data("wysihtml5-format-name")||o.html();(void 0===i||"true"===i)&&l.toolbar.find(".current-font").text(r)}),c.find('a[data-wysihtml5-command="foreColor"]').click(function(t){var n=t.target||t.srcElement,o=e(n);l.toolbar.find(".current-color").text(o.html())}),this.el.before(c),c},addMoreShortcuts:function(e,n,o){t.dom.observe(n,"keydown",function(n){var i,r=n.keyCode,a=o[r];(n.ctrlKey||n.metaKey||n.altKey)&&a&&t.commands[a]&&(i=e.toolbar.commandMapping[a+":null"],i&&i.dialog&&!i.state?i.dialog.show():t.commands[a].exec(e.composer,a),n.preventDefault())})}},n={resetDefaults:function(){e.fn.wysihtml5.defaultOptions=e.extend(!0,{},e.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(t){return this.each(function(){var n=e(this);n.data("wysihtml5",new a(n,t))})},shallowExtend:function(t){var o=e.extend({},e.fn.wysihtml5.defaultOptions,t||{},e(this).data()),i=this;return n.bypassDefaults.apply(i,[o])},deepExtend:function(t){var o=e.extend(!0,{},e.fn.wysihtml5.defaultOptions,t||{}),i=this;return n.bypassDefaults.apply(i,[o])},init:function(e){var t=this;return n.shallowExtend.apply(t,[e])}},e.fn.wysihtml5=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.wysihtml5"):n.init.apply(this,arguments)},e.fn.wysihtml5.Constructor=a,o=e.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},useLineBreaks:!1,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small",75:"createLink"}},void 0===e.fn.wysihtml5.defaultOptionsCache&&(e.fn.wysihtml5.defaultOptionsCache=e.extend(!0,{},e.fn.wysihtml5.defaultOptions)),i=e.fn.wysihtml5.locale={}};n(e,t)}),function(e){e.commands.small={exec:function(t,n){return e.commands.formatInline.exec(t,n,"small")},state:function(t,n){return e.commands.formatInline.state(t,n,"small")}}}(wysihtml5),function(e){"function"==typeof define&&define.amd?define("bootstrap.wysihtml5.en-US",["jquery","bootstrap.wysihtml5"],e):e(jQuery)}(function(e){e.fn.wysihtml5.locale.en=e.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}),function(){$.turbo.execute(".forms-editor-page",function(){$(".textarea").wysihtml5(),$("#summernote-editor").summernote({height:300}),$(window).off("pjax:unload").on("pjax:unload",function(){$("#summernote-editor").summernote("destroy")})})}();